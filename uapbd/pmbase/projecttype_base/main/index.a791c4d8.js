!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("nc-lightapp-front"),require("react")):"function"==typeof define&&define.amd?define(["nc-lightapp-front","react"],t):"object"==typeof exports?exports["uapbd/pmbase/projecttype_base/main/index"]=t(require("nc-lightapp-front"),require("react")):e["uapbd/pmbase/projecttype_base/main/index"]=t(e["nc-lightapp-front"],e.React)}(window,function(e,t){return function(e){var t={};function o(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,o),n.l=!0,n.exports}return o.m=e,o.c=t,o.d=function(e,t,r){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(r,n,function(t){return e[t]}.bind(null,n));return r},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="../../../../",o(o.s=181)}({1:function(t,o){t.exports=e},181:function(e,t,o){e.exports=o(182)},182:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r])}return e},n=function(){function e(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,o,r){return o&&e(t.prototype,o),r&&e(t,r),t}}(),s=o(2),a=function(e){return e&&e.__esModule?e:{default:e}}(s),c=o(1);var i=c.base.NCCheckbox,l=c.base.NCMessage,d={loadTreeDataUrl:"/nccloud/uapbd/projecttype/loadtreedata.do",queryCardUrl:"/nccloud/uapbd/projecttype/querycard.do",enablestateUrl:"/nccloud/uapbd/projecttype/enablestate.do",addCardUrl:"/nccloud/uapbd/projecttype/addcard.do",deleteUrl:"/nccloud/uapbd/projecttype/deltreenode.do",saveUrl:"/nccloud/uapbd/projecttype/savenode.do"},u="10140PRJTG",p=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return o.config=Object.assign({title:"项目类型-集团",treeId:"projectTypeTree",formId:"head",pageCode:u,nodeType:"GROUP_NODE",primaryKey:"pk_projectclass",urls:d},e.config),o.root={isleaf:!1,key:"~",title:o.config.title,id:"~",innercode:"~",pid:"",refname:o.config.title,refpk:"~"},o.initButtonStatus=o.initButtonStatus.bind(o),o.changeButtonStatus=o.changeButtonStatus.bind(o),o.onStartProjectType=o.onStartProjectType.bind(o),o.onStopProjectType=o.onStopProjectType.bind(o),o.dealTreeData=o.dealTreeData.bind(o),o.state={checked:!1,curSelectedNode:null},o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.Component),n(t,[{key:"dealTreeData",value:function(e){return e.forEach(function(e){!function e(t){t.children&&0!=t.children.length?(t.isLeaf=!1,t.children.forEach(function(t){e(t)})):delete t.children}(e)}),e}},{key:"componentDidMount",value:function(){var e=this,t={showOff:this.state.checked};(0,c.ajax)({url:this.config.urls.loadTreeDataUrl,data:t,success:function(t){if(t.success){var o=[Object.assign(r({},e.root),{children:t.data})];e.props.syncTree.setSyncTreeData(e.config.treeId,e.dealTreeData(o)),e.props.syncTree.openNodeByPk(e.config.treeId,e.root.refpk)}}}),this.initButtonStatus()}},{key:"initButtonStatus",value:function(){this.props.button.setButtonVisible("save",!1),this.props.button.setButtonVisible("cancel",!1),this.props.button.setButtonVisible("saveAdd",!1)}},{key:"onSelectTree",value:function(e){var t=this;"edit"!=this.props.form.getFormStatus(this.config.formId)&&(e!=this.root.refpk?(0,c.ajax)({url:this.config.urls.queryCardUrl,data:{pk_projectclass:e},success:function(e){if(e.success){var o=e.data.head.rows[0].values;if(o.hasOwnProperty("enablestate")){var r=o.enablestate.value;e.data.head.rows[0].values.enablestate.value="2"==r}t.props.form.EmptyAllFormValue(t.config.formId),t.props.form.setAllFormValue(e.data),t.props.form.setFormItemsDisabled(t.config.formId,{enablestate:!1})}}}):this.props.form.EmptyAllFormValue(this.config.formId))}},{key:"onAfterFormEvent",value:function(e,t,o,r,n){var s=this;switch(o){case"enablestate":var a=this.props.syncTree.getSelectNode(this.config.treeId);if(!a){var i=r.value?"请选中需要启用的树节点":"请选中需要停用的树节点";return void l.create({content:i,color:"warning"})}var d={pk_projectclass:a.refpk,enablestate:r.value?"2":"1"};e.modal.show("modal",{color:"warning",title:"提示",content:r.value?"确认启用该数据？":"确认停用该数据？",beSureBtnClick:function(){(0,c.ajax)({url:s.config.urls.enablestateUrl,data:d,success:function(e){(0,c.toast)({content:r.value?"启用成功":"停用成功",title:"提示"})}})},cancelBtnClick:function(){e.form.setFormItemsValue(s.config.formId,{enablestate:!0})}})}}},{key:"onAddProjectType",value:function(e){var t=this;this.setState({curSelectedNode:e});var o={};o.pk_parent=e?e.refpk:this.root.refpk,(0,c.ajax)({url:this.config.urls.addCardUrl,data:o,success:function(e){e.success&&(t.props.form.EmptyAllFormValue(t.config.formId),t.props.form.setFormStatus(t.config.formId,"edit"),t.props.form.setAllFormValue(e.data),t.props.form.setFormItemsDisabled(t.config.formId,{enablestate:!0}),t.props.syncTree.setNodeDisable(t.config.treeId,!0))}}),this.changeButtonStatus(e,"add")}},{key:"onEditProjectType",value:function(e){var t=this;this.setState({curSelectedNode:e}),e?((0,c.ajax)({url:this.config.urls.queryCardUrl,data:{pk_projectclass:e.refpk},success:function(e){e.success&&(t.props.syncTree.setNodeDisable(t.config.treeId,!0),t.props.form.setAllFormValue(e.data),t.props.form.setFormItemsDisabled(t.config.formId,{enablestate:!0}),t.props.form.setFormStatus(t.config.formId,"edit"))}}),this.changeButtonStatus(e,"edit")):l.create({content:"请选中需要编辑的节点",color:"warning"})}},{key:"onSaveProjectType",value:function(){var e=this,t=this.props.syncTree.getSelectNode(this.config.treeId);t||(t=this.state.curSelectedNode);var o,r=this.props.form.getAllFormValue(this.config.formId);r.areacode=this.config.formId,r.rows.status="2",o={model:r,pageid:this.config.pageCode};var n=null;r.rows[0].values.hasOwnProperty(this.config.primaryKey)&&(n=r.rows[0].values.pk_projectclass.value);var s=!1;null!=n&&""!=n||(s=!0),(0,c.ajax)({url:this.config.urls.saveUrl,data:o,success:function(t){t.success&&(e.props.form.setFormStatus(e.config.formId,"browse"),e.props.syncTree.setNodeDisable(e.config.treeId,!1),t.data[0].children&&0!=t.data[0].children.length||delete t.data[0].children,s?e.props.syncTree.addNodeSuccess(e.config.treeId,t.data):e.props.syncTree.editNodeSuccess(e.config.treeId,t.data[0]),e.props.syncTree.openNodeByPk(e.config.treeId,t.data[0].pid),e.props.syncTree.setNodeSelected(e.config.treeId,t.data[0].refpk),e.props.form.setFormItemsDisabled(e.config.formId,{enablestate:!1}),e.setState({curSelectedNode:null}))}}),this.changeButtonStatus(t,"save")}},{key:"onSaveAddProjectType",value:function(){var e=this,t=this.props.syncTree.getSelectNode(this.config.treeId),o={},r=this.props.form.getAllFormValue(this.config.formId);r.areacode=this.config.formId,r.rows.status="2",o={model:r,pageid:"10140EPSG"};var n=null;r.rows[0].values.hasOwnProperty(this.config.primaryKey)&&(n=r.rows[0].values[this.config.primaryKey].value);(0,c.ajax)({url:this.config.urls.saveUrl,data:o,success:function(r){r.success&&(e.props.form.setFormStatus(e.config.formId,"browse"),r.data[0].children&&0!=r.data[0].children.length||delete r.data[0].children,e.props.syncTree.addNodeSuccess(e.config.treeId,r.data),e.props.syncTree.openNodeByPk(e.config.treeId,r.data[0].pid),t||(e.props.syncTree.setNodeSelected(e.config.treeId,r.data[0].pid),t=e.props.syncTree.getSelectNode(e.config.treeId)),e.props.syncTree.setNodeDisable(e.config.treeId,!0),o=t?{pk_parent:t.refpk}:{pk_parent:e.root.refpk},(0,c.ajax)({url:e.config.urls.addCardUrl,data:o,success:function(t){t.success&&(e.props.form.EmptyAllFormValue(e.config.formId),e.props.form.setAllFormValue(t.data),e.props.form.setFormStatus(e.config.formId,"edit"))}}))}}),this.changeButtonStatus(t,"saveAdd")}},{key:"onDeleteProjectType",value:function(e){var t=this,o={};if(e)if(e.refpk!=this.root.refpk){e.hasOwnProperty("children")&&e.children.length>0?l.create({content:"该节点包含子节点，不允许删除！",color:"warning"}):(this.props.modal.show("modal",{title:"确认删除",content:"确认要删除所选数据吗？",beSureBtnClick:function(){o={pk_projectclass:e.refpk};e.pid;(0,c.ajax)({url:t.config.urls.deleteUrl,data:o,success:function(o){o.success&&(t.props.form.EmptyAllFormValue(t.config.formId),t.props.syncTree.delNodeSuceess(t.config.treeId,e.refpk),(0,c.toast)({content:"删除成功！",title:"提示"}))}})}}),this.changeButtonStatus(e,"del"))}else l.create({content:"根节点不能删除",color:"warning"});else l.create({content:"请选中需要删除的节点",color:"warning"})}},{key:"onCancelProjectType",value:function(){var e=this,t=this.props.syncTree.getSelectNode(this.config.treeId);this.props.form.EmptyAllFormValue(this.config.formId),this.props.form.setFormItemsDisabled(this.config.formId,{enablestate:!0}),t?(0,c.ajax)({url:this.config.urls.queryCardUrl,data:{pk_projectclass:t.refpk},success:function(t){t.success&&e.props.form.setAllFormValue(t.data)}}):this.props.form.EmptyAllFormValue(this.config.formId),this.props.form.setFormStatus(this.config.formId,"browse"),this.props.syncTree.setNodeDisable(this.config.treeId,!1),this.changeButtonStatus(t,"cancel")}},{key:"onStartProjectType",value:function(){var e,t=this,o=this.props.form.getAllFormValue(this.config.formId),r=this.props.asyncTree.getSelectNodeAsync(this.config.treeId);if(r){if("2"==o.rows[0].values.enablestate.value)return void l.create({content:"该数据已启用，无需多次启用",color:"warning"})}else l.create({content:"请选中需要启用的树节点",color:"warning"});e={pk_projectclass:o.rows[0].values[this.config.primaryKey].value,enablestate:"2"},(0,c.ajax)({url:this.config.urls.enablestateUrl,data:e,success:function(e){t.props.form.setAllFormValue(e.data),t.refreshTreeNode("epsTree",r.pid)}}),this.changeButtonStatus("start")}},{key:"onStopProjectType",value:function(){var e,t=this,o=this.props.form.getAllFormValue(this.config.formId),r=this.props.asyncTree.getSelectNodeAsync(this.config.treeId);if(r){if("1"==o.rows[0].values.enablestate.value)return void l.create({content:"该数据已停用，无需多次停用",color:"warning"})}else l.create({content:"请选中需要停用的树节点",color:"warning"});e={pk_projectclass:o.rows[0].values[this.config.primaryKey].value,enablestate:"1"},(0,c.ajax)({url:this.config.urls.enablestateUrl,data:e,success:function(e){e.success&&(t.props.form.EmptyAllFormValue(t.config.formId),t.refreshTreeNode("epsTree",r.pid))}}),this.changeButtonStatus("stop")}},{key:"onClickSearchBtn",value:function(e,t){var o={};null!=t&&t.map(function(e){o[e.field]=e.value.firstvalue}),e.linkTo("/uapbd/eps/main/list/index.html",o)}},{key:"onMoreSelect",value:function(e){var t=e.key;"start"==t?this.onStartProjectType():"stop"==t&&this.onStopProjectType()}},{key:"onVisibleChange",value:function(e){}},{key:"onMore",value:function(){}},{key:"changeButtonStatus",value:function(e,t){switch(t){case"add":case"saveAdd":this.props.button.setButtonVisible("save",!0),this.props.button.setButtonVisible("saveAdd",!0),this.props.button.setButtonVisible("cancel",!0),this.props.button.setDisabled({save:!1,saveAdd:!1,cancel:!1});break;case"edit":this.props.button.setButtonVisible("save",!0),this.props.button.setButtonVisible("saveAdd",!1),this.props.button.setButtonVisible("cancel",!0),this.props.button.setDisabled({save:!1,cancel:!1});break;case"del":this.props.button.setButtonVisible("save",!1),this.props.button.setButtonVisible("saveAdd",!1),this.props.button.setButtonVisible("cancel",!1);break;case"save":case"cancel":this.props.button.setButtonVisible("save",!1),this.props.button.setButtonVisible("saveAdd",!1),this.props.button.setButtonVisible("cancel",!1),e&&(e.refpk,this.root.refpk)}}},{key:"onAddNodeCallBack",value:function(e,t,o){var r=this,n=this.props.syncTree.getSelectNode(this.config.treeId),s={};s.pid=n?n.refpk:this.root.refpk,(0,c.ajax)({url:this.config.urls.addCardUrl,data:s,success:function(e){e.success&&(r.props.form.EmptyAllFormValue(r.config.formId),r.props.form.setAllFormValue(e.data),r.props.form.setFormStatus(r.config.formId,"edit"),r.props.syncTree.setNodeDisable(r.config.treeId,!0))}})}},{key:"onEditNodeCallBack",value:function(e,t,o){var r=this,n=this.props.syncTree.getSelectNode(this.config.treeId),s={};n?(s[this.config.primaryKey]=n.refpk,(0,c.ajax)({url:this.config.urls.queryCardUrl,data:s,success:function(e){r.props.form.EmptyAllFormValue(r.config.formId),r.props.form.setAllFormValue(e.data),r.props.form.setFormStatus(r.config.formId,"edit"),r.props.syncTree.setNodeDisable(r.config.treeId,!0)}})):l.create({content:"请选中需要编辑的节点",color:"warning"})}},{key:"onDelNodeCallBack",value:function(e,t,o){var r=this,n=this.props.syncTree.getSelectNode(this.config.treeId),s={};n?(s[this.config.primaryKey]=n.refpk,(0,c.ajax)({url:this.config.urls.deleteUrl,data:s,success:function(e){e.success&&r.props.syncTree.delNodeSuceess(r.config.treeId,n.refpk)}})):l.create({content:"请选中需要删除的节点",color:"warning"})}},{key:"onMouseEnterEve",value:function(e){if(e===this.root.refpk){this.props.syncTree.hideIcon(this.config.treeId,e,{delIcon:!1,editIcon:!1,addIcon:!0})}else{this.props.syncTree.hideIcon(this.config.treeId,e,{delIcon:!0,editIcon:!0,addIcon:!1})}}},{key:"onChange",value:function(e){var t=this,o=this.props.syncTree.getSelectNode(this.config.treeId),r={};o||l.create({content:"请选中树节点",color:"warning"}),r[this.config.primaryKey]=o.refpk,r.enablestate=e?"2":"1",(0,c.ajax)({url:this.config.urls.enablestateUrl,data:r,success:function(r){r.success&&(e?t.props.form.setAllFormValue(r.data):(t.props.form.EmptyAllFormValue(t.config.formId),t.props.syncTree.delNodeSuceess(t.config.treeId,o.refpk)))}})}},{key:"onCheckBoxChange",value:function(){var e=this,t=(this.state.checked,{showOff:this.state.checked});(0,c.ajax)({url:this.config.urls.loadTreeDataUrl,data:t,success:function(t){if(t.success){var o=[Object.assign(r({},e.root),{children:t.data})];o.forEach(function(e){!function e(t){t.children&&0!=t.children.length?(t.isLeaf=!1,t.children.forEach(function(t){e(t)})):delete t.children}(e)}),e.props.syncTree.setSyncTreeData(e.config.treeId,o),e.props.syncTree.openNodeByPk(e.config.treeId,e.root.refpk)}}})}},{key:"onCheckBoxClick",value:function(){this.setState({checked:!this.state.checked}),this.props.form.EmptyAllFormValue(this.config.formId)}},{key:"render",value:function(){var e=this.props,t=e.asyncTree,o=e.syncTree,r=e.form,n=e.button,s=e.modal,c=e.search,l=e.DragWidthCom,d=(t.createAsyncTree,o.createSyncTree),u=r.createForm,p=n.createButton,f=s.createModal;c.NCCreateSearch,a.default.createElement(Menu,{onSelect:this.onMoreSelect.bind(this)},a.default.createElement(Item,{key:"start"},"启用"),a.default.createElement(Item,{key:"stop"},"停用"));return a.default.createElement("div",null,f("modal",{noFooter:!1}),a.default.createElement("div",{className:"header"},a.default.createElement("div",{className:"title"},this.config.title),a.default.createElement("span",{className:"showOff"},a.default.createElement(i,{defaultChecked:!1,checked:this.state.checked,onChange:this.onCheckBoxChange.bind(this),onClick:this.onCheckBoxClick.bind(this),size:"lg"},"显示停用")),a.default.createElement("div",{className:" btn-group"},p("save",{name:"保存",buttonColor:"main-button",style:{height:"32px","line-height":"33px",width:"68px","font-size":"13px","font-family":"PingFangHk"},onButtonClick:this.onSaveProjectType.bind(this)}),p("saveAdd",{name:"保存新增",buttonColor:"secondary-button",style:{height:"32px","line-height":"33px",width:"80px","font-size":"13px","font-family":"PingFangHk"},onButtonClick:this.onSaveAddProjectType.bind(this)}),p("cancel",{name:"取消",buttonColor:"secondary-button",style:{height:"32px","line-height":"33px",width:"68px","font-size":"13px","font-family":"PingFangHk"},onButtonClick:this.onCancelProjectType.bind(this)}))),a.default.createElement("div",{className:"tree-card"},a.default.createElement(l,{leftDom:a.default.createElement("div",{className:"tree-area"},d({treeId:this.config.treeId,needEdit:!0,showLine:!1,needSearch:!0,onSelectEve:this.onSelectTree.bind(this),onMouseEnterEve:this.onMouseEnterEve.bind(this),clickEditIconEve:this.onEditProjectType.bind(this),clickAddIconEve:this.onAddProjectType.bind(this),clickDelIconEve:this.onDeleteProjectType.bind(this),showModal:!1})),rightDom:a.default.createElement("div",{className:"card-area"},u(this.config.formId,{onAfterEvent:this.onAfterFormEvent.bind(this)})),defLeftWid:"20%"})))}}]),t}(),f=function(e){var t=e.meta.getMeta();if("Object"===Object.prototype.toString.call(t).slice(8,-1)&&t.hasOwnProperty("head")){var o=e.meta.getMeta().head;if(o.hasOwnProperty("items")){var r=o.items;"Array"===Object.prototype.toString.call(r).slice(8,-1)&&r.map(function(t){t.hasOwnProperty("attrcode")&&"enablestate"==t.attrcode&&e.form.setFormItemsDisabled("head",{enablestate:!0})})}}};t.default=p=(0,c.createPage)({initTemplate:function(e){(0,c.ajax)({url:"/nccloud/platform/templet/querypage.do",data:{pagecode:u},success:function(t){e.meta.setMeta(t.data),f(e)}})}})(p),ReactDOM.render(a.default.createElement(p,{config:config}),document.querySelector("#app"))},2:function(e,o){e.exports=t}})});
//# sourceMappingURL=index.a791c4d8.js.map