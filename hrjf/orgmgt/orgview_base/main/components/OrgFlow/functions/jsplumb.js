(function(){void 0===Math.sgn&&(Math.sgn=function(x){return 0==x?0:0<x?1:-1});var Vectors_subtract=function(v1,v2){return{x:v1.x-v2.x,y:v1.y-v2.y}},Vectors_dotProduct=function(v1,v2){return v1.x*v2.x+v1.y*v2.y},Vectors_square=function(v){return Math.sqrt(v.x*v.x+v.y*v.y)},Vectors_scale=function(v,s){return{x:v.x*s,y:v.y*s}},flatnessTolerance=Math.pow(2,-65),_distanceFromCurve=function(point,curve){for(var candidates=[],w=_convertToBezier(point,curve),degree=curve.length-1,numSolutions=_findRoots(w,2*degree-1,candidates,0),v=Vectors_subtract(point,curve[0]),dist=Vectors_square(v),t=0,i=0;i<numSolutions;i++){v=Vectors_subtract(point,_bezier(curve,degree,candidates[i],null,null));var newDist=Vectors_square(v);newDist<dist&&(dist=newDist,t=candidates[i])}return v=Vectors_subtract(point,curve[degree]),(newDist=Vectors_square(v))<dist&&(dist=newDist,t=1),{location:t,distance:dist}},_convertToBezier=function(point,curve){for(var degree=curve.length-1,higherDegree=2*degree-1,c=[],d=[],cdTable=[],w=[],z=[[1,.6,.3,.1],[.4,.6,.6,.4],[.1,.3,.6,1]],i=0;i<=degree;i++)c[i]=Vectors_subtract(curve[i],point);for(i=0;i<=degree-1;i++)d[i]=Vectors_subtract(curve[i+1],curve[i]),d[i]=Vectors_scale(d[i],3);for(var row=0;row<=degree-1;row++)for(var column=0;column<=degree;column++)cdTable[row]||(cdTable[row]=[]),cdTable[row][column]=Vectors_dotProduct(d[row],c[column]);for(i=0;i<=higherDegree;i++)w[i]||(w[i]=[]),w[i].y=0,w[i].x=parseFloat(i)/higherDegree;for(var n=degree,m=degree-1,k=0;k<=n+m;k++){var lb=Math.max(0,k-m),ub=Math.min(k,n);for(i=lb;i<=ub;i++){var j=k-i;w[i+j].y+=cdTable[j][i]*z[j][i]}}return w},_findRoots=function(w,degree,t,depth){var left_count,right_count,left=[],right=[],left_t=[],right_t=[];switch(_getCrossingCount(w,degree)){case 0:return 0;case 1:if(64<=depth)return t[0]=(w[0].x+w[degree].x)/2,1;if(_isFlatEnough(w,degree))return t[0]=_computeXIntercept(w,degree),1}_bezier(w,degree,.5,left,right),left_count=_findRoots(left,degree,left_t,depth+1),right_count=_findRoots(right,degree,right_t,depth+1);for(var i=0;i<left_count;i++)t[i]=left_t[i];for(i=0;i<right_count;i++)t[i+left_count]=right_t[i];return left_count+right_count},_getCrossingCount=function(curve,degree){var sign,old_sign,n_crossings=0;sign=old_sign=Math.sgn(curve[0].y);for(var i=1;i<=degree;i++)(sign=Math.sgn(curve[i].y))!=old_sign&&n_crossings++,old_sign=sign;return n_crossings},_isFlatEnough=function(curve,degree){var intercept_1,intercept_2,left_intercept,a,b,c,b2,max_distance_above,max_distance_below;a=curve[0].y-curve[degree].y,b=curve[degree].x-curve[0].x,c=curve[0].x*curve[degree].y-curve[degree].x*curve[0].y,max_distance_above=max_distance_below=0;for(var i=1;i<degree;i++){var value=a*curve[i].x+b*curve[i].y+c;max_distance_above<value?max_distance_above=value:value<max_distance_below&&(max_distance_below=value)}return intercept_1=(1*(c-max_distance_above)-0*(b2=b))*(1/(0*b2-1*a)),intercept_2=(1*(c-max_distance_below)-0*(b2=b))*(1/(0*b2-1*a)),left_intercept=Math.min(intercept_1,intercept_2),Math.max(intercept_1,intercept_2)-left_intercept<flatnessTolerance?1:0},_computeXIntercept=function(curve,degree){var XNM=curve[degree].x-curve[0].x,YNM=curve[degree].y-curve[0].y,XMK=curve[0].x-0;return 0+1*((XNM*(curve[0].y-0)-YNM*XMK)*(1/(0*XNM-1*YNM)))},_bezier=function(curve,degree,t,left,right){for(var temp=[[]],j=0;j<=degree;j++)temp[0][j]=curve[j];for(var i=1;i<=degree;i++)for(j=0;j<=degree-i;j++)temp[i]||(temp[i]=[]),temp[i][j]||(temp[i][j]={}),temp[i][j].x=(1-t)*temp[i-1][j].x+t*temp[i-1][j+1].x,temp[i][j].y=(1-t)*temp[i-1][j].y+t*temp[i-1][j+1].y;if(null!=left)for(j=0;j<=degree;j++)left[j]=temp[j][0];if(null!=right)for(j=0;j<=degree;j++)right[j]=temp[degree-j][j];return temp[degree][0]},_curveFunctionCache={},_pointOnPath=function(curve,location){for(var cc=function(order){var fns=_curveFunctionCache[order];if(!fns){var c_term=function(c){return function(t){return c}},t_term=function(){return function(t){return t}},one_minus_t_term=function(){return function(t){return 1-t}},_termFunc=function(terms){return function(t){for(var p=1,i=0;i<terms.length;i++)p*=terms[i](t);return p}};(fns=[]).push(new function(){return function(t){return Math.pow(t,order)}});for(var i=1;i<order;i++){for(var terms=[new c_term(order)],j=0;j<order-i;j++)terms.push(new t_term);for(j=0;j<i;j++)terms.push(new one_minus_t_term);fns.push(new _termFunc(terms))}fns.push(new function(){return function(t){return Math.pow(1-t,order)}}),_curveFunctionCache[order]=fns}return fns}(curve.length-1),_x=0,_y=0,i=0;i<curve.length;i++)_x+=curve[i].x*cc[i](location),_y+=curve[i].y*cc[i](location);return{x:_x,y:_y}},_dist=function(p1,p2){return Math.sqrt(Math.pow(p1.x-p2.x,2)+Math.pow(p1.y-p2.y,2))},_isPoint=function(curve){return curve[0].x===curve[1].x&&curve[0].y===curve[1].y},_pointAlongPath=function(curve,location,distance){if(_isPoint(curve))return{point:curve[0],location:location};for(var prev=_pointOnPath(curve,location),tally=0,curLoc=location,direction=0<distance?1:-1,cur=null;tally<Math.abs(distance);)cur=_pointOnPath(curve,curLoc+=.005*direction),tally+=_dist(cur,prev),prev=cur;return{point:cur,location:curLoc}},_gradientAtPoint=function(curve,location){var p1=_pointOnPath(curve,location),p2=_pointOnPath(curve.slice(0,curve.length-1),location),dy=p2.y-p1.y,dx=p2.x-p1.x;return 0===dy?1/0:Math.atan(dy/dx)},_lineIntersection=function(x1,y1,x2,y2,curve){var a=y2-y1,b=x1-x2,c=x1*(y1-y2)+y1*(x2-x1),coeffs=function(curve){return[_computeCoefficientsForAxis(curve,"x"),_computeCoefficientsForAxis(curve,"y")]}(curve),p=[a*coeffs[0][0]+b*coeffs[1][0],a*coeffs[0][1]+b*coeffs[1][1],a*coeffs[0][2]+b*coeffs[1][2],a*coeffs[0][3]+b*coeffs[1][3]+c],r=function(a,b,c,d){var S,T,A=b/a,B=c/a,C=d/a,Q=(3*B-Math.pow(A,2))/9,R=(9*A*B-27*C-2*Math.pow(A,3))/54,D=Math.pow(Q,3)+Math.pow(R,2),t=[];if(0<=D)S=sgn(R+Math.sqrt(D))*Math.pow(Math.abs(R+Math.sqrt(D)),1/3),T=sgn(R-Math.sqrt(D))*Math.pow(Math.abs(R-Math.sqrt(D)),1/3),t[0]=-A/3+(S+T),t[1]=-A/3-(S+T)/2,t[2]=-A/3-(S+T)/2,0!==Math.abs(Math.sqrt(3)*(S-T)/2)&&(t[1]=-1,t[2]=-1);else{var th=Math.acos(R/Math.sqrt(-Math.pow(Q,3)));t[0]=2*Math.sqrt(-Q)*Math.cos(th/3)-A/3,t[1]=2*Math.sqrt(-Q)*Math.cos((th+2*Math.PI)/3)-A/3,t[2]=2*Math.sqrt(-Q)*Math.cos((th+4*Math.PI)/3)-A/3}for(var i=0;i<3;i++)(t[i]<0||1<t[i])&&(t[i]=-1);return t}.apply(null,p),intersections=[];if(null!=r)for(var i=0;i<3;i++){var s,t=r[i],t2=Math.pow(t,2),t3=Math.pow(t,3),x=[coeffs[0][0]*t3+coeffs[0][1]*t2+coeffs[0][2]*t+coeffs[0][3],coeffs[1][0]*t3+coeffs[1][1]*t2+coeffs[1][2]*t+coeffs[1][3]];s=x2-x1!=0?(x[0]-x1)/(x2-x1):(x[1]-y1)/(y2-y1),0<=t&&t<=1&&0<=s&&s<=1&&intersections.push(x)}return intersections};function _computeCoefficientsForAxis(curve,axis){return[-curve[0][axis]+3*curve[1][axis]+-3*curve[2][axis]+curve[3][axis],3*curve[0][axis]-6*curve[1][axis]+3*curve[2][axis],-3*curve[0][axis]+3*curve[1][axis],curve[0][axis]]}function sgn(x){return x<0?-1:0<x?1:0}var jsBezier=this.jsBezier={distanceFromCurve:_distanceFromCurve,gradientAtPoint:_gradientAtPoint,gradientAtPointAlongCurveFrom:function(curve,location,distance){var p=_pointAlongPath(curve,location,distance);return 1<p.location&&(p.location=1),p.location<0&&(p.location=0),_gradientAtPoint(curve,p.location)},nearestPointOnCurve:function(point,curve){var td=_distanceFromCurve(point,curve);return{point:_bezier(curve,curve.length-1,td.location,null,null),location:td.location}},pointOnCurve:_pointOnPath,pointAlongCurveFrom:function(curve,location,distance){return _pointAlongPath(curve,location,distance).point},perpendicularToCurveAt:function(curve,location,length,distance){var p=_pointAlongPath(curve,location,distance=null==distance?0:distance),m=_gradientAtPoint(curve,p.location),_theta2=Math.atan(-1/m),y=length/2*Math.sin(_theta2),x=length/2*Math.cos(_theta2);return[{x:p.point.x+x,y:p.point.y+y},{x:p.point.x-x,y:p.point.y-y}]},locationAlongCurveFrom:function(curve,location,distance){return _pointAlongPath(curve,location,distance).location},getLength:function(curve){if(_isPoint(curve))return 0;for(var prev=_pointOnPath(curve,0),tally=0,curLoc=0,cur=null;curLoc<1;)cur=_pointOnPath(curve,curLoc+=.005),tally+=_dist(cur,prev),prev=cur;return tally},lineIntersection:_lineIntersection,boxIntersection:function(x,y,w,h,curve){var i=[];return i.push.apply(i,_lineIntersection(x,y,x+w,y,curve)),i.push.apply(i,_lineIntersection(x+w,y,x+w,y+h,curve)),i.push.apply(i,_lineIntersection(x+w,y+h,x,y+h,curve)),i.push.apply(i,_lineIntersection(x,y+h,x,y,curve)),i},boundingBoxIntersection:function(boundingBox,curve){var i=[];return i.push.apply(i,_lineIntersection(boundingBox.x,boundingBox.y,boundingBox.x+boundingBox.w,boundingBox.y,curve)),i.push.apply(i,_lineIntersection(boundingBox.x+boundingBox.w,boundingBox.y,boundingBox.x+boundingBox.w,boundingBox.y+boundingBox.h,curve)),i.push.apply(i,_lineIntersection(boundingBox.x+boundingBox.w,boundingBox.y+boundingBox.h,boundingBox.x,boundingBox.y+boundingBox.h,curve)),i.push.apply(i,_lineIntersection(boundingBox.x,boundingBox.y+boundingBox.h,boundingBox.x,boundingBox.y,curve)),i},version:"0.9.0"};"undefined"!=typeof exports&&(exports.jsBezier=jsBezier)}).call("undefined"!=typeof window?window:this),function(){"use strict";var Biltong=this.Biltong={version:"0.4.0"};"undefined"!=typeof exports&&(exports.Biltong=Biltong);var _isa=function(a){return"[object Array]"===Object.prototype.toString.call(a)},_pointHelper=function(p1,p2,fn){return fn(p1=_isa(p1)?p1:[p1.x,p1.y],p2=_isa(p2)?p2:[p2.x,p2.y])},_gradient=Biltong.gradient=function(p1,p2){return _pointHelper(p1,p2,function(_p1,_p2){return _p2[0]==_p1[0]?_p2[1]>_p1[1]?1/0:-1/0:_p2[1]==_p1[1]?_p2[0]>_p1[0]?0:-0:(_p2[1]-_p1[1])/(_p2[0]-_p1[0])})},_quadrant=(Biltong.normal=function(p1,p2){return-1/_gradient(p1,p2)},Biltong.lineLength=function(p1,p2){return _pointHelper(p1,p2,function(_p1,_p2){return Math.sqrt(Math.pow(_p2[1]-_p1[1],2)+Math.pow(_p2[0]-_p1[0],2))})},Biltong.quadrant=function(p1,p2){return _pointHelper(p1,p2,function(_p1,_p2){return _p2[0]>_p1[0]?_p2[1]>_p1[1]?2:1:_p2[0]==_p1[0]?_p2[1]>_p1[1]?2:1:_p2[1]>_p1[1]?3:4})}),_segmentMultipliers=(Biltong.theta=function(p1,p2){return _pointHelper(p1,p2,function(_p1,_p2){var m=_gradient(_p1,_p2),t=Math.atan(m),s=_quadrant(_p1,_p2);return 4!=s&&3!=s||(t+=Math.PI),t<0&&(t+=2*Math.PI),t})},Biltong.intersects=function(r1,r2){var x1=r1.x,x2=r1.x+r1.w,y1=r1.y,y2=r1.y+r1.h,a1=r2.x,a2=r2.x+r2.w,b1=r2.y,b2=r2.y+r2.h;return x1<=a1&&a1<=x2&&y1<=b1&&b1<=y2||x1<=a2&&a2<=x2&&y1<=b1&&b1<=y2||x1<=a1&&a1<=x2&&y1<=b2&&b2<=y2||x1<=a2&&a1<=x2&&y1<=b2&&b2<=y2||a1<=x1&&x1<=a2&&b1<=y1&&y1<=b2||a1<=x2&&x2<=a2&&b1<=y1&&y1<=b2||a1<=x1&&x1<=a2&&b1<=y2&&y2<=b2||a1<=x2&&x1<=a2&&b1<=y2&&y2<=b2},Biltong.encloses=function(r1,r2,allowSharedEdges){var x1=r1.x,x2=r1.x+r1.w,y1=r1.y,y2=r1.y+r1.h,a1=r2.x,a2=r2.x+r2.w,b1=r2.y,b2=r2.y+r2.h,c=function(v1,v2,v3,v4){return allowSharedEdges?v1<=v2&&v4<=v3:v1<v2&&v4<v3};return c(x1,a1,x2,a2)&&c(y1,b1,y2,b2)},[null,[1,-1],[1,1],[-1,1],[-1,-1]]),_inverseSegmentMultipliers=[null,[-1,-1],[-1,1],[1,1],[1,-1]];Biltong.pointOnLine=function(fromPoint,toPoint,distance){var m=_gradient(fromPoint,toPoint),s=_quadrant(fromPoint,toPoint),segmentMultiplier=0<distance?_segmentMultipliers[s]:_inverseSegmentMultipliers[s],theta=Math.atan(m),y=Math.abs(distance*Math.sin(theta))*segmentMultiplier[1],x=Math.abs(distance*Math.cos(theta))*segmentMultiplier[0];return{x:fromPoint.x+x,y:fromPoint.y+y}},Biltong.perpendicularLineTo=function(fromPoint,toPoint,length){var m=_gradient(fromPoint,toPoint),theta2=Math.atan(-1/m),y=length/2*Math.sin(theta2),x=length/2*Math.cos(theta2);return[{x:toPoint.x+x,y:toPoint.y+y},{x:toPoint.x-x,y:toPoint.y-y}]}}.call("undefined"!=typeof window?window:this),function(){"use strict";function _touchAndList(view,target,pageX,pageY,screenX,screenY,clientX,clientY){return function(){var list=[];return Array.prototype.push.apply(list,arguments),list.item=function(index){return this[index]},list}(function(view,target,pageX,pageY,screenX,screenY,clientX,clientY){return new Touch({target:target,identifier:_uuid(),pageX:pageX,pageY:pageY,screenX:screenX,screenY:screenY,clientX:clientX||screenX,clientY:clientY||screenY})}.apply(null,arguments))}var matchesSelector=function(el,selector,ctx){for(var possibles=(ctx=ctx||el.parentNode).querySelectorAll(selector),i=0;i<possibles.length;i++)if(possibles[i]===el)return!0;return!1},_gel=function(el){return"string"==typeof el||el.constructor===String?document.getElementById(el):el},_t=function(e){return e.srcElement||e.target},_pi=function(e,target,obj,doCompute){if(doCompute){if(void 0!==e.path&&e.path.indexOf)return{path:e.path,end:e.path.indexOf(obj)};var out={path:[],end:-1},_one=function(el){out.path.push(el),el===obj?out.end=out.path.length-1:null!=el.parentNode&&_one(el.parentNode)};return _one(target),out}return{path:[target],end:1}},_d=function(l,fn){for(var i=0,j=l.length;i<j&&l[i]!=fn;i++);i<l.length&&l.splice(i,1)},guid=1,_store=function(obj,event,fn){var g=guid++;return obj.__ta=obj.__ta||{},obj.__ta[event]=obj.__ta[event]||{},(obj.__ta[event][g]=fn).__tauid=g},_curryChildFilter=function(children,obj,fn,evt){if(null==children)return fn;var c=children.split(","),_fn=function(e){_fn.__tauid=fn.__tauid;var t=_t(e),target=t,pathInfo=_pi(e,t,obj,null!=children);if(-1!=pathInfo.end)for(var p=0;p<pathInfo.end;p++){target=pathInfo.path[p];for(var i=0;i<c.length;i++)matchesSelector(target,c[i],obj)&&fn.apply(target,arguments)}};return registerExtraFunction(fn,evt,_fn),_fn},registerExtraFunction=function(fn,evt,newFn){fn.__taExtra=fn.__taExtra||[],fn.__taExtra.push([evt,newFn])},DefaultHandler=function(obj,evt,fn,children){if(isTouchDevice&&touchMap[evt]){var tfn=_curryChildFilter(children,obj,fn,touchMap[evt]);_bind(obj,touchMap[evt],tfn,fn)}"focus"===evt&&null==obj.getAttribute("tabindex")&&obj.setAttribute("tabindex","1"),_bind(obj,evt,_curryChildFilter(children,obj,fn,evt),fn)},_tapProfiles={tap:{touches:1,taps:1},dbltap:{touches:1,taps:2},contextmenu:{touches:2,taps:1}},TapHandler=function(clickThreshold,dblClickThreshold){return function(obj,evt,fn,children){if("contextmenu"==evt&&isMouseDevice)DefaultHandler(obj,evt,fn,children);else{if(null==obj.__taTapHandler){var tt=obj.__taTapHandler={tap:[],dbltap:[],contextmenu:[],down:!1,taps:0,downSelectors:[]},clearSingle=function(){tt.down=!1},clearDouble=function(){tt.taps=0};DefaultHandler(obj,"mousedown",function(e){for(var target=_t(e),pathInfo=_pi(e,target,obj,null!=children),finished=!1,p=0;p<pathInfo.end;p++){if(finished)return;target=pathInfo.path[p];for(var i=0;i<tt.downSelectors.length;i++)if(null==tt.downSelectors[i]||matchesSelector(target,tt.downSelectors[i],obj)){tt.down=!0,setTimeout(clearSingle,clickThreshold),setTimeout(clearDouble,dblClickThreshold),finished=!0;break}}}),DefaultHandler(obj,"mouseup",function(e){if(tt.down){var currentTarget,pathInfo,target=_t(e);tt.taps++;var tc=_touchCount(e);for(var eventId in _tapProfiles)if(_tapProfiles.hasOwnProperty(eventId)){var p=_tapProfiles[eventId];if(p.touches===tc&&(1===p.taps||p.taps===tt.taps))for(var i=0;i<tt[eventId].length;i++){pathInfo=_pi(e,target,obj,null!=tt[eventId][i][1]);for(var pLoop=0;pLoop<pathInfo.end;pLoop++)if(currentTarget=pathInfo.path[pLoop],null==tt[eventId][i][1]||matchesSelector(currentTarget,tt[eventId][i][1],obj)){tt[eventId][i][0].apply(currentTarget,[e]);break}}}}})}obj.__taTapHandler.downSelectors.push(children),obj.__taTapHandler[evt].push([fn,children]),fn.__taUnstore=function(){_d(obj.__taTapHandler[evt],fn)}}}},meeHelper=function(type,evt,obj,target){for(var i in obj.__tamee[type])obj.__tamee[type].hasOwnProperty(i)&&obj.__tamee[type][i].apply(target,[evt])},MouseEnterExitHandler=function(){var activeElements=[];return function(obj,evt,fn,children){if(!obj.__tamee){obj.__tamee={over:!1,mouseenter:[],mouseexit:[]};var over=function(e){var t=_t(e);(null==children&&t==obj&&!obj.__tamee.over||matchesSelector(t,children,obj)&&(null==t.__tamee||!t.__tamee.over))&&(meeHelper("mouseenter",e,obj,t),t.__tamee=t.__tamee||{},t.__tamee.over=!0,activeElements.push(t))},out=function(e){for(var t=_t(e),i=0;i<activeElements.length;i++)t!=activeElements[i]||matchesSelector(e.relatedTarget||e.toElement,"*",t)||(t.__tamee.over=!1,activeElements.splice(i,1),meeHelper("mouseexit",e,obj,t))};_bind(obj,"mouseover",_curryChildFilter(children,obj,over,"mouseover"),over),_bind(obj,"mouseout",_curryChildFilter(children,obj,out,"mouseout"),out)}fn.__taUnstore=function(){delete obj.__tamee[evt][fn.__tauid]},_store(obj,evt,fn),obj.__tamee[evt][fn.__tauid]=fn}},isTouchDevice="ontouchstart"in document.documentElement,isMouseDevice="onmousedown"in document.documentElement,touchMap={mousedown:"touchstart",mouseup:"touchend",mousemove:"touchmove"},iev=function(){var rv=-1;if("Microsoft Internet Explorer"==navigator.appName){var ua=navigator.userAgent;null!=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})").exec(ua)&&(rv=parseFloat(RegExp.$1))}return rv}(),isIELT9=-1<iev&&iev<9,_genLoc=function(e,prefix){if(null==e)return[0,0];var ts=_touches(e),t=_getTouch(ts,0);return[t[prefix+"X"],t[prefix+"Y"]]},_pageLocation=function(e){return null==e?[0,0]:isIELT9?[e.clientX+document.documentElement.scrollLeft,e.clientY+document.documentElement.scrollTop]:_genLoc(e,"page")},_getTouch=function(touches,idx){return touches.item?touches.item(idx):touches[idx]},_touches=function(e){return e.touches&&0<e.touches.length?e.touches:e.changedTouches&&0<e.changedTouches.length?e.changedTouches:e.targetTouches&&0<e.targetTouches.length?e.targetTouches:[e]},_touchCount=function(e){return _touches(e).length},_bind=function(obj,type,fn,originalFn){if(_store(obj,type,fn),originalFn.__tauid=fn.__tauid,obj.addEventListener)obj.addEventListener(type,fn,!1);else if(obj.attachEvent){var key=type+fn.__tauid;obj["e"+key]=fn,obj[key]=function(){obj["e"+key]&&obj["e"+key](window.event)},obj.attachEvent("on"+type,obj[key])}},_unbind=function(obj,type,fn){null!=fn&&_each(obj,function(){var _el=_gel(this);if(function(obj,event,fn){if(obj.__ta&&obj.__ta[event]&&delete obj.__ta[event][fn.__tauid],fn.__taExtra){for(var i=0;i<fn.__taExtra.length;i++)_unbind(obj,fn.__taExtra[i][0],fn.__taExtra[i][1]);fn.__taExtra.length=0}fn.__taUnstore&&fn.__taUnstore()}(_el,type,fn),null!=fn.__tauid)if(_el.removeEventListener)_el.removeEventListener(type,fn,!1),isTouchDevice&&touchMap[type]&&_el.removeEventListener(touchMap[type],fn,!1);else if(this.detachEvent){var key=type+fn.__tauid;_el[key]&&_el.detachEvent("on"+type,_el[key]),_el[key]=null,_el["e"+key]=null}fn.__taTouchProxy&&_unbind(obj,fn.__taTouchProxy[1],fn.__taTouchProxy[0])})},_each=function(obj,fn){if(null!=obj){obj="undefined"!=typeof Window&&"unknown"!=typeof obj.top&&obj==obj.top?[obj]:"string"!=typeof obj&&null==obj.tagName&&null!=obj.length?obj:"string"==typeof obj?document.querySelectorAll(obj):[obj];for(var i=0;i<obj.length;i++)fn.apply(obj[i])}},_uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=16*Math.random()|0;return("x"==c?r:3&r|8).toString(16)})};this.Mottle=function(params){var clickThreshold=(params=params||{}).clickThreshold||250,dblClickThreshold=params.dblClickThreshold||450,mouseEnterExitHandler=new MouseEnterExitHandler,tapHandler=new TapHandler(clickThreshold,dblClickThreshold),_smartClicks=params.smartClicks,_doBind=function(obj,evt,fn,children){null!=fn&&_each(obj,function(){var _el=_gel(this);_smartClicks&&"click"===evt?function(obj,evt,fn,children){null==obj.__taSmartClicks&&(DefaultHandler(obj,"mousedown",function(e){obj.__tad=_pageLocation(e)},children),DefaultHandler(obj,"mouseup",function(e){obj.__tau=_pageLocation(e)},children),DefaultHandler(obj,"click",function(e){if(obj.__tad&&obj.__tau&&obj.__tad[0]===obj.__tau[0]&&obj.__tad[1]===obj.__tau[1])for(var i=0;i<obj.__taSmartClicks.length;i++)obj.__taSmartClicks[i].apply(_t(e),[e])},children),obj.__taSmartClicks=[]);obj.__taSmartClicks.push(fn),fn.__taUnstore=function(){_d(obj.__taSmartClicks,fn)}}(_el,0,fn,children):"tap"===evt||"dbltap"===evt||"contextmenu"===evt?tapHandler(_el,evt,fn,children):"mouseenter"===evt||"mouseexit"==evt?mouseEnterExitHandler(_el,evt,fn,children):DefaultHandler(_el,evt,fn,children)})};this.remove=function(el){return _each(el,function(){var _el=_gel(this);if(_el.__ta)for(var evt in _el.__ta)if(_el.__ta.hasOwnProperty(evt))for(var h in _el.__ta[evt])_el.__ta[evt].hasOwnProperty(h)&&_unbind(_el,evt,_el.__ta[evt][h]);_el.parentNode&&_el.parentNode.removeChild(_el)}),this},this.on=function(el,event,children,fn){var _el=el,_c=4==arguments.length?children:null,_e=event,_f=arguments[arguments.length-1];return _doBind(_el,_e,_f,_c),this},this.off=function(el,event,fn){return _unbind(el,event,fn),this},this.trigger=function(el,event,originalEvent,payload){var originalIsMouse=isMouseDevice&&("undefined"==typeof MouseEvent||null==originalEvent||originalEvent.constructor===MouseEvent),eventToBind=isTouchDevice&&!isMouseDevice&&touchMap[event]?touchMap[event]:event,bindingAMouseEvent=!(isTouchDevice&&!isMouseDevice&&touchMap[event]),pl=_pageLocation(originalEvent),sl=_genLoc(originalEvent,"screen"),cl=function(e){return _genLoc(e,"client")}(originalEvent);return _each(el,function(){var evt,_el=_gel(this);originalEvent=originalEvent||{screenX:sl[0],screenY:sl[1],clientX:cl[0],clientY:cl[1]};var _decorate=function(_evt){payload&&(_evt.payload=payload)},eventGenerators={TouchEvent:function(evt){var touchList=_touchAndList(window,_el,0,pl[0],pl[1],sl[0],sl[1],cl[0],cl[1]);(evt.initTouchEvent||evt.initEvent)(eventToBind,!0,!0,window,null,sl[0],sl[1],cl[0],cl[1],!1,!1,!1,!1,touchList,touchList,touchList,1,0)},MouseEvents:function(evt){evt.initMouseEvent(eventToBind,!0,!0,window,0,sl[0],sl[1],cl[0],cl[1],!1,!1,!1,!1,1,_el)}};if(document.createEvent){var evtName=!bindingAMouseEvent&&!originalIsMouse&&isTouchDevice&&touchMap[event]?"TouchEvent":"MouseEvents";evt=document.createEvent(evtName),eventGenerators[evtName](evt),_decorate(evt),_el.dispatchEvent(evt)}else document.createEventObject&&((evt=document.createEventObject()).eventType=evt.eventName=eventToBind,evt.screenX=sl[0],evt.screenY=sl[1],evt.clientX=cl[0],evt.clientY=cl[1],_decorate(evt),_el.fireEvent("on"+eventToBind,evt))}),this}},this.Mottle.consume=function(e,doNotPreventDefault){e.stopPropagation?e.stopPropagation():e.returnValue=!1,!doNotPreventDefault&&e.preventDefault&&e.preventDefault()},this.Mottle.pageLocation=_pageLocation,this.Mottle.setForceTouchEvents=function(value){isTouchDevice=value},this.Mottle.setForceMouseEvents=function(value){isMouseDevice=value},this.Mottle.version="0.8.0","undefined"!=typeof exports&&(exports.Mottle=this.Mottle)}.call("undefined"==typeof window?this:window),function(){"use strict";var _suggest=function(list,item,head){return-1===list.indexOf(item)&&(head?list.unshift(item):list.push(item),!0)},_vanquish=function(list,item){var idx=list.indexOf(item);-1!==idx&&list.splice(idx,1)},_isString=function(f){return null!=f&&("string"==typeof f||f.constructor===String)},matchesSelector=function(el,selector,ctx){for(var possibles=(ctx=ctx||el.parentNode).querySelectorAll(selector),i=0;i<possibles.length;i++)if(possibles[i]===el)return!0;return!1},iev=function(){var rv=-1;if("Microsoft Internet Explorer"===navigator.appName){var ua=navigator.userAgent;null!=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})").exec(ua)&&(rv=parseFloat(RegExp.$1))}return rv}(),isIELT9=-1<iev&&iev<9,isIE9=9===iev,_pl=function(e){if(isIELT9)return[e.clientX+document.documentElement.scrollLeft,e.clientY+document.documentElement.scrollTop];var ts=_touches(e),t=_getTouch(ts,0);return isIE9?[t.pageX||t.clientX,t.pageY||t.clientY]:[t.pageX,t.pageY]},_getTouch=function(touches,idx){return touches.item?touches.item(idx):touches[idx]},_touches=function(e){return e.touches&&0<e.touches.length?e.touches:e.changedTouches&&0<e.changedTouches.length?e.changedTouches:e.targetTouches&&0<e.targetTouches.length?e.targetTouches:[e]},_classes={draggable:"katavorio-draggable",droppable:"katavorio-droppable",drag:"katavorio-drag",selected:"katavorio-drag-selected",active:"katavorio-drag-active",hover:"katavorio-drag-hover",noSelect:"katavorio-drag-no-select",ghostProxy:"katavorio-ghost-proxy",clonedDrag:"katavorio-clone-drag"},_events=["stop","start","drag","drop","over","out","beforeStart"],_devNull=function(){},_true=function(){return!0},_foreach=function(l,fn,from){for(var i=0;i<l.length;i++)l[i]!=from&&fn(l[i])},_setDroppablesActive=function(dd,val,andHover,drag){_foreach(dd,function(e){e.setActive(val),val&&e.updatePosition(),andHover&&e.setHover(drag,val)})},_each=function(obj,fn){if(null!=obj){obj=_isString(obj)||null!=obj.tagName||null==obj.length?[obj]:obj;for(var i=0;i<obj.length;i++)fn.apply(obj[i],[obj[i]])}},_consume=function(e){e.stopPropagation?(e.stopPropagation(),e.preventDefault()):e.returnValue=!1},Super=function(el,params,css,scope){this.params=params||{},this.el=el,this.params.addClass(this.el,this._class),this.uuid=_uuid();var enabled=!0;return this.setEnabled=function(e){enabled=e},this.isEnabled=function(){return enabled},this.toggleEnabled=function(){enabled=!enabled},this.setScope=function(scopes){this.scopes=scopes?scopes.split(/\s+/):[scope]},this.addScope=function(scopes){var m={};for(var i in _each(this.scopes,function(s){m[s]=!0}),_each(scopes?scopes.split(/\s+/):[],function(s){m[s]=!0}),this.scopes=[],m)this.scopes.push(i)},this.removeScope=function(scopes){var m={};for(var i in _each(this.scopes,function(s){m[s]=!0}),_each(scopes?scopes.split(/\s+/):[],function(s){delete m[s]}),this.scopes=[],m)this.scopes.push(i)},this.toggleScope=function(scopes){var m={};for(var i in _each(this.scopes,function(s){m[s]=!0}),_each(scopes?scopes.split(/\s+/):[],function(s){m[s]?delete m[s]:m[s]=!0}),this.scopes=[],m)this.scopes.push(i)},this.setScope(params.scope),this.k=params.katavorio,params.katavorio},TRUE=function(){return!0},FALSE=function(){return!1},Drag=function(el,params,css,scope){this._class=css.draggable;var k=Super.apply(this,arguments);this.rightButtonCanDrag=this.params.rightButtonCanDrag;var constrain,downAt=[0,0],posAtDown=null,pagePosAtDown=null,pageDelta=[0,0],moving=!1,initialScroll=[0,0],consumeStartEvent=!1!==this.params.consumeStartEvent,dragEl=this.el,clone=this.params.clone,_multipleDrop=(this.params.scroll,!1!==params.multipleDrop),isConstrained=!1,useGhostProxy=!0===params.ghostProxy?TRUE:params.ghostProxy&&"function"==typeof params.ghostProxy?params.ghostProxy:FALSE,selector=params.selector,elementToDrag=null,snapThreshold=params.snapThreshold,_snap=function(pos,gridX,gridY,thresholdX,thresholdY){var _dxl=gridX*Math.floor(pos[0]/gridX),_dxt=_dxl+gridX,_x=Math.abs(pos[0]-_dxl)<=thresholdX?_dxl:Math.abs(_dxt-pos[0])<=thresholdX?_dxt:pos[0],_dyl=gridY*Math.floor(pos[1]/gridY),_dyt=_dyl+gridY;return[_x,Math.abs(pos[1]-_dyl)<=thresholdY?_dyl:Math.abs(_dyt-pos[1])<=thresholdY?_dyt:pos[1]]};this.posses=[],this.posseRoles={},this.toGrid=function(pos){if(null==this.params.grid)return pos;var tx=this.params.grid?this.params.grid[0]/2:snapThreshold||5,ty=this.params.grid?this.params.grid[1]/2:snapThreshold||5;return _snap(pos,this.params.grid[0],this.params.grid[1],tx,ty)},this.snap=function(x,y){if(null!=dragEl){x=x||(this.params.grid?this.params.grid[0]:10),y=y||(this.params.grid?this.params.grid[1]:10);var p=this.params.getPosition(dragEl),tx=this.params.grid?this.params.grid[0]/2:snapThreshold,ty=this.params.grid?this.params.grid[1]/2:snapThreshold;this.params.setPosition(dragEl,_snap(p,x,y,tx,ty))}},this.setUseGhostProxy=function(val){useGhostProxy=val?TRUE:FALSE};var revertFunction,negativeFilter=function(pos){return!1===params.allowNegative?[Math.max(0,pos[0]),Math.max(0,pos[1])]:pos},_setConstrain=function(value){constrain="function"==typeof value?value:value?function(pos,dragEl,_constrainRect,_size){return negativeFilter([Math.max(0,Math.min(_constrainRect.w-_size[0],pos[0])),Math.max(0,Math.min(_constrainRect.h-_size[1],pos[1]))])}.bind(this):function(pos){return negativeFilter(pos)}}.bind(this);_setConstrain("function"==typeof this.params.constrain?this.params.constrain:this.params.constrain||this.params.containment),this.setConstrain=function(value){_setConstrain(value)},this.setRevert=function(fn){revertFunction=fn};var _filters={},_setFilter=this.setFilter=function(f,_exclude){if(f){var key="function"==typeof(obj=f)?(obj._katavorioId=_uuid(),obj._katavorioId):obj;_filters[key]=[function(e){var m,t=e.srcElement||e.target;return _isString(f)?m=matchesSelector(t,f,el):"function"==typeof f&&(m=f(e,el)),m},!1!==_exclude]}var obj};this.addFilter=_setFilter,this.removeFilter=function(f){var key="function"==typeof f?f._katavorioId:f;delete _filters[key]};this.clearAllFilters=function(){_filters={}},this.canDrag=this.params.canDrag||_true;var constrainRect,matchingDroppables=[],intersectingDroppables=[];this.downListener=function(e){var box,body,docElem,scrollTop,scrollLeft,clientTop,clientLeft,top,left;if((this.rightButtonCanDrag||3!==e.which&&2!==e.button)&&this.isEnabled()&&this.canDrag())if(function(e){for(var key in _filters){var f=_filters[key],rv=f[0](e);if(f[1]&&(rv=!rv),!rv)return!1}return!0}(e)&&function(e,el,_katavorio){var t=e.srcElement||e.target;return!matchesSelector(t,_katavorio.getInputFilterSelector(),el)}(e,this.el,this.k)){if(selector){if(null==(elementToDrag=function(parentElement,childElement,selector){if(matchesSelector(childElement,selector,parentElement))return childElement;for(var currentParent=childElement.parentNode;null!=currentParent&&currentParent!==parentElement;){if(matchesSelector(currentParent,selector,parentElement))return currentParent;currentParent=currentParent.parentNode}}(this.el,e.target||e.srcElement,selector)))return}else elementToDrag=this.el;if(clone)if(dragEl=elementToDrag.cloneNode(!0),this.params.addClass(dragEl,_classes.clonedDrag),dragEl.setAttribute("id",null),dragEl.style.position="absolute",null!=this.params.parent){var p=this.params.getPosition(this.el);dragEl.style.left=p[0]+"px",dragEl.style.top=p[1]+"px",this.params.parent.appendChild(dragEl)}else{var b=(box=elementToDrag.getBoundingClientRect(),body=document.body,docElem=document.documentElement,scrollTop=window.pageYOffset||docElem.scrollTop||body.scrollTop,scrollLeft=window.pageXOffset||docElem.scrollLeft||body.scrollLeft,clientTop=docElem.clientTop||body.clientTop||0,clientLeft=docElem.clientLeft||body.clientLeft||0,top=box.top+scrollTop-clientTop,left=box.left+scrollLeft-clientLeft,{top:Math.round(top),left:Math.round(left)});dragEl.style.left=b.left+"px",dragEl.style.top=b.top+"px",document.body.appendChild(dragEl)}else dragEl=elementToDrag;consumeStartEvent&&_consume(e),downAt=_pl(e),dragEl&&dragEl.parentNode&&(initialScroll=[dragEl.parentNode.scrollLeft,dragEl.parentNode.scrollTop]),this.params.bind(document,"mousemove",this.moveListener),this.params.bind(document,"mouseup",this.upListener),k.markSelection(this),k.markPosses(this),this.params.addClass(document.body,css.noSelect),_dispatch("beforeStart",{el:this.el,pos:posAtDown,e:e,drag:this})}else this.params.consumeFilteredEvents&&_consume(e)}.bind(this),this.moveListener=function(e){if(downAt){if(!moving)if(!1!==_dispatch("start",{el:this.el,pos:posAtDown,e:e,drag:this})){if(!downAt)return;this.mark(!0),moving=!0}else this.abort();if(downAt){intersectingDroppables.length=0;var pos=_pl(e),dx=pos[0]-downAt[0],dy=pos[1]-downAt[1],z=this.params.ignoreZoom?1:k.getZoom();dragEl&&dragEl.parentNode&&(dx+=dragEl.parentNode.scrollLeft-initialScroll[0],dy+=dragEl.parentNode.scrollTop-initialScroll[1]),dx/=z,dy/=z,this.moveBy(dx,dy,e),k.updateSelection(dx,dy,this),k.updatePosses(dx,dy,this)}}}.bind(this),this.upListener=function(e){downAt&&(downAt=null,this.params.unbind(document,"mousemove",this.moveListener),this.params.unbind(document,"mouseup",this.upListener),this.params.removeClass(document.body,css.noSelect),this.unmark(e),k.unmarkSelection(this,e),k.unmarkPosses(this,e),this.stop(e),k.notifyPosseDragStop(this,e),moving=!1,clone&&(dragEl&&dragEl.parentNode&&dragEl.parentNode.removeChild(dragEl),dragEl=null),intersectingDroppables.length=0,revertFunction&&!0===revertFunction(this.el,this.params.getPosition(this.el))&&(this.params.setPosition(this.el,posAtDown),_dispatch("revert",this.el)))}.bind(this),this.getFilters=function(){return _filters},this.abort=function(){null!=downAt&&this.upListener()},this.getDragElement=function(retrieveOriginalElement){return retrieveOriginalElement?elementToDrag||this.el:dragEl||this.el};var listeners={start:[],drag:[],stop:[],over:[],out:[],beforeStart:[],revert:[]};params.events.start&&listeners.start.push(params.events.start),params.events.beforeStart&&listeners.beforeStart.push(params.events.beforeStart),params.events.stop&&listeners.stop.push(params.events.stop),params.events.drag&&listeners.drag.push(params.events.drag),params.events.revert&&listeners.revert.push(params.events.revert),this.on=function(evt,fn){listeners[evt]&&listeners[evt].push(fn)},this.off=function(evt,fn){if(listeners[evt]){for(var l=[],i=0;i<listeners[evt].length;i++)listeners[evt][i]!==fn&&l.push(listeners[evt][i]);listeners[evt]=l}};var ghostProxyOffsets,_dispatch=function(evt,value){var result=null;if(listeners[evt])for(var i=0;i<listeners[evt].length;i++)try{var v=listeners[evt][i](value);null!=v&&(result=v)}catch(e){}return result};this.notifyStart=function(e){_dispatch("start",{el:this.el,pos:this.params.getPosition(dragEl),e:e,drag:this})},this.stop=function(e,force){if(force||moving){var positions=[],sel=k.getSelection(),dPos=this.params.getPosition(dragEl);if(1<sel.length)for(var i=0;i<sel.length;i++){var p=this.params.getPosition(sel[i].el);positions.push([sel[i].el,{left:p[0],top:p[1]},sel[i]])}else positions.push([dragEl,{left:dPos[0],top:dPos[1]},this]);_dispatch("stop",{el:dragEl,pos:ghostProxyOffsets||dPos,finalPos:dPos,e:e,drag:this,selection:positions})}},this.mark=function(andNotify){var cs;posAtDown=this.params.getPosition(dragEl),pagePosAtDown=this.params.getPosition(dragEl,!0),pageDelta=[pagePosAtDown[0]-posAtDown[0],pagePosAtDown[1]-posAtDown[1]],this.size=this.params.getSize(dragEl),matchingDroppables=k.getMatchingDroppables(this),_setDroppablesActive(matchingDroppables,!0,!1,this),this.params.addClass(dragEl,this.params.dragClass||css.drag),cs=this.params.getConstrainingRectangle?this.params.getConstrainingRectangle(dragEl):this.params.getSize(dragEl.parentNode),constrainRect={w:cs[0],h:cs[1]},andNotify&&k.notifySelectionDragStart(this)},this.unmark=function(e,doNotCheckDroppables){if(_setDroppablesActive(matchingDroppables,!1,!0,this),isConstrained&&useGhostProxy(elementToDrag)?(ghostProxyOffsets=[dragEl.offsetLeft,dragEl.offsetTop],elementToDrag.parentNode.removeChild(dragEl),dragEl=elementToDrag):ghostProxyOffsets=null,this.params.removeClass(dragEl,this.params.dragClass||css.drag),matchingDroppables.length=0,isConstrained=!1,!doNotCheckDroppables){0<intersectingDroppables.length&&ghostProxyOffsets&&params.setPosition(elementToDrag,ghostProxyOffsets),intersectingDroppables.sort(_rankSort);for(var i=0;i<intersectingDroppables.length;i++){if(!0===intersectingDroppables[i].drop(this,e))break}}},this.moveBy=function(dx,dy,e){intersectingDroppables.length=0;var desiredLoc=this.toGrid([posAtDown[0]+dx,posAtDown[1]+dy]),cPos=constrain(desiredLoc,dragEl,constrainRect,this.size);if(useGhostProxy(this.el))if(desiredLoc[0]!==cPos[0]||desiredLoc[1]!==cPos[1]){if(!isConstrained){var gp=elementToDrag.cloneNode(!0);params.addClass(gp,_classes.ghostProxy),elementToDrag.parentNode.appendChild(gp),dragEl=gp,isConstrained=!0}cPos=desiredLoc}else isConstrained&&(elementToDrag.parentNode.removeChild(dragEl),dragEl=elementToDrag,isConstrained=!1);cPos[0]<0&&(cPos[0]=0),cPos[1]<0&&(cPos[1]=0);var rect={x:cPos[0],y:cPos[1],w:this.size[0],h:this.size[1]},pageRect={x:rect.x+pageDelta[0],y:rect.y+pageDelta[1],w:rect.w,h:rect.h},focusDropElement=null;this.params.setPosition(dragEl,cPos);for(var i=0;i<matchingDroppables.length;i++){var r2={x:matchingDroppables[i].pagePosition[0],y:matchingDroppables[i].pagePosition[1],w:matchingDroppables[i].size[0],h:matchingDroppables[i].size[1]};this.params.intersects(pageRect,r2)&&(_multipleDrop||null==focusDropElement||focusDropElement===matchingDroppables[i].el)&&matchingDroppables[i].canDrop(this)?(focusDropElement||(focusDropElement=matchingDroppables[i].el),intersectingDroppables.push(matchingDroppables[i]),matchingDroppables[i].setHover(this,!0,e)):matchingDroppables[i].isHover()&&matchingDroppables[i].setHover(this,!1,e)}_dispatch("drag",{el:this.el,pos:cPos,e:e,drag:this})},this.destroy=function(){this.params.unbind(this.el,"mousedown",this.downListener),this.params.unbind(document,"mousemove",this.moveListener),this.params.unbind(document,"mouseup",this.upListener),this.downListener=null,this.upListener=null,this.moveListener=null},this.params.bind(this.el,"mousedown",this.downListener),this.params.handle?_setFilter(this.params.handle,!1):_setFilter(this.params.filter,this.params.filterExclude)},Drop=function(el,params,css,scope){this._class=css.droppable,this.params=params||{},this.rank=params.rank||0,this._activeClass=this.params.activeClass||css.active,this._hoverClass=this.params.hoverClass||css.hover,Super.apply(this,arguments);var hover=!1;this.allowLoopback=!1!==this.params.allowLoopback,this.setActive=function(val){this.params[val?"addClass":"removeClass"](this.el,this._activeClass)},this.updatePosition=function(){this.position=this.params.getPosition(this.el),this.pagePosition=this.params.getPosition(this.el,!0),this.size=this.params.getSize(this.el)},this.canDrop=this.params.canDrop||function(drag){return!0},this.isHover=function(){return hover},this.setHover=function(drag,val,e){(val||null==this.el._katavorioDragHover||this.el._katavorioDragHover===drag.el._katavorio)&&(this.params[val?"addClass":"removeClass"](this.el,this._hoverClass),this.el._katavorioDragHover=val?drag.el._katavorio:null,hover!==val&&this.params.events[val?"over":"out"]({el:this.el,e:e,drag:drag,drop:this}),hover=val)},this.drop=function(drag,event){return this.params.events.drop({drag:drag,e:event,drop:this})},this.destroy=function(){this._class=null,this._activeClass=null,this._hoverClass=null,hover=null}},_uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=16*Math.random()|0;return("x"===c?r:3&r|8).toString(16)})},_rankSort=function(a,b){return a.rank<b.rank?1:a.rank>b.rank?-1:0},_gel=function(el){return null==el?null:null==(el="string"==typeof el||el.constructor===String?document.getElementById(el):el)?null:(el._katavorio=el._katavorio||_uuid(),el)};this.Katavorio=function(katavorioParams){var _selection=[],_selectionMap={};this._dragsByScope={},this._dropsByScope={};var _zoom=1,_reg=function(obj,map){_each(obj,function(_obj){for(var i=0;i<_obj.scopes.length;i++)map[_obj.scopes[i]]=map[_obj.scopes[i]]||[],map[_obj.scopes[i]].push(_obj)})},_unreg=function(obj,map){var c=0;return _each(obj,function(_obj){for(var i=0;i<_obj.scopes.length;i++)if(map[_obj.scopes[i]]){var idx=katavorioParams.indexOf(map[_obj.scopes[i]],_obj);-1!==idx&&(map[_obj.scopes[i]].splice(idx,1),c++)}}),0<c},_prepareParams=(this.getMatchingDroppables=function(drag){for(var dd=[],_m={},i=0;i<drag.scopes.length;i++){var _dd=this._dropsByScope[drag.scopes[i]];if(_dd)for(var j=0;j<_dd.length;j++)!_dd[j].canDrop(drag)||_m[_dd[j].uuid]||!_dd[j].allowLoopback&&_dd[j].el===drag.el||(_m[_dd[j].uuid]=!0,dd.push(_dd[j]))}return dd.sort(_rankSort),dd},function(p){p=p||{};var i,_p={events:{}};for(i in katavorioParams)_p[i]=katavorioParams[i];for(i in p)_p[i]=p[i];for(i=0;i<_events.length;i++)_p.events[_events[i]]=p[_events[i]]||_devNull;return _p.katavorio=this,_p}.bind(this)),_mistletoe=function(existingDrag,params){for(var i=0;i<_events.length;i++)params[_events[i]]&&existingDrag.on(_events[i],params[_events[i]])}.bind(this),_css={},overrideCss=katavorioParams.css||{},_scope=katavorioParams.scope||"katavorio-drag-scope";for(var i in _classes)_css[i]=_classes[i];for(var i in overrideCss)_css[i]=overrideCss[i];var inputFilterSelector=katavorioParams.inputFilterSelector||"input,textarea,select,button,option";this.getInputFilterSelector=function(){return inputFilterSelector},this.setInputFilterSelector=function(selector){return inputFilterSelector=selector,this},this.draggable=function(el,params){var o=[];return _each(el,function(_el){if(null!=(_el=_gel(_el)))if(null==_el._katavorioDrag){var p=_prepareParams(params);_el._katavorioDrag=new Drag(_el,p,_css,_scope),_reg(_el._katavorioDrag,this._dragsByScope),o.push(_el._katavorioDrag),katavorioParams.addClass(_el,_css.draggable)}else _mistletoe(_el._katavorioDrag,params)}.bind(this)),o},this.droppable=function(el,params){var o=[];return _each(el,function(_el){if(null!=(_el=_gel(_el))){var drop=new Drop(_el,_prepareParams(params),_css,_scope);_el._katavorioDrop=_el._katavorioDrop||[],_el._katavorioDrop.push(drop),_reg(drop,this._dropsByScope),o.push(drop),katavorioParams.addClass(_el,_css.droppable)}}.bind(this)),o},this.select=function(el){return _each(el,function(){var _el=_gel(this);_el&&_el._katavorioDrag&&(_selectionMap[_el._katavorio]||(_selection.push(_el._katavorioDrag),_selectionMap[_el._katavorio]=[_el,_selection.length-1],katavorioParams.addClass(_el,_css.selected)))}),this},this.deselect=function(el){return _each(el,function(){var _el=_gel(this);if(_el&&_el._katavorio&&_selectionMap[_el._katavorio]){for(var _s=[],i=0;i<_selection.length;i++)_selection[i].el!==_el&&_s.push(_selection[i]);_selection=_s,delete _selectionMap[_el._katavorio],katavorioParams.removeClass(_el,_css.selected)}}),this},this.deselectAll=function(){for(var i in _selectionMap){var d=_selectionMap[i];katavorioParams.removeClass(d[0],_css.selected)}_selection.length=0,_selectionMap={}},this.markSelection=function(drag){_foreach(_selection,function(e){e.mark()},drag)},this.markPosses=function(drag){drag.posses&&_each(drag.posses,function(p){drag.posseRoles[p]&&_posses[p]&&_foreach(_posses[p].members,function(d){d.mark()},drag)})},this.unmarkSelection=function(drag,event){_foreach(_selection,function(e){e.unmark(event)},drag)},this.unmarkPosses=function(drag,event){drag.posses&&_each(drag.posses,function(p){drag.posseRoles[p]&&_posses[p]&&_foreach(_posses[p].members,function(d){d.unmark(event,!0)},drag)})},this.getSelection=function(){return _selection.slice(0)},this.updateSelection=function(dx,dy,drag){_foreach(_selection,function(e){e.moveBy(dx,dy)},drag)};var _posseAction=function(fn,drag){drag.posses&&_each(drag.posses,function(p){drag.posseRoles[p]&&_posses[p]&&_foreach(_posses[p].members,function(e){fn(e)},drag)})};this.updatePosses=function(dx,dy,drag){_posseAction(function(e){e.moveBy(dx,dy)},drag)},this.notifyPosseDragStop=function(drag,evt){_posseAction(function(e){e.stop(evt,!0)},drag)},this.notifySelectionDragStop=function(drag,evt){_foreach(_selection,function(e){e.stop(evt,!0)},drag)},this.notifySelectionDragStart=function(drag,evt){_foreach(_selection,function(e){e.notifyStart(evt)},drag)},this.setZoom=function(z){_zoom=z},this.getZoom=function(){return _zoom};var _scopeManip=function(kObj,scopes,map,fn){_each(kObj,function(_kObj){_unreg(_kObj,map),_kObj[fn](scopes),_reg(_kObj,map)})};_each(["set","add","remove","toggle"],function(v){this[v+"Scope"]=function(el,scopes){_scopeManip(el._katavorioDrag,scopes,this._dragsByScope,v+"Scope"),_scopeManip(el._katavorioDrop,scopes,this._dropsByScope,v+"Scope")}.bind(this),this[v+"DragScope"]=function(el,scopes){_scopeManip(el.constructor===Drag?el:el._katavorioDrag,scopes,this._dragsByScope,v+"Scope")}.bind(this),this[v+"DropScope"]=function(el,scopes){_scopeManip(el.constructor===Drop?el:el._katavorioDrop,scopes,this._dropsByScope,v+"Scope")}.bind(this)}.bind(this)),this.snapToGrid=function(x,y){for(var s in this._dragsByScope)_foreach(this._dragsByScope[s],function(d){d.snap(x,y)})},this.getDragsForScope=function(s){return this._dragsByScope[s]},this.getDropsForScope=function(s){return this._dropsByScope[s]};var _destroy=function(el,type,map){if((el=_gel(el))[type]){var selIdx=_selection.indexOf(el[type]);0<=selIdx&&_selection.splice(selIdx,1),_unreg(el[type],map)&&_each(el[type],function(kObj){kObj.destroy()}),delete el[type]}},_removeListener=function(el,type,evt,fn){(el=_gel(el))[type]&&el[type].off(evt,fn)};this.elementRemoved=function(el){this.destroyDraggable(el),this.destroyDroppable(el)},this.destroyDraggable=function(el,evt,fn){1===arguments.length?_destroy(el,"_katavorioDrag",this._dragsByScope):_removeListener(el,"_katavorioDrag",evt,fn)},this.destroyDroppable=function(el,evt,fn){1===arguments.length?_destroy(el,"_katavorioDrop",this._dropsByScope):_removeListener(el,"_katavorioDrop",evt,fn)},this.reset=function(){this._dragsByScope={},this._dropsByScope={},_selection=[],_selectionMap={},_posses={}};var _posses={},_processOneSpec=function(el,_spec,dontAddExisting){var g,posseId=_isString(_spec)?_spec:_spec.id,active=!!_isString(_spec)||!1!==_spec.active,posse=_posses[posseId]||(g={name:posseId,members:[]},_posses[posseId]=g);return _each(el,function(_el){if(_el._katavorioDrag){if(dontAddExisting&&null!=_el._katavorioDrag.posseRoles[posse.name])return;_suggest(posse.members,_el._katavorioDrag),_suggest(_el._katavorioDrag.posses,posse.name),_el._katavorioDrag.posseRoles[posse.name]=active}}),posse};this.addToPosse=function(el,spec){for(var posses=[],i=1;i<arguments.length;i++)posses.push(_processOneSpec(el,arguments[i]));return 1===posses.length?posses[0]:posses},this.setPosse=function(el,spec){for(var posses=[],i=1;i<arguments.length;i++)posses.push(_processOneSpec(el,arguments[i],!0).name);return _each(el,function(_el){if(_el._katavorioDrag){var diff=function(l1,l2){for(var d=[],i=0;i<l1.length;i++)-1===l2.indexOf(l1[i])&&d.push(l1[i]);return d}(_el._katavorioDrag.posses,posses);Array.prototype.push.apply([],_el._katavorioDrag.posses);for(var i=0;i<diff.length;i++)this.removeFromPosse(_el,diff[i])}}.bind(this)),1===posses.length?posses[0]:posses},this.removeFromPosse=function(el,posseId){if(arguments.length<2)throw new TypeError("No posse id provided for remove operation");for(var i=1;i<arguments.length;i++)posseId=arguments[i],_each(el,function(_el){if(_el._katavorioDrag&&_el._katavorioDrag.posses){var d=_el._katavorioDrag;_each(posseId,function(p){_vanquish(_posses[p].members,d),_vanquish(d.posses,p),delete d.posseRoles[p]})}})},this.removeFromAllPosses=function(el){_each(el,function(_el){if(_el._katavorioDrag&&_el._katavorioDrag.posses){var d=_el._katavorioDrag;_each(d.posses,function(p){_vanquish(_posses[p].members,d)}),d.posses.length=0,d.posseRoles={}}})},this.setPosseState=function(el,posseId,state){var posse=_posses[posseId];posse&&_each(el,function(_el){_el._katavorioDrag&&_el._katavorioDrag.posses&&(_el._katavorioDrag.posseRoles[posse.name]=state)})}},this.Katavorio.version="1.0.0","undefined"!=typeof exports&&(exports.Katavorio=this.Katavorio)}.call("undefined"!=typeof window?window:this),function(){this.jsPlumbUtil=this.jsPlumbUtil||{};var jsPlumbUtil=this.jsPlumbUtil;function isArray(a){return"[object Array]"===Object.prototype.toString.call(a)}function isString(s){return"string"==typeof s}function isBoolean(s){return"boolean"==typeof s}function isObject(o){return null!=o&&"[object Object]"===Object.prototype.toString.call(o)}function isDate(o){return"[object Date]"===Object.prototype.toString.call(o)}function isFunction(o){return"[object Function]"===Object.prototype.toString.call(o)}function clone(a){if(isString(a))return""+a;if(isBoolean(a))return!!a;if(isDate(a))return new Date(a.getTime());if(isFunction(a))return a;if(isArray(a)){for(var b=[],i=0;i<a.length;i++)b.push(clone(a[i]));return b}if(isObject(a)){var c={};for(var j in a)c[j]=clone(a[j]);return c}return a}function merge(a,b,collations,overwrites){var ar,i,cMap={},oMap={};for(collations=collations||[],overwrites=overwrites||[],i=0;i<collations.length;i++)cMap[collations[i]]=!0;for(i=0;i<overwrites.length;i++)oMap[overwrites[i]]=!0;var c=clone(a);for(i in b)if(null==c[i]||oMap[i])c[i]=b[i];else if(isString(b[i])||isBoolean(b[i]))cMap[i]?((ar=[]).push.apply(ar,isArray(c[i])?c[i]:[c[i]]),ar.push.apply(ar,isBoolean(b[i])?b[i]:[b[i]]),c[i]=ar):c[i]=b[i];else if(isArray(b[i]))ar=[],isArray(c[i])&&ar.push.apply(ar,c[i]),ar.push.apply(ar,b[i]),c[i]=ar;else if(isObject(b[i]))for(var j in isObject(c[i])||(c[i]={}),b[i])c[i][j]=b[i][j];return c}function findWithFunction(a,f){if(a)for(var i=0;i<a.length;i++)if(f(a[i]))return i;return-1}function remove(l,v){var idx=l.indexOf(v);return-1<idx&&l.splice(idx,1),-1!==idx}function addToList(map,key,value,insertAtStart){var l=map[key];return null==l&&(l=[],map[key]=l),l[insertAtStart?"unshift":"push"](value),l}function uuid(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=16*Math.random()|0;return("x"===c?r:3&r|8).toString(16)})}function log(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];if(jsPlumbUtil.logEnabled&&"undefined"!=typeof console)try{var msg=arguments[arguments.length-1];console.log(msg)}catch(e){}}"undefined"!=typeof exports&&(exports.jsPlumbUtil=jsPlumbUtil),jsPlumbUtil.isArray=isArray,jsPlumbUtil.isNumber=function(n){return"[object Number]"===Object.prototype.toString.call(n)},jsPlumbUtil.isString=isString,jsPlumbUtil.isBoolean=isBoolean,jsPlumbUtil.isNull=function(s){return null==s},jsPlumbUtil.isObject=isObject,jsPlumbUtil.isDate=isDate,jsPlumbUtil.isFunction=isFunction,jsPlumbUtil.isNamedFunction=function(o){return isFunction(o)&&null!=o.name&&0<o.name.length},jsPlumbUtil.isEmpty=function(o){for(var i in o)if(o.hasOwnProperty(i))return!1;return!0},jsPlumbUtil.clone=clone,jsPlumbUtil.merge=merge,jsPlumbUtil.replace=function(inObj,path,value){if(null!=inObj){var t=inObj;return path.replace(/([^\.])+/g,function(term,lc,pos,str){var array=term.match(/([^\[0-9]+){1}(\[)([0-9+])/),_getArray=function(){return t[array[1]]||(t[array[1]]=[],t[array[1]])};if(pos+term.length>=str.length)array?_getArray()[array[3]]=value:t[term]=value;else if(array){var a_1=_getArray();t=a_1[array[3]]||(a_1[array[3]]={},a_1[array[3]])}else t=t[term]||(t[term]={},t[term]);return""}),inObj}},jsPlumbUtil.functionChain=function(successValue,failValue,fns){for(var i=0;i<fns.length;i++){var o=fns[i][0][fns[i][1]].apply(fns[i][0],fns[i][2]);if(o===failValue)return o}return successValue},jsPlumbUtil.populate=function(model,values,functionPrefix,doNotExpandFunctions){var _one=function(d){if(null!=d){if(isString(d))return function(fromString){var matches=fromString.match(/(\${.*?})/g);if(null!=matches)for(var i=0;i<matches.length;i++){var val=values[matches[i].substring(2,matches[i].length-1)]||"";null!=val&&(fromString=fromString.replace(matches[i],val))}return fromString}(d);if(!isFunction(d)||doNotExpandFunctions||null!=functionPrefix&&0!==(d.name||"").indexOf(functionPrefix)){if(isArray(d)){for(var r=[],i=0;i<d.length;i++)r.push(_one(d[i]));return r}if(isObject(d)){var s={};for(var j in d)s[j]=_one(d[j]);return s}return d}return d(values)}};return _one(model)},jsPlumbUtil.findWithFunction=findWithFunction,jsPlumbUtil.removeWithFunction=function(a,f){var idx=findWithFunction(a,f);return-1<idx&&a.splice(idx,1),-1!==idx},jsPlumbUtil.remove=remove,jsPlumbUtil.addWithFunction=function(list,item,hashFunction){-1===findWithFunction(list,hashFunction)&&list.push(item)},jsPlumbUtil.addToList=addToList,jsPlumbUtil.suggest=function(list,item,insertAtHead){return-1===list.indexOf(item)&&(insertAtHead?list.unshift(item):list.push(item),!0)},jsPlumbUtil.extend=function(child,parent,_protoFn){var i;parent=isArray(parent)?parent:[parent];var _copyProtoChain=function(focus){for(var proto=focus.__proto__;null!=proto;)if(null!=proto.prototype){for(var j in proto.prototype)proto.prototype.hasOwnProperty(j)&&!child.prototype.hasOwnProperty(j)&&(child.prototype[j]=proto.prototype[j]);proto=proto.prototype.__proto__}else proto=null};for(i=0;i<parent.length;i++){for(var j in parent[i].prototype)parent[i].prototype.hasOwnProperty(j)&&!child.prototype.hasOwnProperty(j)&&(child.prototype[j]=parent[i].prototype[j]);_copyProtoChain(parent[i])}var _makeFn=function(name,protoFn){return function(){for(i=0;i<parent.length;i++)parent[i].prototype[name]&&parent[i].prototype[name].apply(this,arguments);return protoFn.apply(this,arguments)}},_oneSet=function(fns){for(var k in fns)child.prototype[k]=_makeFn(k,fns[k])};if(2<arguments.length)for(i=2;i<arguments.length;i++)_oneSet(arguments[i]);return child},jsPlumbUtil.uuid=uuid,jsPlumbUtil.fastTrim=function(s){if(null==s)return null;for(var str=s.replace(/^\s\s*/,""),ws=/\s/,i=str.length;ws.test(str.charAt(--i)););return str.slice(0,i+1)},jsPlumbUtil.each=function(obj,fn){obj=null==obj.length||"string"==typeof obj?[obj]:obj;for(var i=0;i<obj.length;i++)fn(obj[i])},jsPlumbUtil.map=function(obj,fn){for(var o=[],i=0;i<obj.length;i++)o.push(fn(obj[i]));return o},jsPlumbUtil.mergeWithParents=function(type,map,parentAttribute){parentAttribute=parentAttribute||"parent";var _def=function(id){return id?map[id]:null},_parent=function(def){return def?_def(def[parentAttribute]):null},_one=function(parent,def){if(null==parent)return def;var d_1=merge(parent,def);return _one(_parent(parent),d_1)},_getDef=function(t){if(null==t)return{};if("string"==typeof t)return _def(t);if(t.length){for(var done=!1,i=0,_dd=void 0;!done&&i<t.length;)(_dd=_getDef(t[i]))?done=!0:i++;return _dd}},d=_getDef(type);return d?_one(_parent(d),d):{}},jsPlumbUtil.logEnabled=!0,jsPlumbUtil.log=log,jsPlumbUtil.wrap=function(wrappedFunction,newFunction,returnOnThisValue){return function(){var r=null;try{null!=newFunction&&(r=newFunction.apply(this,arguments))}catch(e){log("jsPlumb function failed : "+e)}if(null!=wrappedFunction&&(null==returnOnThisValue||r!==returnOnThisValue))try{r=wrappedFunction.apply(this,arguments)}catch(e){log("wrapped function failed : "+e)}return r}};var EventGenerator=function(){var _this=this;this._listeners={},this.eventsSuspended=!1,this.tick=!1,this.eventsToDieOn={ready:!0},this.queue=[],this.bind=function(event,listener,insertAtStart){var _one=function(evt){addToList(_this._listeners,evt,listener,insertAtStart),listener.__jsPlumb=listener.__jsPlumb||{},listener.__jsPlumb[uuid()]=evt};if("string"==typeof event)_one(event);else if(null!=event.length)for(var i=0;i<event.length;i++)_one(event[i]);return _this},this.fire=function(event,value,originalEvent){if(this.tick)this.queue.unshift(arguments);else{if(this.tick=!0,!this.eventsSuspended&&this._listeners[event]){var l=this._listeners[event].length,i=0,_gone=!1,ret=null;if(!this.shouldFireEvent||this.shouldFireEvent(event,value,originalEvent))for(;!_gone&&i<l&&!1!==ret;){if(this.eventsToDieOn[event])this._listeners[event][i].apply(this,[value,originalEvent]);else try{ret=this._listeners[event][i].apply(this,[value,originalEvent])}catch(e){log("jsPlumb: fire failed for event "+event+" : "+e)}i++,null!=this._listeners&&null!=this._listeners[event]||(_gone=!0)}}this.tick=!1,this._drain()}return this},this._drain=function(){var n=_this.queue.pop();n&&_this.fire.apply(_this,n)},this.unbind=function(eventOrListener,listener){if(0===arguments.length)this._listeners={};else if(1===arguments.length){if("string"==typeof eventOrListener)delete this._listeners[eventOrListener];else if(eventOrListener.__jsPlumb){var evt=void 0;for(var i in eventOrListener.__jsPlumb)evt=eventOrListener.__jsPlumb[i],remove(this._listeners[evt]||[],eventOrListener)}}else 2===arguments.length&&remove(this._listeners[eventOrListener]||[],listener);return this},this.getListener=function(forEvent){return _this._listeners[forEvent]},this.setSuspendEvents=function(val){_this.eventsSuspended=val},this.isSuspendEvents=function(){return _this.eventsSuspended},this.silently=function(fn){_this.setSuspendEvents(!0);try{fn()}catch(e){log("Cannot execute silent function "+e)}_this.setSuspendEvents(!1)},this.cleanupListeners=function(){for(var i in _this._listeners)_this._listeners[i]=null}};jsPlumbUtil.EventGenerator=EventGenerator}.call("undefined"!=typeof window?window:this),function(){"use strict";this.jsPlumbUtil.matchesSelector=function(el,selector,ctx){for(var possibles=(ctx=ctx||el.parentNode).querySelectorAll(selector),i=0;i<possibles.length;i++)if(possibles[i]===el)return!0;return!1},this.jsPlumbUtil.consume=function(e,doNotPreventDefault){e.stopPropagation?e.stopPropagation():e.returnValue=!1,!doNotPreventDefault&&e.preventDefault&&e.preventDefault()},this.jsPlumbUtil.sizeElement=function(el,x,y,w,h){el&&(el.style.height=h+"px",el.height=h,el.style.width=w+"px",el.width=w,el.style.left=x+"px",el.style.top=y+"px")}}.call("undefined"!=typeof window?window:this),function(){"use strict";var root=this,_ju=root.jsPlumbUtil,_timestamp=function(){return""+(new Date).getTime()},_updateHoverStyle=function(component){if(component._jsPlumb.paintStyle&&component._jsPlumb.hoverPaintStyle){var mergedHoverStyle={};jsPlumb.extend(mergedHoverStyle,component._jsPlumb.paintStyle),jsPlumb.extend(mergedHoverStyle,component._jsPlumb.hoverPaintStyle),delete component._jsPlumb.hoverPaintStyle,mergedHoverStyle.gradient&&component._jsPlumb.paintStyle.fill&&delete mergedHoverStyle.gradient,component._jsPlumb.hoverPaintStyle=mergedHoverStyle}},events=["tap","dbltap","click","dblclick","mouseover","mouseout","mousemove","mousedown","mouseup","contextmenu"],_splitType=function(t){return null==t?null:t.split(" ")},_mapType=function(map,obj,typeId){for(var i in obj)map[i]=typeId},_each=function(fn,obj){obj=_ju.isArray(obj)||null!=obj.length&&!_ju.isString(obj)?obj:[obj];for(var i=0;i<obj.length;i++)try{fn.apply(obj[i],[obj[i]])}catch(e){_ju.log(".each iteration failed : "+e)}},_applyTypes=function(component,params,doNotRepaint){if(component.getDefaultType){var td=component.getTypeDescriptor(),map={},defType=component.getDefaultType(),o=_ju.merge({},defType);_mapType(map,defType,"__default");for(var i=0,j=component._jsPlumb.types.length;i<j;i++){var tid=component._jsPlumb.types[i];if("__default"!==tid){var _t=component._jsPlumb.instance.getType(tid,td);null!=_t&&(o=_ju.merge(o,_t,["cssClass"],["connector"]),_mapType(map,_t,tid))}}params&&(o=_ju.populate(o,params,"_")),component.applyType(o,doNotRepaint,map),doNotRepaint||component.repaint()}},jsPlumbUIComponent=root.jsPlumbUIComponent=function(params){_ju.EventGenerator.apply(this,arguments);var a=arguments,id=this.idPrefix+(new Date).getTime();this._jsPlumb={instance:params._jsPlumb,parameters:params.parameters||{},paintStyle:null,hoverPaintStyle:null,paintStyleInUse:null,hover:!1,beforeDetach:params.beforeDetach,beforeDrop:params.beforeDrop,overlayPlacements:[],hoverClass:params.hoverClass||params._jsPlumb.Defaults.HoverClass,types:[],typeCache:{}},this.cacheTypeItem=function(key,item,typeId){this._jsPlumb.typeCache[typeId]=this._jsPlumb.typeCache[typeId]||{},this._jsPlumb.typeCache[typeId][key]=item},this.getCachedTypeItem=function(key,typeId){return this._jsPlumb.typeCache[typeId]?this._jsPlumb.typeCache[typeId][key]:null},this.getId=function(){return id};var o=params.overlays||[],oo={};if(this.defaultOverlayKeys){for(var i=0;i<this.defaultOverlayKeys.length;i++)Array.prototype.push.apply(o,this._jsPlumb.instance.Defaults[this.defaultOverlayKeys[i]]||[]);for(i=0;i<o.length;i++){var fo=jsPlumb.convertToFullOverlaySpec(o[i]);oo[fo[1].id]=fo}}var _defaultType={overlays:oo,parameters:params.parameters||{},scope:params.scope||this._jsPlumb.instance.getDefaultScope()};if(this.getDefaultType=function(){return _defaultType},this.appendToDefaultType=function(obj){for(var i in obj)_defaultType[i]=obj[i]},params.events)for(var evtName in params.events)this.bind(evtName,params.events[evtName]);this.clone=function(){var o=Object.create(this.constructor.prototype);return this.constructor.apply(o,a),o}.bind(this),this.isDetachAllowed=function(connection){var r=!0;if(this._jsPlumb.beforeDetach)try{r=this._jsPlumb.beforeDetach(connection)}catch(e){_ju.log("jsPlumb: beforeDetach callback failed",e)}return r},this.isDropAllowed=function(sourceId,targetId,scope,connection,dropEndpoint,source,target){var r=this._jsPlumb.instance.checkCondition("beforeDrop",{sourceId:sourceId,targetId:targetId,scope:scope,connection:connection,dropEndpoint:dropEndpoint,source:source,target:target});if(this._jsPlumb.beforeDrop)try{r=this._jsPlumb.beforeDrop({sourceId:sourceId,targetId:targetId,scope:scope,connection:connection,dropEndpoint:dropEndpoint,source:source,target:target})}catch(e){_ju.log("jsPlumb: beforeDrop callback failed",e)}return r};var domListeners=[];this.setListenerComponent=function(c){for(var i=0;i<domListeners.length;i++)domListeners[i][3]=c}},_removeTypeCssHelper=function(component,typeIndex){var typeId=component._jsPlumb.types[typeIndex],type=component._jsPlumb.instance.getType(typeId,component.getTypeDescriptor());null!=type&&type.cssClass&&component.canvas&&component._jsPlumb.instance.removeClass(component.canvas,type.cssClass)};_ju.extend(root.jsPlumbUIComponent,_ju.EventGenerator,{getParameter:function(name){return this._jsPlumb.parameters[name]},setParameter:function(name,value){this._jsPlumb.parameters[name]=value},getParameters:function(){return this._jsPlumb.parameters},setParameters:function(p){this._jsPlumb.parameters=p},getClass:function(){return jsPlumb.getClass(this.canvas)},hasClass:function(clazz){return jsPlumb.hasClass(this.canvas,clazz)},addClass:function(clazz){jsPlumb.addClass(this.canvas,clazz)},removeClass:function(clazz){jsPlumb.removeClass(this.canvas,clazz)},updateClasses:function(classesToAdd,classesToRemove){jsPlumb.updateClasses(this.canvas,classesToAdd,classesToRemove)},setType:function(typeId,params,doNotRepaint){this.clearTypes(),this._jsPlumb.types=_splitType(typeId)||[],_applyTypes(this,params,doNotRepaint)},getType:function(){return this._jsPlumb.types},reapplyTypes:function(params,doNotRepaint){_applyTypes(this,params,doNotRepaint)},hasType:function(typeId){return-1!==this._jsPlumb.types.indexOf(typeId)},addType:function(typeId,params,doNotRepaint){var t=_splitType(typeId),_cont=!1;if(null!=t){for(var i=0,j=t.length;i<j;i++)this.hasType(t[i])||(this._jsPlumb.types.push(t[i]),_cont=!0);_cont&&_applyTypes(this,params,doNotRepaint)}},removeType:function(typeId,params,doNotRepaint){var t=_splitType(typeId),_cont=!1,_one=function(tt){var idx=this._jsPlumb.types.indexOf(tt);return-1!==idx&&(_removeTypeCssHelper(this,idx),this._jsPlumb.types.splice(idx,1),!0)}.bind(this);if(null!=t){for(var i=0,j=t.length;i<j;i++)_cont=_one(t[i])||_cont;_cont&&_applyTypes(this,params,doNotRepaint)}},clearTypes:function(params,doNotRepaint){for(var i=this._jsPlumb.types.length,j=0;j<i;j++)_removeTypeCssHelper(this,0),this._jsPlumb.types.splice(0,1);_applyTypes(this,params,doNotRepaint)},toggleType:function(typeId,params,doNotRepaint){var t=_splitType(typeId);if(null!=t){for(var i=0,j=t.length;i<j;i++){var idx=this._jsPlumb.types.indexOf(t[i]);-1!==idx?(_removeTypeCssHelper(this,idx),this._jsPlumb.types.splice(idx,1)):this._jsPlumb.types.push(t[i])}_applyTypes(this,params,doNotRepaint)}},applyType:function(t,doNotRepaint){if(this.setPaintStyle(t.paintStyle,doNotRepaint),this.setHoverPaintStyle(t.hoverPaintStyle,doNotRepaint),t.parameters)for(var i in t.parameters)this.setParameter(i,t.parameters[i]);this._jsPlumb.paintStyleInUse=this.getPaintStyle()},setPaintStyle:function(style,doNotRepaint){this._jsPlumb.paintStyle=style,this._jsPlumb.paintStyleInUse=this._jsPlumb.paintStyle,_updateHoverStyle(this),doNotRepaint||this.repaint()},getPaintStyle:function(){return this._jsPlumb.paintStyle},setHoverPaintStyle:function(style,doNotRepaint){this._jsPlumb.hoverPaintStyle=style,_updateHoverStyle(this),doNotRepaint||this.repaint()},getHoverPaintStyle:function(){return this._jsPlumb.hoverPaintStyle},destroy:function(force){(force||null==this.typeId)&&(this.cleanupListeners(),this.clone=null,this._jsPlumb=null)},isHover:function(){return this._jsPlumb.hover},setHover:function(hover,ignoreAttachedElements,timestamp){if(this._jsPlumb&&!this._jsPlumb.instance.currentlyDragging&&!this._jsPlumb.instance.isHoverSuspended()){var method=(this._jsPlumb.hover=hover)?"addClass":"removeClass";null!=this.canvas&&(null!=this._jsPlumb.instance.hoverClass&&this._jsPlumb.instance[method](this.canvas,this._jsPlumb.instance.hoverClass),null!=this._jsPlumb.hoverClass&&this._jsPlumb.instance[method](this.canvas,this._jsPlumb.hoverClass)),null!=this._jsPlumb.hoverPaintStyle&&(this._jsPlumb.paintStyleInUse=hover?this._jsPlumb.hoverPaintStyle:this._jsPlumb.paintStyle,this._jsPlumb.instance.isSuspendDrawing()||(timestamp=timestamp||_timestamp(),this.repaint({timestamp:timestamp,recalc:!1}))),this.getAttachedElements&&!ignoreAttachedElements&&function(component,state,timestamp,sourceElement){var affectedElements=component.getAttachedElements();if(affectedElements)for(var i=0,j=affectedElements.length;i<j;i++)sourceElement&&sourceElement===affectedElements[i]||affectedElements[i].setHover(state,!0,timestamp)}(this,hover,_timestamp(),this)}}});var _jsPlumbInstanceIndex=0,jsPlumbInstance=root.jsPlumbInstance=function(_defaults){this.version="2.8.8",this.Defaults={Anchor:"Bottom",Anchors:[null,null],ConnectionsDetachable:!0,ConnectionOverlays:[],Connector:"Bezier",Container:null,DoNotThrowErrors:!1,DragOptions:{},DropOptions:{},Endpoint:"Dot",EndpointOverlays:[],Endpoints:[null,null],EndpointStyle:{fill:"#456"},EndpointStyles:[null,null],EndpointHoverStyle:null,EndpointHoverStyles:[null,null],HoverPaintStyle:null,LabelStyle:{color:"black"},LogEnabled:!1,Overlays:[],MaxConnections:1,PaintStyle:{"stroke-width":4,stroke:"#456"},ReattachConnections:!1,RenderMode:"svg",Scope:"jsPlumb_DefaultScope"},_defaults&&jsPlumb.extend(this.Defaults,_defaults),this.logEnabled=this.Defaults.LogEnabled,this._connectionTypes={},this._endpointTypes={},_ju.EventGenerator.apply(this);var _currentInstance=this,_instanceIndex=function(){var i=_jsPlumbInstanceIndex+1;return _jsPlumbInstanceIndex++,i}(),_bb=_currentInstance.bind,_initialDefaults={},_zoom=1,_info=function(el){if(null==el)return null;if(3===el.nodeType||8===el.nodeType)return{el:el,text:!0};var _el=_currentInstance.getElement(el);return{el:_el,id:_ju.isString(el)&&null==_el?el:_getId(_el)}};for(var i in this.getInstanceIndex=function(){return _instanceIndex},this.setZoom=function(z,repaintEverything){return _zoom=z,_currentInstance.fire("zoom",_zoom),repaintEverything&&_currentInstance.repaintEverything(),!0},this.getZoom=function(){return _zoom},this.Defaults)_initialDefaults[i]=this.Defaults[i];var _container,_containerDelegations=[];this.unbindContainer=function(){if(null!=_container&&0<_containerDelegations.length)for(var i=0;i<_containerDelegations.length;i++)_currentInstance.off(_container,_containerDelegations[i][0],_containerDelegations[i][1])},this.setContainer=function(c){this.unbindContainer(),c=this.getElement(c),this.select().each(function(conn){conn.moveParent(c)}),this.selectEndpoints().each(function(ep){ep.moveParent(c)});var previousContainer=_container;_container=c,_containerDelegations.length=0;for(var eventAliases={endpointclick:"endpointClick",endpointdblclick:"endpointDblClick"},_oneDelegateHandler=function(id,e,componentType){var t=e.srcElement||e.target,jp=(t&&t.parentNode?t.parentNode._jsPlumb:null)||(t?t._jsPlumb:null)||(t&&t.parentNode&&t.parentNode.parentNode?t.parentNode.parentNode._jsPlumb:null);if(jp){jp.fire(id,jp,e);var alias=componentType&&eventAliases[componentType+id]||id;_currentInstance.fire(alias,jp.component||jp,e)}},_addOneDelegate=function(eventId,selector,fn){_containerDelegations.push([eventId,fn]),_currentInstance.on(_container,eventId,selector,fn)},_oneDelegate=function(id){_addOneDelegate(id,".jtk-connector",function(e){_oneDelegateHandler(id,e)}),_addOneDelegate(id,".jtk-endpoint",function(e){_oneDelegateHandler(id,e,"endpoint")}),_addOneDelegate(id,".jtk-overlay",function(e){_oneDelegateHandler(id,e)})},i=0;i<events.length;i++)_oneDelegate(events[i]);for(var elId in managedElements){var el=managedElements[elId].el;el.parentNode===previousContainer&&(previousContainer.removeChild(el),_container.appendChild(el))}},this.getContainer=function(){return _container},this.bind=function(event,fn){"ready"===event&&initialized?fn():_bb.apply(_currentInstance,[event,fn])},_currentInstance.importDefaults=function(d){for(var i in d)_currentInstance.Defaults[i]=d[i];return d.Container&&_currentInstance.setContainer(d.Container),_currentInstance},_currentInstance.restoreDefaults=function(){return _currentInstance.Defaults=jsPlumb.extend({},_initialDefaults),_currentInstance};var log=null,initialized=!1,connections=[],endpointsByElement={},endpointsByUUID={},managedElements={},offsets={},offsetTimestamps={},draggableStates={},connectionBeingDragged=!1,sizes=[],_suspendDrawing=!1,_suspendedAt=null,DEFAULT_SCOPE=this.Defaults.Scope,_curIdStamp=1,_idstamp=function(){return""+_curIdStamp++},_appendElement=function(el,parent){_container?_container.appendChild(el):parent?this.getElement(parent).appendChild(el):this.appendToRoot(el)}.bind(this),_draw=function(element,ui,timestamp,clearEdits){if(!_suspendDrawing){var repaintEls,id=_getId(element),dm=_currentInstance.getDragManager();dm&&(repaintEls=dm.getElementsForDraggable(id)),null==timestamp&&(timestamp=_timestamp());var o=_updateOffset({elId:id,offset:ui,recalc:!1,timestamp:timestamp});if(repaintEls&&o&&o.o)for(var i in repaintEls)_updateOffset({elId:repaintEls[i].id,offset:{left:o.o.left+repaintEls[i].offset.left,top:o.o.top+repaintEls[i].offset.top},recalc:!1,timestamp:timestamp});if(_currentInstance.anchorManager.redraw(id,ui,timestamp,null,clearEdits),repaintEls)for(var j in repaintEls)_currentInstance.anchorManager.redraw(repaintEls[j].id,ui,timestamp,repaintEls[j].offset,clearEdits,!0)}},_getEndpoint=function(uuid){return endpointsByUUID[uuid]},_prepareConnectionParams=function(params,referenceParams){var _p=jsPlumb.extend({},params);if(referenceParams&&jsPlumb.extend(_p,referenceParams),_p.source&&(_p.source.endpoint?_p.sourceEndpoint=_p.source:_p.source=_currentInstance.getElement(_p.source)),_p.target&&(_p.target.endpoint?_p.targetEndpoint=_p.target:_p.target=_currentInstance.getElement(_p.target)),params.uuids&&(_p.sourceEndpoint=_getEndpoint(params.uuids[0]),_p.targetEndpoint=_getEndpoint(params.uuids[1])),_p.sourceEndpoint&&_p.sourceEndpoint.isFull())_ju.log(_currentInstance,"could not add connection; source endpoint is full");else if(_p.targetEndpoint&&_p.targetEndpoint.isFull())_ju.log(_currentInstance,"could not add connection; target endpoint is full");else{if(!_p.type&&_p.sourceEndpoint&&(_p.type=_p.sourceEndpoint.connectionType),_p.sourceEndpoint&&_p.sourceEndpoint.connectorOverlays){_p.overlays=_p.overlays||[];for(var i=0,j=_p.sourceEndpoint.connectorOverlays.length;i<j;i++)_p.overlays.push(_p.sourceEndpoint.connectorOverlays[i])}_p.sourceEndpoint&&_p.sourceEndpoint.scope&&(_p.scope=_p.sourceEndpoint.scope),!_p["pointer-events"]&&_p.sourceEndpoint&&_p.sourceEndpoint.connectorPointerEvents&&(_p["pointer-events"]=_p.sourceEndpoint.connectorPointerEvents);var _addEndpoint=function(el,def,idx){return _currentInstance.addEndpoint(el,function(def,values){var m=jsPlumb.extend({},def);for(var i in values)values[i]&&(m[i]=values[i]);return m}(def,{anchor:_p.anchors?_p.anchors[idx]:_p.anchor,endpoint:_p.endpoints?_p.endpoints[idx]:_p.endpoint,paintStyle:_p.endpointStyles?_p.endpointStyles[idx]:_p.endpointStyle,hoverPaintStyle:_p.endpointHoverStyles?_p.endpointHoverStyles[idx]:_p.endpointHoverStyle}))},_oneElementDef=function(type,idx,defs,matchType){if(_p[type]&&!_p[type].endpoint&&!_p[type+"Endpoint"]&&!_p.newConnection){var tep=defs[_getId(_p[type])];if(tep=tep?tep[matchType]:null){if(!tep.enabled)return!1;var newEndpoint=null!=tep.endpoint&&tep.endpoint._jsPlumb?tep.endpoint:_addEndpoint(_p[type],tep.def,idx);if(newEndpoint.isFull())return!1;_p[type+"Endpoint"]=newEndpoint,!_p.scope&&tep.def.scope&&(_p.scope=tep.def.scope),tep.uniqueEndpoint?tep.endpoint?newEndpoint.finalEndpoint=tep.endpoint:(tep.endpoint=newEndpoint).setDeleteOnEmpty(!1):newEndpoint.setDeleteOnEmpty(!0),0===idx&&tep.def.connectorOverlays&&(_p.overlays=_p.overlays||[],Array.prototype.push.apply(_p.overlays,tep.def.connectorOverlays))}}};if(!1!==_oneElementDef("source",0,this.sourceEndpointDefinitions,_p.type||"default")&&!1!==_oneElementDef("target",1,this.targetEndpointDefinitions,_p.type||"default"))return _p.sourceEndpoint&&_p.targetEndpoint&&(function(e1,e2){for(var s1=e1.scope.split(/\s/),s2=e2.scope.split(/\s/),i=0;i<s1.length;i++)for(var j=0;j<s2.length;j++)if(s2[j]===s1[i])return!0;return!1}(_p.sourceEndpoint,_p.targetEndpoint)||(_p=null)),_p}}.bind(_currentInstance),_newConnection=function(params){var connectionFunc=_currentInstance.Defaults.ConnectionType||_currentInstance.getDefaultConnectionType();params._jsPlumb=_currentInstance,params.newConnection=_newConnection,params.newEndpoint=_newEndpoint,params.endpointsByUUID=endpointsByUUID,params.endpointsByElement=endpointsByElement,params.finaliseConnection=_finaliseConnection,params.id="con_"+_idstamp();var con=new connectionFunc(params);return con.isDetachable()&&(con.endpoints[0].initDraggable("_jsPlumbSource"),con.endpoints[1].initDraggable("_jsPlumbTarget")),con},_finaliseConnection=_currentInstance.finaliseConnection=function(jpc,params,originalEvent,doInformAnchorManager){if(params=params||{},jpc.suspendedEndpoint||connections.push(jpc),jpc.pending=null,(jpc.endpoints[0].isTemporarySource=!1)!==doInformAnchorManager&&_currentInstance.anchorManager.newConnection(jpc),_draw(jpc.source),!params.doNotFireConnectionEvent&&!1!==params.fireEvent){var eventArgs={connection:jpc,source:jpc.source,target:jpc.target,sourceId:jpc.sourceId,targetId:jpc.targetId,sourceEndpoint:jpc.endpoints[0],targetEndpoint:jpc.endpoints[1]};_currentInstance.fire("connection",eventArgs,originalEvent)}},_newEndpoint=function(params,id){var endpointFunc=_currentInstance.Defaults.EndpointType||jsPlumb.Endpoint,_p=jsPlumb.extend({},params);_p._jsPlumb=_currentInstance,_p.newConnection=_newConnection,_p.newEndpoint=_newEndpoint,_p.endpointsByUUID=endpointsByUUID,_p.endpointsByElement=endpointsByElement,_p.fireDetachEvent=fireDetachEvent,_p.elementId=id||_getId(_p.source);var ep=new endpointFunc(_p);return ep.id="ep_"+_idstamp(),_manage(_p.elementId,_p.source),jsPlumb.headless||_currentInstance.getDragManager().endpointAdded(_p.source,id),ep},_operation=function(elId,func,endpointFunc){var endpoints=endpointsByElement[elId];if(endpoints&&endpoints.length)for(var i=0,ii=endpoints.length;i<ii;i++){for(var j=0,jj=endpoints[i].connections.length;j<jj;j++){if(func(endpoints[i].connections[j]))return}endpointFunc&&endpointFunc(endpoints[i])}},_setVisible=function(el,state,alsoChangeEndpoints){state="block"===state;var endpointFunc=null;alsoChangeEndpoints&&(endpointFunc=function(ep){ep.setVisible(state,!0,!0)});var info=_info(el);_operation(info.id,function(jpc){if(state&&alsoChangeEndpoints){var oidx=jpc.sourceId===info.id?1:0;jpc.endpoints[oidx].isVisible()&&jpc.setVisible(!0)}else jpc.setVisible(state)},endpointFunc)},_getId=function(element,uuid,doNotCreateIfNotFound){if(_ju.isString(element))return element;if(null==element)return null;var id=_currentInstance.getAttribute(element,"id");return id&&"undefined"!==id||(2===arguments.length&&void 0!==uuid?id=uuid:(1===arguments.length||3===arguments.length&&!doNotCreateIfNotFound)&&(id="jsPlumb_"+_instanceIndex+"_"+_idstamp()),doNotCreateIfNotFound||_currentInstance.setAttribute(element,"id",id)),id};this.setConnectionBeingDragged=function(v){connectionBeingDragged=v},this.isConnectionBeingDragged=function(){return connectionBeingDragged},this.getManagedElements=function(){return managedElements},this.connectorClass="jtk-connector",this.connectorOutlineClass="jtk-connector-outline",this.connectedClass="jtk-connected",this.hoverClass="jtk-hover",this.endpointClass="jtk-endpoint",this.endpointConnectedClass="jtk-endpoint-connected",this.endpointFullClass="jtk-endpoint-full",this.endpointDropAllowedClass="jtk-endpoint-drop-allowed",this.endpointDropForbiddenClass="jtk-endpoint-drop-forbidden",this.overlayClass="jtk-overlay",this.draggingClass="jtk-dragging",this.elementDraggingClass="jtk-element-dragging",this.sourceElementDraggingClass="jtk-source-element-dragging",this.targetElementDraggingClass="jtk-target-element-dragging",this.endpointAnchorClassPrefix="jtk-endpoint-anchor",this.hoverSourceClass="jtk-source-hover",this.hoverTargetClass="jtk-target-hover",this.dragSelectClass="jtk-drag-select",this.Anchors={},this.Connectors={svg:{}},this.Endpoints={svg:{}},this.Overlays={svg:{}},this.ConnectorRenderers={},this.SVG="svg",this.addEndpoint=function(el,params,referenceParams){referenceParams=referenceParams||{};var p=jsPlumb.extend({},referenceParams);jsPlumb.extend(p,params),p.endpoint=p.endpoint||_currentInstance.Defaults.Endpoint,p.paintStyle=p.paintStyle||_currentInstance.Defaults.EndpointStyle;for(var results=[],inputs=_ju.isArray(el)||null!=el.length&&!_ju.isString(el)?el:[el],i=0,j=inputs.length;i<j;i++){p.source=_currentInstance.getElement(inputs[i]),_ensureContainer(p.source);var id=_getId(p.source),e=_newEndpoint(p,id),myOffset=_manage(id,p.source).info.o;_ju.addToList(endpointsByElement,id,e),_suspendDrawing||e.paint({anchorLoc:e.anchor.compute({xy:[myOffset.left,myOffset.top],wh:sizes[id],element:e,timestamp:_suspendedAt}),timestamp:_suspendedAt}),results.push(e)}return 1===results.length?results[0]:results},this.addEndpoints=function(el,endpoints,referenceParams){for(var results=[],i=0,j=endpoints.length;i<j;i++){var e=_currentInstance.addEndpoint(el,endpoints[i],referenceParams);_ju.isArray(e)?Array.prototype.push.apply(results,e):results.push(e)}return results},this.animate=function(el,properties,options){if(!this.animationSupported)return!1;options=options||{};var del=_currentInstance.getElement(el),id=_getId(del),stepFunction=jsPlumb.animEvents.step,completeFunction=jsPlumb.animEvents.complete;options[stepFunction]=_ju.wrap(options[stepFunction],function(){_currentInstance.revalidate(id)}),options[completeFunction]=_ju.wrap(options[completeFunction],function(){_currentInstance.revalidate(id)}),_currentInstance.doAnimate(del,properties,options)},this.checkCondition=function(conditionName,args){var l=_currentInstance.getListener(conditionName),r=!0;if(l&&0<l.length){var values=Array.prototype.slice.call(arguments,1);try{for(var i=0,j=l.length;i<j;i++)r=r&&l[i].apply(l[i],values)}catch(e){_ju.log(_currentInstance,"cannot check condition ["+conditionName+"]"+e)}}return r},this.connect=function(params,referenceParams){var jpc,_p=_prepareConnectionParams(params,referenceParams);if(_p){if(null==_p.source&&null==_p.sourceEndpoint)return void _ju.log("Cannot establish connection - source does not exist");if(null==_p.target&&null==_p.targetEndpoint)return void _ju.log("Cannot establish connection - target does not exist");_ensureContainer(_p.source),jpc=_newConnection(_p),_finaliseConnection(jpc,_p)}return jpc};var stTypes=[{el:"source",elId:"sourceId",epDefs:"sourceEndpointDefinitions"},{el:"target",elId:"targetId",epDefs:"targetEndpointDefinitions"}],_set=function(c,el,idx,doNotRepaint){var ep,sid,sep,_st=stTypes[idx],cId=c[_st.elId],oldEndpoint=(c[_st.el],c.endpoints[idx]),evtParams={index:idx,originalSourceId:0===idx?cId:c.sourceId,newSourceId:c.sourceId,originalTargetId:1===idx?cId:c.targetId,newTargetId:c.targetId,connection:c};if(el.constructor===jsPlumb.Endpoint)(ep=el).addConnection(c),el=ep.element;else if(sid=_getId(el),sep=this[_st.epDefs][sid],sid===c[_st.elId])ep=null;else if(sep)for(var t in sep){if(!sep[t].enabled)return;ep=null!=sep[t].endpoint&&sep[t].endpoint._jsPlumb?sep[t].endpoint:this.addEndpoint(el,sep[t].def),sep[t].uniqueEndpoint&&(sep[t].endpoint=ep),ep.addConnection(c)}else ep=c.makeEndpoint(0===idx,el,sid);return null!=ep&&(oldEndpoint.detachFromConnection(c),c.endpoints[idx]=ep,c[_st.el]=ep.element,c[_st.elId]=ep.elementId,evtParams[0===idx?"newSourceId":"newTargetId"]=ep.elementId,fireMoveEvent(evtParams),doNotRepaint||c.repaint()),evtParams.element=el,evtParams}.bind(this);this.setSource=function(connection,el,doNotRepaint){var p=_set(connection,el,0,doNotRepaint);this.anchorManager.sourceChanged(p.originalSourceId,p.newSourceId,connection,p.el)},this.setTarget=function(connection,el,doNotRepaint){var p=_set(connection,el,1,doNotRepaint);this.anchorManager.updateOtherEndpoint(p.originalSourceId,p.originalTargetId,p.newTargetId,connection)},this.deleteEndpoint=function(object,dontUpdateHover,deleteAttachedObjects){var endpoint="string"==typeof object?endpointsByUUID[object]:object;return endpoint&&_currentInstance.deleteObject({endpoint:endpoint,dontUpdateHover:dontUpdateHover,deleteAttachedObjects:deleteAttachedObjects}),_currentInstance},this.deleteEveryEndpoint=function(){var _is=_currentInstance.setSuspendDrawing(!0);for(var id in endpointsByElement){var endpoints=endpointsByElement[id];if(endpoints&&endpoints.length)for(var i=0,j=endpoints.length;i<j;i++)_currentInstance.deleteEndpoint(endpoints[i],!0)}endpointsByElement={},managedElements={},endpointsByUUID={},offsets={},offsetTimestamps={},_currentInstance.anchorManager.reset();var dm=_currentInstance.getDragManager();return dm&&dm.reset(),_is||_currentInstance.setSuspendDrawing(!1),_currentInstance};var fireDetachEvent=function(jpc,doFireEvent,originalEvent){var connType=_currentInstance.Defaults.ConnectionType||_currentInstance.getDefaultConnectionType(),params=jpc.constructor===connType?{connection:jpc,source:jpc.source,target:jpc.target,sourceId:jpc.sourceId,targetId:jpc.targetId,sourceEndpoint:jpc.endpoints[0],targetEndpoint:jpc.endpoints[1]}:jpc;doFireEvent&&_currentInstance.fire("connectionDetached",params,originalEvent),_currentInstance.fire("internal.connectionDetached",params,originalEvent),_currentInstance.anchorManager.connectionDetached(params)},fireMoveEvent=_currentInstance.fireMoveEvent=function(params,evt){_currentInstance.fire("connectionMoved",params,evt)};this.unregisterEndpoint=function(endpoint){for(var e in endpoint._jsPlumb.uuid&&(endpointsByUUID[endpoint._jsPlumb.uuid]=null),_currentInstance.anchorManager.deleteEndpoint(endpoint),endpointsByElement){var endpoints=endpointsByElement[e];if(endpoints){for(var newEndpoints=[],i=0,j=endpoints.length;i<j;i++)endpoints[i]!==endpoint&&newEndpoints.push(endpoints[i]);endpointsByElement[e]=newEndpoints}endpointsByElement[e].length<1&&delete endpointsByElement[e]}};this.deleteConnection=function(connection,params){return!(null==connection||!(params=params||{}).force&&!_ju.functionChain(!0,!1,[[connection.endpoints[0],"isDetachAllowed",[connection]],[connection.endpoints[1],"isDetachAllowed",[connection]],[connection,"isDetachAllowed",[connection]],[_currentInstance,"checkCondition",["beforeDetach",connection]]]))&&(connection.setHover(!1),fireDetachEvent(connection,!connection.pending&&!1!==params.fireEvent,params.originalEvent),connection.endpoints[0].detachFromConnection(connection),connection.endpoints[1].detachFromConnection(connection),_ju.removeWithFunction(connections,function(_c){return connection.id===_c.id}),connection.cleanup(),connection.destroy(),!0)},this.deleteEveryConnection=function(params){params=params||{};var count=connections.length,deletedCount=0;return _currentInstance.batch(function(){for(var i=0;i<count;i++)deletedCount+=_currentInstance.deleteConnection(connections[0],params)?1:0}),deletedCount},this.deleteConnectionsForElement=function(el,params){params=params||{},el=_currentInstance.getElement(el);var id=_getId(el),endpoints=endpointsByElement[id];if(endpoints&&endpoints.length)for(var i=0,j=endpoints.length;i<j;i++)endpoints[i].deleteEveryConnection(params);return _currentInstance},this.deleteObject=function(params){var result={endpoints:{},connections:{},endpointCount:0,connectionCount:0},deleteAttachedObjects=!1!==params.deleteAttachedObjects,unravelConnection=function(connection){null!=connection&&null==result.connections[connection.id]&&(params.dontUpdateHover||null==connection._jsPlumb||connection.setHover(!1),result.connections[connection.id]=connection,result.connectionCount++)};for(var i in params.connection?unravelConnection(params.connection):function(endpoint){if(null!=endpoint&&null==result.endpoints[endpoint.id]&&(params.dontUpdateHover||null==endpoint._jsPlumb||endpoint.setHover(!1),result.endpoints[endpoint.id]=endpoint,result.endpointCount++,deleteAttachedObjects))for(var i=0;i<endpoint.connections.length;i++){var c=endpoint.connections[i];unravelConnection(c)}}(params.endpoint),result.connections){var c=result.connections[i];if(c._jsPlumb){_ju.removeWithFunction(connections,function(_c){return c.id===_c.id}),fireDetachEvent(c,!1!==params.fireEvent&&!c.pending,params.originalEvent);var doNotCleanup=null==params.deleteAttachedObjects?null:!params.deleteAttachedObjects;c.endpoints[0].detachFromConnection(c,null,doNotCleanup),c.endpoints[1].detachFromConnection(c,null,doNotCleanup),c.cleanup(!0),c.destroy(!0)}}for(var j in result.endpoints){var e=result.endpoints[j];e._jsPlumb&&(_currentInstance.unregisterEndpoint(e),e.cleanup(!0),e.destroy(!0))}return result},this.draggable=function(el,options){var info;return _each(function(_el){(info=_info(_el)).el&&function(element,isDraggable,dragOptions,id,fireEvent){if(!jsPlumb.headless&&null!=isDraggable&&isDraggable&&jsPlumb.isDragSupported(element,_currentInstance)){var options=dragOptions||_currentInstance.Defaults.DragOptions;if(options=jsPlumb.extend({},options),jsPlumb.isAlreadyDraggable(element,_currentInstance))dragOptions.force&&_currentInstance.initDraggable(element,options);else{var dragEvent=jsPlumb.dragEvents.drag,stopEvent=jsPlumb.dragEvents.stop,startEvent=jsPlumb.dragEvents.start,_started=!1;_manage(id,element),options[startEvent]=_ju.wrap(options[startEvent],function(){if(_currentInstance.setHoverSuspended(!0),_currentInstance.select({source:element}).addClass(_currentInstance.elementDraggingClass+" "+_currentInstance.sourceElementDraggingClass,!0),_currentInstance.select({target:element}).addClass(_currentInstance.elementDraggingClass+" "+_currentInstance.targetElementDraggingClass,!0),_currentInstance.setConnectionBeingDragged(!0),options.canDrag)return dragOptions.canDrag()},!1),options[dragEvent]=_ju.wrap(options[dragEvent],function(){var ui=_currentInstance.getUIPosition(arguments,_currentInstance.getZoom());null!=ui&&(_draw(element,ui,null,!0),_started&&_currentInstance.addClass(element,"jtk-dragged"),_started=!0)}),options[stopEvent]=_ju.wrap(options[stopEvent],function(){for(var uip,_e,elements=arguments[0].selection,i=0;i<elements.length;i++)null!=(_e=elements[i])[1]&&(uip=_currentInstance.getUIPosition([{el:_e[2].el,pos:[_e[1].left,_e[1].top]}]),_draw(_e[2].el,uip)),_currentInstance.removeClass(_e[0],"jtk-dragged"),_currentInstance.select({source:_e[2].el}).removeClass(_currentInstance.elementDraggingClass+" "+_currentInstance.sourceElementDraggingClass,!0),_currentInstance.select({target:_e[2].el}).removeClass(_currentInstance.elementDraggingClass+" "+_currentInstance.targetElementDraggingClass,!0),_currentInstance.getDragManager().dragEnded(_e[2].el);_started=!1,_currentInstance.setHoverSuspended(!1),_currentInstance.setConnectionBeingDragged(!1)});var elId=_getId(element);draggableStates[elId]=!0;var draggable=draggableStates[elId];options.disabled=null!=draggable&&!draggable,_currentInstance.initDraggable(element,options),_currentInstance.getDragManager().register(element),fireEvent&&_currentInstance.fire("elementDraggable",{el:element,options:options})}}}(info.el,!0,options,info.id,!0)},el),_currentInstance},this.droppable=function(el,options){var info;return(options=options||{}).allowLoopback=!1,_each(function(_el){(info=_info(_el)).el&&_currentInstance.initDroppable(info.el,options)},el),_currentInstance};var setter=function(list,func,selector){return function(){return function(list,func,args,selector){for(var i=0,j=list.length;i<j;i++)list[i][func].apply(list[i],args);return selector(list)}(list,func,arguments,selector)}},getter=function(list,func){return function(){return function(list,func,args){for(var out=[],i=0,j=list.length;i<j;i++)out.push([list[i][func].apply(list[i],args),list[i]]);return out}(list,func,arguments)}},prepareList=function(input,doNotGetIds){var r=[];if(input)if("string"==typeof input){if("*"===input)return input;r.push(input)}else if(doNotGetIds)r=input;else if(input.length)for(var i=0,j=input.length;i<j;i++)r.push(_info(input[i]).id);else r.push(_info(input).id);return r},filterList=function(list,value,missingIsFalse){return"*"===list||(0<list.length?-1!==list.indexOf(value):!missingIsFalse)};this.getConnections=function(options,flat){options?options.constructor===String&&(options={scope:options}):options={};for(var scope=options.scope||_currentInstance.getDefaultScope(),scopes=prepareList(scope,!0),sources=prepareList(options.source),targets=prepareList(options.target),results=!flat&&1<scopes.length?{}:[],_addOne=function(scope,obj){if(!flat&&1<scopes.length){var ss=results[scope];null==ss&&(ss=results[scope]=[]),ss.push(obj)}else results.push(obj)},j=0,jj=connections.length;j<jj;j++){var c=connections[j],sourceId=c.proxies&&c.proxies[0]?c.proxies[0].originalEp.elementId:c.sourceId,targetId=c.proxies&&c.proxies[1]?c.proxies[1].originalEp.elementId:c.targetId;filterList(scopes,c.scope)&&filterList(sources,sourceId)&&filterList(targets,targetId)&&_addOne(c.scope,c)}return results};var _makeCommonSelectHandler=function(list,executor){var i,ii,out={length:list.length,each:function(list,executor){return function(f){for(var i=0,ii=list.length;i<ii;i++)f(list[i]);return executor(list)}}(list,executor),get:function(list){return function(idx){return list[idx]}}(list)},setters=["setHover","removeAllOverlays","setLabel","addClass","addOverlay","removeOverlay","removeOverlays","showOverlay","hideOverlay","showOverlays","hideOverlays","setPaintStyle","setHoverPaintStyle","setSuspendEvents","setParameter","setParameters","setVisible","repaint","addType","toggleType","removeType","removeClass","setType","bind","unbind"],getters=["getLabel","getOverlay","isHover","getParameter","getParameters","getPaintStyle","getHoverPaintStyle","isVisible","hasType","getType","isSuspendEvents"];for(i=0,ii=setters.length;i<ii;i++)out[setters[i]]=setter(list,setters[i],executor);for(i=0,ii=getters.length;i<ii;i++)out[getters[i]]=getter(list,getters[i]);return out},_makeConnectionSelectHandler=function(list){var common=_makeCommonSelectHandler(list,_makeConnectionSelectHandler);return jsPlumb.extend(common,{setDetachable:setter(list,"setDetachable",_makeConnectionSelectHandler),setReattach:setter(list,"setReattach",_makeConnectionSelectHandler),setConnector:setter(list,"setConnector",_makeConnectionSelectHandler),delete:function(){for(var i=0,ii=list.length;i<ii;i++)_currentInstance.deleteConnection(list[i])},isDetachable:getter(list,"isDetachable"),isReattach:getter(list,"isReattach")})},_makeEndpointSelectHandler=function(list){var common=_makeCommonSelectHandler(list,_makeEndpointSelectHandler);return jsPlumb.extend(common,{setEnabled:setter(list,"setEnabled",_makeEndpointSelectHandler),setAnchor:setter(list,"setAnchor",_makeEndpointSelectHandler),isEnabled:getter(list,"isEnabled"),deleteEveryConnection:function(){for(var i=0,ii=list.length;i<ii;i++)list[i].deleteEveryConnection()},delete:function(){for(var i=0,ii=list.length;i<ii;i++)_currentInstance.deleteEndpoint(list[i])}})};this.select=function(params){return(params=params||{}).scope=params.scope||"*",_makeConnectionSelectHandler(params.connections||_currentInstance.getConnections(params,!0))},this.selectEndpoints=function(params){(params=params||{}).scope=params.scope||"*";var noElementFilters=!params.element&&!params.source&&!params.target,elements=noElementFilters?"*":prepareList(params.element),sources=noElementFilters?"*":prepareList(params.source),targets=noElementFilters?"*":prepareList(params.target),scopes=prepareList(params.scope,!0),ep=[];for(var el in endpointsByElement){var either=filterList(elements,el,!0),source=filterList(sources,el,!0),sourceMatchExact="*"!==sources,target=filterList(targets,el,!0),targetMatchExact="*"!==targets;if(either||source||target)inner:for(var i=0,ii=endpointsByElement[el].length;i<ii;i++){var _ep=endpointsByElement[el][i];if(filterList(scopes,_ep.scope,!0)){var noMatchSource=sourceMatchExact&&0<sources.length&&!_ep.isSource,noMatchTarget=targetMatchExact&&0<targets.length&&!_ep.isTarget;if(noMatchSource||noMatchTarget)continue inner;ep.push(_ep)}}}return _makeEndpointSelectHandler(ep)},this.getAllConnections=function(){return connections},this.getDefaultScope=function(){return DEFAULT_SCOPE},this.getEndpoint=_getEndpoint,this.getEndpoints=function(el){return endpointsByElement[_info(el).id]||[]},this.getDefaultEndpointType=function(){return jsPlumb.Endpoint},this.getDefaultConnectionType=function(){return jsPlumb.Connection},this.getId=_getId,this.appendElement=_appendElement;var _hoverSuspended=!1;this.isHoverSuspended=function(){return _hoverSuspended},this.setHoverSuspended=function(s){_hoverSuspended=s},this.hide=function(el,changeEndpoints){return _setVisible(el,"none",changeEndpoints),_currentInstance},this.idstamp=_idstamp;var _ensureContainer=function(candidate){if(!_container&&candidate){var can=_currentInstance.getElement(candidate);can.offsetParent&&_currentInstance.setContainer(can.offsetParent)}},_manage=_currentInstance.manage=function(id,element,_transient){return managedElements[id]||(managedElements[id]={el:element,endpoints:[],connections:[]},managedElements[id].info=_updateOffset({elId:id,timestamp:_suspendedAt}),_transient||_currentInstance.fire("manageElement",{id:id,info:managedElements[id].info,el:element})),managedElements[id]},_updateOffset=function(params){var s,timestamp=params.timestamp,recalc=params.recalc,offset=params.offset,elId=params.elId;return _suspendDrawing&&!timestamp&&(timestamp=_suspendedAt),!recalc&&timestamp&&timestamp===offsetTimestamps[elId]?{o:params.offset||offsets[elId],s:sizes[elId]}:(recalc||!offset&&null==offsets[elId]?null!=(s=managedElements[elId]?managedElements[elId].el:null)&&(sizes[elId]=_currentInstance.getSize(s),offsets[elId]=_currentInstance.getOffset(s),offsetTimestamps[elId]=timestamp):(offsets[elId]=offset||offsets[elId],null==sizes[elId]&&null!=(s=managedElements[elId].el)&&(sizes[elId]=_currentInstance.getSize(s)),offsetTimestamps[elId]=timestamp),offsets[elId]&&!offsets[elId].right&&(offsets[elId].right=offsets[elId].left+sizes[elId][0],offsets[elId].bottom=offsets[elId].top+sizes[elId][1],offsets[elId].width=sizes[elId][0],offsets[elId].height=sizes[elId][1],offsets[elId].centerx=offsets[elId].left+offsets[elId].width/2,offsets[elId].centery=offsets[elId].top+offsets[elId].height/2),{o:offsets[elId],s:sizes[elId]})};this.updateOffset=_updateOffset,this.init=function(){initialized||(_currentInstance.Defaults.Container&&_currentInstance.setContainer(_currentInstance.Defaults.Container),_currentInstance.anchorManager=new root.jsPlumb.AnchorManager({jsPlumbInstance:_currentInstance}),initialized=!0,_currentInstance.fire("ready",_currentInstance))}.bind(this),this.log=log,this.jsPlumbUIComponent=jsPlumbUIComponent,this.makeAnchor=function(){var pp,_a=function(t,p){if(root.jsPlumb.Anchors[t])return new root.jsPlumb.Anchors[t](p);if(!_currentInstance.Defaults.DoNotThrowErrors)throw{msg:"jsPlumb: unknown anchor type '"+t+"'"}};if(0===arguments.length)return null;var specimen=arguments[0],elementId=arguments[1],newAnchor=(arguments[2],null);if(specimen.compute&&specimen.getOrientation)return specimen;if("string"==typeof specimen)newAnchor=_a(arguments[0],{elementId:elementId,jsPlumbInstance:_currentInstance});else if(_ju.isArray(specimen))if(_ju.isArray(specimen[0])||_ju.isString(specimen[0]))newAnchor=2===specimen.length&&_ju.isObject(specimen[1])?_ju.isString(specimen[0])?(pp=root.jsPlumb.extend({elementId:elementId,jsPlumbInstance:_currentInstance},specimen[1]),_a(specimen[0],pp)):(pp=root.jsPlumb.extend({elementId:elementId,jsPlumbInstance:_currentInstance,anchors:specimen[0]},specimen[1]),new root.jsPlumb.DynamicAnchor(pp)):new jsPlumb.DynamicAnchor({anchors:specimen,selector:null,elementId:elementId,jsPlumbInstance:_currentInstance});else{var anchorParams={x:specimen[0],y:specimen[1],orientation:4<=specimen.length?[specimen[2],specimen[3]]:[0,0],offsets:6<=specimen.length?[specimen[4],specimen[5]]:[0,0],elementId:elementId,jsPlumbInstance:_currentInstance,cssClass:7===specimen.length?specimen[6]:null};(newAnchor=new root.jsPlumb.Anchor(anchorParams)).clone=function(){return new root.jsPlumb.Anchor(anchorParams)}}return newAnchor.id||(newAnchor.id="anchor_"+_idstamp()),newAnchor},this.makeAnchors=function(types,elementId,jsPlumbInstance){for(var r=[],i=0,ii=types.length;i<ii;i++)"string"==typeof types[i]?r.push(root.jsPlumb.Anchors[types[i]]({elementId:elementId,jsPlumbInstance:jsPlumbInstance})):_ju.isArray(types[i])&&r.push(_currentInstance.makeAnchor(types[i],elementId,jsPlumbInstance));return r},this.makeDynamicAnchor=function(anchors,anchorSelector){return new root.jsPlumb.DynamicAnchor({anchors:anchors,selector:anchorSelector,elementId:null,jsPlumbInstance:_currentInstance})},this.targetEndpointDefinitions={},this.sourceEndpointDefinitions={};var _makeElementDropHandler=function(elInfo,p,dropOptions,isSource,isTarget){var proxyComponent=new jsPlumbUIComponent(p),_drop=p._jsPlumb.EndpointDropHandler({jsPlumb:_currentInstance,enabled:function(){return elInfo.def.enabled},isFull:function(){var targetCount=_currentInstance.select({target:elInfo.id}).length;return 0<elInfo.def.maxConnections&&targetCount>=elInfo.def.maxConnections},element:elInfo.el,elementId:elInfo.id,isSource:isSource,isTarget:isTarget,addClass:function(clazz){_currentInstance.addClass(elInfo.el,clazz)},removeClass:function(clazz){_currentInstance.removeClass(elInfo.el,clazz)},onDrop:function(jpc){jpc.endpoints[0].anchor.unlock()},isDropAllowed:function(){return proxyComponent.isDropAllowed.apply(proxyComponent,arguments)},isRedrop:function(jpc){return null!=jpc.suspendedElement&&null!=jpc.suspendedEndpoint&&jpc.suspendedEndpoint.element===elInfo.el},getEndpoint:function(jpc){var newEndpoint=elInfo.def.endpoint;if(null==newEndpoint||null==newEndpoint._jsPlumb){var eps=_currentInstance.deriveEndpointAndAnchorSpec(jpc.getType().join(" "),!0),pp=eps.endpoints?root.jsPlumb.extend(p,{endpoint:elInfo.def.def.endpoint||eps.endpoints[1]}):p;eps.anchors&&(pp=root.jsPlumb.extend(pp,{anchor:elInfo.def.def.anchor||eps.anchors[1]})),(newEndpoint=_currentInstance.addEndpoint(elInfo.el,pp))._mtNew=!0}if(p.uniqueEndpoint&&(elInfo.def.endpoint=newEndpoint),newEndpoint.setDeleteOnEmpty(!0),jpc.isDetachable()&&newEndpoint.initDraggable(),null!=newEndpoint.anchor.positionFinder){var dropPosition=_currentInstance.getUIPosition(arguments,_currentInstance.getZoom()),elPosition=_currentInstance.getOffset(elInfo.el),elSize=_currentInstance.getSize(elInfo.el),ap=null==dropPosition?[0,0]:newEndpoint.anchor.positionFinder(dropPosition,elPosition,elSize,newEndpoint.anchor.constructorParams);newEndpoint.anchor.x=ap[0],newEndpoint.anchor.y=ap[1]}return newEndpoint},maybeCleanup:function(ep){ep._mtNew&&0===ep.connections.length?_currentInstance.deleteObject({endpoint:ep}):delete ep._mtNew}}),dropEvent=root.jsPlumb.dragEvents.drop;return dropOptions.scope=dropOptions.scope||p.scope||_currentInstance.Defaults.Scope,dropOptions[dropEvent]=_ju.wrap(dropOptions[dropEvent],_drop,!0),dropOptions.rank=p.rank||0,isTarget&&(dropOptions[root.jsPlumb.dragEvents.over]=function(){return!0}),!1===p.allowLoopback&&(dropOptions.canDrop=function(_drag){return _drag.getDragElement()._jsPlumbRelatedElement!==elInfo.el}),_currentInstance.initDroppable(elInfo.el,dropOptions,"internal"),_drop};this.makeTarget=function(el,params,referenceParams){var p=root.jsPlumb.extend({_jsPlumb:this},referenceParams);root.jsPlumb.extend(p,params);for(var maxConnections=p.maxConnections||-1,_doOne=function(el){var elInfo=_info(el),elid=elInfo.id,dropOptions=root.jsPlumb.extend({},p.dropOptions||{}),type=p.connectionType||"default";this.targetEndpointDefinitions[elid]=this.targetEndpointDefinitions[elid]||{},_ensureContainer(elid),elInfo.el._isJsPlumbGroup&&null==dropOptions.rank&&(dropOptions.rank=-1);var _def={def:root.jsPlumb.extend({},p),uniqueEndpoint:p.uniqueEndpoint,maxConnections:maxConnections,enabled:!0};p.createEndpoint&&(_def.uniqueEndpoint=!0,_def.endpoint=_currentInstance.addEndpoint(el,_def.def),_def.endpoint.setDeleteOnEmpty(!1)),elInfo.def=_def,this.targetEndpointDefinitions[elid][type]=_def,_makeElementDropHandler(elInfo,p,dropOptions,!0===p.isSource,!0),elInfo.el._katavorioDrop[elInfo.el._katavorioDrop.length-1].targetDef=_def}.bind(this),inputs=el.length&&el.constructor!==String?el:[el],i=0,ii=inputs.length;i<ii;i++)_doOne(inputs[i]);return this},this.unmakeTarget=function(el,doNotClearArrays){var info=_info(el);return _currentInstance.destroyDroppable(info.el,"internal"),doNotClearArrays||delete this.targetEndpointDefinitions[info.id],this},this.makeSource=function(el,params,referenceParams){var p=root.jsPlumb.extend({_jsPlumb:this},referenceParams);root.jsPlumb.extend(p,params);var type=p.connectionType||"default",aae=_currentInstance.deriveEndpointAndAnchorSpec(type);p.endpoint=p.endpoint||aae.endpoints[0],p.anchor=p.anchor||aae.anchors[0];for(var maxConnections=p.maxConnections||-1,onMaxConnections=p.onMaxConnections,_doOne=function(elInfo){var elid=elInfo.id,_del=this.getElement(elInfo.el);this.sourceEndpointDefinitions[elid]=this.sourceEndpointDefinitions[elid]||{},_ensureContainer(elid);var _def={def:root.jsPlumb.extend({},p),uniqueEndpoint:p.uniqueEndpoint,maxConnections:maxConnections,enabled:!0};p.createEndpoint&&(_def.uniqueEndpoint=!0,_def.endpoint=_currentInstance.addEndpoint(el,_def.def),_def.endpoint.setDeleteOnEmpty(!1)),this.sourceEndpointDefinitions[elid][type]=_def,elInfo.def=_def;var stopEvent=root.jsPlumb.dragEvents.stop,dragEvent=root.jsPlumb.dragEvents.drag,dragOptions=root.jsPlumb.extend({},p.dragOptions||{}),existingDrag=dragOptions.drag,existingStop=dragOptions.stop,ep=null,endpointAddedButNoDragYet=!1;dragOptions.scope=dragOptions.scope||p.scope,dragOptions[dragEvent]=_ju.wrap(dragOptions[dragEvent],function(){existingDrag&&existingDrag.apply(this,arguments),endpointAddedButNoDragYet=!1}),dragOptions[stopEvent]=_ju.wrap(dragOptions[stopEvent],function(){if(existingStop&&existingStop.apply(this,arguments),this.currentlyDragging=!1,null!=ep._jsPlumb){var anchorDef=p.anchor||this.Defaults.Anchor,oldAnchor=ep.anchor,oldConnection=ep.connections[0],newAnchor=this.makeAnchor(anchorDef,elid,this),_el=ep.element;if(null!=newAnchor.positionFinder){var elPosition=_currentInstance.getOffset(_el),elSize=this.getSize(_el),dropPosition={left:elPosition.left+oldAnchor.x*elSize[0],top:elPosition.top+oldAnchor.y*elSize[1]},ap=newAnchor.positionFinder(dropPosition,elPosition,elSize,newAnchor.constructorParams);newAnchor.x=ap[0],newAnchor.y=ap[1]}ep.setAnchor(newAnchor,!0),ep.repaint(),this.repaint(ep.elementId),null!=oldConnection&&this.repaint(oldConnection.targetId)}}.bind(this));var mouseDownListener=function(e){if(3!==e.which&&2!==e.button){var def=this.sourceEndpointDefinitions[elid][type];if(def.enabled){if(elid=this.getId(this.getElement(elInfo.el)),p.filter)if(!1===(_ju.isString(p.filter)?function(evt,_el,selector,_instance,negate){for(var t=evt.target||evt.srcElement,ok=!1,sel=_instance.getSelector(_el,selector),j=0;j<sel.length;j++)if(sel[j]===t){ok=!0;break}return negate?!ok:ok}(e,elInfo.el,p.filter,this,p.filterExclude):p.filter(e,elInfo.el)))return;var sourceCount=this.select({source:elid}).length;if(0<=def.maxConnections&&sourceCount>=def.maxConnections)return onMaxConnections&&onMaxConnections({element:elInfo.el,maxConnections:maxConnections},e),!1;var elxy=root.jsPlumb.getPositionOnElement(e,_del,_zoom),tempEndpointParams={};root.jsPlumb.extend(tempEndpointParams,p),tempEndpointParams.isTemporarySource=!0,tempEndpointParams.anchor=[elxy[0],elxy[1],0,0],tempEndpointParams.dragOptions=dragOptions,def.def.scope&&(tempEndpointParams.scope=def.def.scope),ep=this.addEndpoint(elid,tempEndpointParams),endpointAddedButNoDragYet=!0,ep.setDeleteOnEmpty(!0),def.uniqueEndpoint&&(def.endpoint?ep.finalEndpoint=def.endpoint:(def.endpoint=ep).setDeleteOnEmpty(!1));var _delTempEndpoint=function(){_currentInstance.off(ep.canvas,"mouseup",_delTempEndpoint),_currentInstance.off(elInfo.el,"mouseup",_delTempEndpoint),endpointAddedButNoDragYet&&(endpointAddedButNoDragYet=!1,_currentInstance.deleteEndpoint(ep))};_currentInstance.on(ep.canvas,"mouseup",_delTempEndpoint),_currentInstance.on(elInfo.el,"mouseup",_delTempEndpoint);var payload={};if(def.def.extract)for(var att in def.def.extract){var v=(e.srcElement||e.target).getAttribute(att);v&&(payload[def.def.extract[att]]=v)}_currentInstance.trigger(ep.canvas,"mousedown",e,payload),_ju.consume(e)}}}.bind(this);this.on(elInfo.el,"mousedown",mouseDownListener),_def.trigger=mouseDownListener,p.filter&&(_ju.isString(p.filter)||_ju.isFunction(p.filter))&&_currentInstance.setDragFilter(elInfo.el,p.filter);var dropOptions=root.jsPlumb.extend({},p.dropOptions||{});_makeElementDropHandler(elInfo,p,dropOptions,!0,!0===p.isTarget)}.bind(this),inputs=el.length&&el.constructor!==String?el:[el],i=0,ii=inputs.length;i<ii;i++)_doOne(_info(inputs[i]));return this},this.unmakeSource=function(el,connectionType,doNotClearArrays){var info=_info(el);_currentInstance.destroyDroppable(info.el,"internal");var eldefs=this.sourceEndpointDefinitions[info.id];if(eldefs)for(var def in eldefs)if(null==connectionType||connectionType===def){var mouseDownListener=eldefs[def].trigger;mouseDownListener&&_currentInstance.off(info.el,"mousedown",mouseDownListener),doNotClearArrays||delete this.sourceEndpointDefinitions[info.id][def]}return this},this.unmakeEverySource=function(){for(var i in this.sourceEndpointDefinitions)_currentInstance.unmakeSource(i,null,!0);return this.sourceEndpointDefinitions={},this};var _getScope=function(el,types,connectionType){types=_ju.isArray(types)?types:[types];var id=_getId(el);connectionType=connectionType||"default";for(var i=0;i<types.length;i++){var eldefs=this[types[i]][id];if(eldefs&&eldefs[connectionType])return eldefs[connectionType].def.scope||this.Defaults.Scope}}.bind(this),_setScope=function(el,scope,types,connectionType){types=_ju.isArray(types)?types:[types];var id=_getId(el);connectionType=connectionType||"default";for(var i=0;i<types.length;i++){var eldefs=this[types[i]][id];eldefs&&eldefs[connectionType]&&(eldefs[connectionType].def.scope=scope)}}.bind(this);this.getScope=function(el,scope){return _getScope(el,["sourceEndpointDefinitions","targetEndpointDefinitions"])},this.getSourceScope=function(el){return _getScope(el,"sourceEndpointDefinitions")},this.getTargetScope=function(el){return _getScope(el,"targetEndpointDefinitions")},this.setScope=function(el,scope,connectionType){this.setSourceScope(el,scope,connectionType),this.setTargetScope(el,scope,connectionType)},this.setSourceScope=function(el,scope,connectionType){_setScope(el,scope,"sourceEndpointDefinitions",connectionType),this.setDragScope(el,scope)},this.setTargetScope=function(el,scope,connectionType){_setScope(el,scope,"targetEndpointDefinitions",connectionType),this.setDropScope(el,scope)},this.unmakeEveryTarget=function(){for(var i in this.targetEndpointDefinitions)_currentInstance.unmakeTarget(i,!0);return this.targetEndpointDefinitions={},this};var _setEnabled=function(type,el,state,toggle,connectionType){var originalState,info,newState,a="source"===type?this.sourceEndpointDefinitions:this.targetEndpointDefinitions;if(connectionType=connectionType||"default",el.length&&!_ju.isString(el)){originalState=[];for(var i=0,ii=el.length;i<ii;i++)a[(info=_info(el[i])).id]&&a[info.id][connectionType]&&(originalState[i]=a[info.id][connectionType].enabled,newState=toggle?!originalState[i]:state,a[info.id][connectionType].enabled=newState,_currentInstance[newState?"removeClass":"addClass"](info.el,"jtk-"+type+"-disabled"))}else{var id=(info=_info(el)).id;a[id]&&a[id][connectionType]&&(originalState=a[id][connectionType].enabled,newState=toggle?!originalState:state,a[id][connectionType].enabled=newState,_currentInstance[newState?"removeClass":"addClass"](info.el,"jtk-"+type+"-disabled"))}return originalState}.bind(this),_first=function(el,fn){return _ju.isString(el)||!el.length?fn.apply(this,[el]):el.length?fn.apply(this,[el[0]]):void 0}.bind(this);this.toggleSourceEnabled=function(el,connectionType){return _setEnabled("source",el,null,!0,connectionType),this.isSourceEnabled(el,connectionType)},this.setSourceEnabled=function(el,state,connectionType){return _setEnabled("source",el,state,null,connectionType)},this.isSource=function(el,connectionType){return connectionType=connectionType||"default",_first(el,function(_el){var eldefs=this.sourceEndpointDefinitions[_info(_el).id];return null!=eldefs&&null!=eldefs[connectionType]}.bind(this))},this.isSourceEnabled=function(el,connectionType){return connectionType=connectionType||"default",_first(el,function(_el){var sep=this.sourceEndpointDefinitions[_info(_el).id];return sep&&sep[connectionType]&&!0===sep[connectionType].enabled}.bind(this))},this.toggleTargetEnabled=function(el,connectionType){return _setEnabled("target",el,null,!0,connectionType),this.isTargetEnabled(el,connectionType)},this.isTarget=function(el,connectionType){return connectionType=connectionType||"default",_first(el,function(_el){var eldefs=this.targetEndpointDefinitions[_info(_el).id];return null!=eldefs&&null!=eldefs[connectionType]}.bind(this))},this.isTargetEnabled=function(el,connectionType){return connectionType=connectionType||"default",_first(el,function(_el){var tep=this.targetEndpointDefinitions[_info(_el).id];return tep&&tep[connectionType]&&!0===tep[connectionType].enabled}.bind(this))},this.setTargetEnabled=function(el,state,connectionType){return _setEnabled("target",el,state,null,connectionType)},this.ready=function(fn){_currentInstance.bind("ready",fn)};var _elEach=function(el,fn){if("object"==typeof el&&el.length)for(var i=0,ii=el.length;i<ii;i++)fn(el[i]);else fn(el);return _currentInstance};this.repaint=function(el,ui,timestamp){return _elEach(el,function(_el){_draw(_el,ui,timestamp)})},this.revalidate=function(el,timestamp,isIdAlready){return _elEach(el,function(_el){var elId=isIdAlready?_el:_currentInstance.getId(_el);_currentInstance.updateOffset({elId:elId,recalc:!0,timestamp:timestamp});var dm=_currentInstance.getDragManager();dm&&dm.updateOffsets(elId),_currentInstance.repaint(_el)})},this.repaintEverything=function(){var elId,timestamp=_timestamp();for(elId in endpointsByElement)_currentInstance.updateOffset({elId:elId,recalc:!0,timestamp:timestamp});for(elId in endpointsByElement)_draw(elId,null,timestamp);return this},this.removeAllEndpoints=function(el,recurse,affectedElements){affectedElements=affectedElements||[];var _one=function(_el){var i,ii,info=_info(_el),ebe=endpointsByElement[info.id];if(ebe)for(affectedElements.push(info),i=0,ii=ebe.length;i<ii;i++)_currentInstance.deleteEndpoint(ebe[i],!1);if(delete endpointsByElement[info.id],recurse&&info.el&&3!==info.el.nodeType&&8!==info.el.nodeType)for(i=0,ii=info.el.childNodes.length;i<ii;i++)_one(info.el.childNodes[i])};return _one(el),this};var _doRemove=function(info,affectedElements){_currentInstance.removeAllEndpoints(info.id,!0,affectedElements);for(var dm=_currentInstance.getDragManager(),_one=function(_info){dm&&dm.elementRemoved(_info.id),_currentInstance.anchorManager.clearFor(_info.id),_currentInstance.anchorManager.removeFloatingConnection(_info.id),_currentInstance.isSource(_info.el)&&_currentInstance.unmakeSource(_info.el),_currentInstance.isTarget(_info.el)&&_currentInstance.unmakeTarget(_info.el),_currentInstance.destroyDraggable(_info.el),_currentInstance.destroyDroppable(_info.el),delete _currentInstance.floatingConnections[_info.id],delete managedElements[_info.id],delete offsets[_info.id],_info.el&&(_currentInstance.removeElement(_info.el),_info.el._jsPlumb=null)},ae=1;ae<affectedElements.length;ae++)_one(affectedElements[ae]);_one(info)};this.remove=function(el,doNotRepaint){var info=_info(el),affectedElements=[];return info.text?info.el.parentNode.removeChild(info.el):info.id&&_currentInstance.batch(function(){_doRemove(info,affectedElements)},!0===doNotRepaint),_currentInstance},this.empty=function(el,doNotRepaint){var affectedElements=[],_one=function(el,dontRemoveFocus){var info=_info(el);if(info.text)info.el.parentNode.removeChild(info.el);else if(info.el){for(;0<info.el.childNodes.length;)_one(info.el.childNodes[0]);dontRemoveFocus||_doRemove(info,affectedElements)}};return _currentInstance.batch(function(){_one(el,!0)},!1===doNotRepaint),_currentInstance},this.reset=function(doNotUnbindInstanceEventListeners){_currentInstance.silently(function(){_hoverSuspended=!1,_currentInstance.removeAllGroups(),_currentInstance.removeGroupManager(),_currentInstance.deleteEveryEndpoint(),doNotUnbindInstanceEventListeners||_currentInstance.unbind(),this.targetEndpointDefinitions={},this.sourceEndpointDefinitions={},connections.length=0,this.doReset&&this.doReset()}.bind(this))};var _clearObject=function(obj){obj.canvas&&obj.canvas.parentNode&&obj.canvas.parentNode.removeChild(obj.canvas),obj.cleanup(),obj.destroy()};this.clear=function(){_currentInstance.select().each(_clearObject),_currentInstance.selectEndpoints().each(_clearObject),endpointsByElement={},endpointsByUUID={}},this.setDefaultScope=function(scope){return DEFAULT_SCOPE=scope,_currentInstance},this.setDraggable=function(element,draggable){return jsPlumb.each(element,function(el){_currentInstance.isDragSupported(el)&&(draggableStates[_currentInstance.getAttribute(el,"id")]=draggable,_currentInstance.setElementDraggable(el,draggable))})},this.deriveEndpointAndAnchorSpec=function(type,dontPrependDefault){for(var bits=((dontPrependDefault?"":"default ")+type).split(/[\s]/),eps=null,ep=null,a=null,as=null,i=0;i<bits.length;i++){var _t=_currentInstance.getType(bits[i],"connection");_t&&(_t.endpoints&&(eps=_t.endpoints),_t.endpoint&&(ep=_t.endpoint),_t.anchors&&(as=_t.anchors),_t.anchor&&(a=_t.anchor))}return{endpoints:eps||[ep,ep],anchors:as||[a,a]}},this.setId=function(el,newId,doNotSetAttribute){var id;id=_ju.isString(el)?el:(el=this.getElement(el),this.getId(el));var sConns=this.getConnections({source:id,scope:"*"},!0),tConns=this.getConnections({target:id,scope:"*"},!0);newId=""+newId,doNotSetAttribute?el=this.getElement(newId):(el=this.getElement(id),this.setAttribute(el,"id",newId)),endpointsByElement[newId]=endpointsByElement[id]||[];for(var i=0,ii=endpointsByElement[newId].length;i<ii;i++)endpointsByElement[newId][i].setElementId(newId),endpointsByElement[newId][i].setReferenceElement(el);delete endpointsByElement[id],this.sourceEndpointDefinitions[newId]=this.sourceEndpointDefinitions[id],delete this.sourceEndpointDefinitions[id],this.targetEndpointDefinitions[newId]=this.targetEndpointDefinitions[id],delete this.targetEndpointDefinitions[id],this.anchorManager.changeId(id,newId);var dm=this.getDragManager();dm&&dm.changeId(id,newId),managedElements[newId]=managedElements[id],delete managedElements[id];var _conns=function(list,epIdx,type){for(var i=0,ii=list.length;i<ii;i++)list[i].endpoints[epIdx].setElementId(newId),list[i].endpoints[epIdx].setReferenceElement(el),list[i][type+"Id"]=newId,list[i][type]=el};_conns(sConns,0,"source"),_conns(tConns,1,"target"),this.repaint(newId)},this.setDebugLog=function(debugLog){log=debugLog},this.setSuspendDrawing=function(val,repaintAfterwards){var curVal=_suspendDrawing;return _suspendedAt=(_suspendDrawing=val)?(new Date).getTime():null,repaintAfterwards&&this.repaintEverything(),curVal},this.isSuspendDrawing=function(){return _suspendDrawing},this.getSuspendedAt=function(){return _suspendedAt},this.batch=function(fn,doNotRepaintAfterwards){var _wasSuspended=this.isSuspendDrawing();_wasSuspended||this.setSuspendDrawing(!0);try{fn()}catch(e){_ju.log("Function run while suspended failed",e)}_wasSuspended||this.setSuspendDrawing(!1,!doNotRepaintAfterwards)},this.doWhileSuspended=this.batch,this.getCachedData=function(elId){var o=offsets[elId];return o?{o:o,s:sizes[elId]}:_updateOffset({elId:elId})},this.timestamp=_timestamp,this.show=function(el,changeEndpoints){return _setVisible(el,"block",changeEndpoints),_currentInstance},this.toggleVisible=function(elId,changeEndpoints){var endpointFunc=null;changeEndpoints&&(endpointFunc=function(ep){var state=ep.isVisible();ep.setVisible(!state)}),_operation(elId,function(jpc){var state=jpc.isVisible();jpc.setVisible(!state)},endpointFunc)},this.toggleDraggable=function(el){var state;return jsPlumb.each(el,function(el){var elId=_currentInstance.getAttribute(el,"id");return state=!(state=null!=draggableStates[elId]&&draggableStates[elId]),draggableStates[elId]=state,_currentInstance.setDraggable(el,state),state}.bind(this)),state},this.addListener=this.bind;var floatingConnections=[];this.registerFloatingConnection=function(info,conn,ep){floatingConnections[info.id]=conn,_ju.addToList(endpointsByElement,info.id,ep)},this.getFloatingConnectionFor=function(id){return floatingConnections[id]}};_ju.extend(root.jsPlumbInstance,_ju.EventGenerator,{setAttribute:function(el,a,v){this.setAttribute(el,a,v)},getAttribute:function(el,a){return this.getAttribute(root.jsPlumb.getElement(el),a)},convertToFullOverlaySpec:function(spec){return _ju.isString(spec)&&(spec=[spec,{}]),spec[1].id=spec[1].id||_ju.uuid(),spec},registerConnectionType:function(id,type){if(this._connectionTypes[id]=root.jsPlumb.extend({},type),type.overlays){for(var to={},i=0;i<type.overlays.length;i++){var fo=this.convertToFullOverlaySpec(type.overlays[i]);to[fo[1].id]=fo}this._connectionTypes[id].overlays=to}},registerConnectionTypes:function(types){for(var i in types)this.registerConnectionType(i,types[i])},registerEndpointType:function(id,type){if(this._endpointTypes[id]=root.jsPlumb.extend({},type),type.overlays){for(var to={},i=0;i<type.overlays.length;i++){var fo=this.convertToFullOverlaySpec(type.overlays[i]);to[fo[1].id]=fo}this._endpointTypes[id].overlays=to}},registerEndpointTypes:function(types){for(var i in types)this.registerEndpointType(i,types[i])},getType:function(id,typeDescriptor){return"connection"===typeDescriptor?this._connectionTypes[id]:this._endpointTypes[id]},setIdChanged:function(oldId,newId){this.setId(oldId,newId,!0)},setParent:function(el,newParent){var _dom=this.getElement(el),_id=this.getId(_dom),_pdom=this.getElement(newParent),_pid=this.getId(_pdom),dm=this.getDragManager();_dom.parentNode.removeChild(_dom),_pdom.appendChild(_dom),dm&&dm.setParent(_dom,_id,_pdom,_pid)},extend:function(o1,o2,names){var i;if(names)for(i=0;i<names.length;i++)o1[names[i]]=o2[names[i]];else for(i in o2)o1[i]=o2[i];return o1},floatingConnections:{},getFloatingAnchorIndex:function(jpc){return jpc.endpoints[0].isFloating()?0:jpc.endpoints[1].isFloating()?1:-1}});var jsPlumb=new jsPlumbInstance;(root.jsPlumb=jsPlumb).getInstance=function(_defaults,overrideFns){var j=new jsPlumbInstance(_defaults);if(overrideFns)for(var ovf in overrideFns)j[ovf]=overrideFns[ovf];return j.init(),j},jsPlumb.each=function(spec,fn){if(null!=spec)if("string"==typeof spec)fn(jsPlumb.getElement(spec));else if(null!=spec.length)for(var i=0;i<spec.length;i++)fn(jsPlumb.getElement(spec[i]));else fn(spec)},"undefined"!=typeof exports&&(exports.jsPlumb=jsPlumb)}.call("undefined"!=typeof window?window:this),function(){var _ju=this.jsPlumbUtil,_genLoc=function(prefix,e){if(null==e)return[0,0];var ts=_touches(e),t=_getTouch(ts,0);return[t[prefix+"X"],t[prefix+"Y"]]},_pageLocation=_genLoc.bind(this,"page"),_screenLocation=_genLoc.bind(this,"screen"),_clientLocation=_genLoc.bind(this,"client"),_getTouch=function(touches,idx){return touches.item?touches.item(idx):touches[idx]},_touches=function(e){return e.touches&&0<e.touches.length?e.touches:e.changedTouches&&0<e.changedTouches.length?e.changedTouches:e.targetTouches&&0<e.targetTouches.length?e.targetTouches:[e]},DragManager=function(_currentInstance){var _draggables={},_dlist=[],_delements={},_elementsWithEndpoints={},_draggablesForElements={};this.register=function(el){var parentOffset,id=_currentInstance.getId(el);_draggables[id]||(_draggables[id]=el,_dlist.push(el),_delements[id]={});var _oneLevel=function(p){if(p)for(var i=0;i<p.childNodes.length;i++)if(3!==p.childNodes[i].nodeType&&8!==p.childNodes[i].nodeType){var cEl=jsPlumb.getElement(p.childNodes[i]),cid=_currentInstance.getId(p.childNodes[i],null,!0);if(cid&&_elementsWithEndpoints[cid]&&0<_elementsWithEndpoints[cid]){parentOffset||(parentOffset=_currentInstance.getOffset(el));var cOff=_currentInstance.getOffset(cEl);_delements[id][cid]={id:cid,offset:{left:cOff.left-parentOffset.left,top:cOff.top-parentOffset.top}},_draggablesForElements[cid]=id}_oneLevel(p.childNodes[i])}};_oneLevel(el)},this.updateOffsets=function(elId,childOffsetOverrides){if(null!=elId){childOffsetOverrides=childOffsetOverrides||{};var parentOffset,domEl=jsPlumb.getElement(elId),id=_currentInstance.getId(domEl),children=_delements[id];if(children)for(var i in children)if(children.hasOwnProperty(i)){var cel=jsPlumb.getElement(i),cOff=childOffsetOverrides[i]||_currentInstance.getOffset(cel);if(null==cel.offsetParent&&null!=_delements[id][i])continue;parentOffset||(parentOffset=_currentInstance.getOffset(domEl)),_delements[id][i]={id:i,offset:{left:cOff.left-parentOffset.left,top:cOff.top-parentOffset.top}},_draggablesForElements[i]=id}}},this.endpointAdded=function(el,id){id=id||_currentInstance.getId(el);var b=document.body,p=el.parentNode;for(_elementsWithEndpoints[id]=_elementsWithEndpoints[id]?_elementsWithEndpoints[id]+1:1;null!=p&&p!==b;){var pid=_currentInstance.getId(p,null,!0);if(pid&&_draggables[pid]){var pLoc=_currentInstance.getOffset(p);if(null==_delements[pid][id]){var cLoc=_currentInstance.getOffset(el);_delements[pid][id]={id:id,offset:{left:cLoc.left-pLoc.left,top:cLoc.top-pLoc.top}},_draggablesForElements[id]=pid}break}p=p.parentNode}},this.endpointDeleted=function(endpoint){if(_elementsWithEndpoints[endpoint.elementId]&&(_elementsWithEndpoints[endpoint.elementId]--,_elementsWithEndpoints[endpoint.elementId]<=0))for(var i in _delements)_delements.hasOwnProperty(i)&&_delements[i]&&(delete _delements[i][endpoint.elementId],delete _draggablesForElements[endpoint.elementId])},this.changeId=function(oldId,newId){_delements[newId]=_delements[oldId],_delements[oldId]={},_draggablesForElements[newId]=_draggablesForElements[oldId],_draggablesForElements[oldId]=null},this.getElementsForDraggable=function(id){return _delements[id]},this.elementRemoved=function(elementId){var elId=_draggablesForElements[elementId];elId&&(delete _delements[elId][elementId],delete _draggablesForElements[elementId])},this.reset=function(){_draggables={},_dlist=[],_delements={},_elementsWithEndpoints={}},this.dragEnded=function(el){if(null!=el.offsetParent){var id=_currentInstance.getId(el),ancestor=_draggablesForElements[id];ancestor&&this.updateOffsets(ancestor)}},this.setParent=function(el,elId,p,pId,currentChildLocation){var current=_draggablesForElements[elId];_delements[pId]||(_delements[pId]={});var pLoc=_currentInstance.getOffset(p),cLoc=currentChildLocation||_currentInstance.getOffset(el);current&&_delements[current]&&delete _delements[current][elId],_delements[pId][elId]={id:elId,offset:{left:cLoc.left-pLoc.left,top:cLoc.top-pLoc.top}},_draggablesForElements[elId]=pId},this.clearParent=function(el,elId){var current=_draggablesForElements[elId];current&&(delete _delements[current][elId],delete _draggablesForElements[elId])},this.revalidateParent=function(el,elId,childOffset){var current=_draggablesForElements[elId];if(current){var co={};co[elId]=childOffset,this.updateOffsets(current,co),_currentInstance.revalidate(current)}},this.getDragAncestor=function(el){var de=jsPlumb.getElement(el),id=_currentInstance.getId(de),aid=_draggablesForElements[id];return aid?jsPlumb.getElement(aid):null}},_setClassName=function(el,cn,classList){var str;cn=null==(str=cn)?null:str.replace(/^\s\s*/,"").replace(/\s\s*$/,""),void 0!==el.className.baseVal?el.className.baseVal=cn:el.className=cn;try{var cl=el.classList;if(null!=cl){for(;0<cl.length;)cl.remove(cl.item(0));for(var i=0;i<classList.length;i++)classList[i]&&cl.add(classList[i])}}catch(e){jsPlumbUtil.log("JSPLUMB: cannot set class list",e)}},_getClassName=function(el){return void 0===el.className.baseVal?el.className:el.className.baseVal},_classManip=function(el,classesToAdd,classesToRemove){classesToAdd=null==classesToAdd?[]:_ju.isArray(classesToAdd)?classesToAdd:classesToAdd.split(/\s+/),classesToRemove=null==classesToRemove?[]:_ju.isArray(classesToRemove)?classesToRemove:classesToRemove.split(/\s+/);var curClasses=_getClassName(el).split(/\s+/),_oneSet=function(add,classes){for(var i=0;i<classes.length;i++)if(add)-1===curClasses.indexOf(classes[i])&&curClasses.push(classes[i]);else{var idx=curClasses.indexOf(classes[i]);-1!==idx&&curClasses.splice(idx,1)}};_oneSet(!0,classesToAdd),_oneSet(!1,classesToRemove),_setClassName(el,curClasses.join(" "),curClasses)};this.jsPlumb.extend(this.jsPlumbInstance.prototype,{headless:!1,pageLocation:_pageLocation,screenLocation:_screenLocation,clientLocation:_clientLocation,getDragManager:function(){return null==this.dragManager&&(this.dragManager=new DragManager(this)),this.dragManager},createElement:function(tag,style,clazz,atts){return this.createElementNS(null,tag,style,clazz,atts)},createElementNS:function(ns,tag,style,clazz,atts){var i,e=null==ns?document.createElement(tag):document.createElementNS(ns,tag);for(i in style=style||{})e.style[i]=style[i];for(i in clazz&&(e.className=clazz),atts=atts||{})e.setAttribute(i,""+atts[i]);return e},getAttribute:function(el,attName){return null!=el.getAttribute?el.getAttribute(attName):null},setAttribute:function(el,a,v){null!=el.setAttribute&&el.setAttribute(a,v)},setAttributes:function(el,atts){for(var i in atts)atts.hasOwnProperty(i)&&el.setAttribute(i,atts[i])},appendToRoot:function(node){document.body.appendChild(node)},getRenderModes:function(){return["svg"]},getClass:_getClassName,addClass:function(el,clazz){jsPlumb.each(el,function(e){_classManip(e,clazz)})},hasClass:function(el,clazz){return(el=jsPlumb.getElement(el)).classList?el.classList.contains(clazz):-1!==_getClassName(el).indexOf(clazz)},removeClass:function(el,clazz){jsPlumb.each(el,function(e){_classManip(e,null,clazz)})},toggleClass:function(el,clazz){jsPlumb.hasClass(el,clazz)?jsPlumb.removeClass(el,clazz):jsPlumb.addClass(el,clazz)},updateClasses:function(el,toAdd,toRemove){jsPlumb.each(el,function(e){_classManip(e,toAdd,toRemove)})},setClass:function(el,clazz){null!=clazz&&jsPlumb.each(el,function(e){_setClassName(e,clazz,clazz.split(/\s+/))})},setPosition:function(el,p){el.style.left=p.left+"px",el.style.top=p.top+"px"},getPosition:function(el){var _one=function(prop){var v=el.style[prop];return v?v.substring(0,v.length-2):0};return{left:_one("left"),top:_one("top")}},getStyle:function(el,prop){return void 0!==window.getComputedStyle?getComputedStyle(el,null).getPropertyValue(prop):el.currentStyle[prop]},getSelector:function(ctx,spec){return 1===arguments.length?null!=ctx.nodeType?ctx:document.querySelectorAll(ctx):ctx.querySelectorAll(spec)},getOffset:function(el,relativeToRoot,container){el=jsPlumb.getElement(el),container=container||this.getContainer();for(var out={left:el.offsetLeft,top:el.offsetTop},op=relativeToRoot||null!=container&&el!==container&&el.offsetParent!==container?el.offsetParent:null,_maybeAdjustScroll=function(offsetParent){null!=offsetParent&&offsetParent!==document.body&&(0<offsetParent.scrollTop||0<offsetParent.scrollLeft)&&(out.left-=offsetParent.scrollLeft,out.top-=offsetParent.scrollTop)}.bind(this);null!=op;)out.left+=op.offsetLeft,out.top+=op.offsetTop,_maybeAdjustScroll(op),op=relativeToRoot?op.offsetParent:op.offsetParent===container?null:op.offsetParent;if(null!=container&&!relativeToRoot&&(0<container.scrollTop||0<container.scrollLeft)){var pp=null!=el.offsetParent?this.getStyle(el.offsetParent,"position"):"static",p=this.getStyle(el,"position");"absolute"!==p&&"fixed"!==p&&"absolute"!==pp&&"fixed"!==pp&&(out.left-=container.scrollLeft,out.top-=container.scrollTop)}return out},getPositionOnElement:function(evt,el,zoom){var box=void 0!==el.getBoundingClientRect?el.getBoundingClientRect():{left:0,top:0,width:0,height:0},body=document.body,docElem=document.documentElement,scrollTop=window.pageYOffset||docElem.scrollTop||body.scrollTop,scrollLeft=window.pageXOffset||docElem.scrollLeft||body.scrollLeft,clientTop=docElem.clientTop||body.clientTop||0,clientLeft=docElem.clientLeft||body.clientLeft||0,top=box.top+scrollTop-clientTop+0*zoom,left=box.left+scrollLeft-clientLeft+0*zoom,cl=jsPlumb.pageLocation(evt),w=box.width||el.offsetWidth*zoom,h=box.height||el.offsetHeight*zoom;return[(cl[0]-left)/w,(cl[1]-top)/h]},getAbsolutePosition:function(el){var _one=function(s){var ss=el.style[s];if(ss)return parseFloat(ss.substring(0,ss.length-2))};return[_one("left"),_one("top")]},setAbsolutePosition:function(el,xy,animateFrom,animateOptions){animateFrom?this.animate(el,{left:"+="+(xy[0]-animateFrom[0]),top:"+="+(xy[1]-animateFrom[1])},animateOptions):(el.style.left=xy[0]+"px",el.style.top=xy[1]+"px")},getSize:function(el){return[el.offsetWidth,el.offsetHeight]},getWidth:function(el){return el.offsetWidth},getHeight:function(el){return el.offsetHeight},getRenderMode:function(){return"svg"}})}.call("undefined"!=typeof window?window:this),function(){"use strict";var root=this,_jp=root.jsPlumb,_ju=root.jsPlumbUtil;_jp.OverlayCapableJsPlumbUIComponent=function(params){root.jsPlumbUIComponent.apply(this,arguments),this._jsPlumb.overlays={},this._jsPlumb.overlayPositions={},params.label&&(this.getDefaultType().overlays.__label=["Label",{label:params.label,location:params.labelLocation||this.defaultLabelLocation||.5,labelStyle:params.labelStyle||this._jsPlumb.instance.Defaults.LabelStyle,id:"__label"}]),this.setListenerComponent=function(c){if(this._jsPlumb)for(var i in this._jsPlumb.overlays)this._jsPlumb.overlays[i].setListenerComponent(c)}},_jp.OverlayCapableJsPlumbUIComponent.applyType=function(component,t){if(t.overlays){var i,keep={};for(i in t.overlays){var existing=component._jsPlumb.overlays[t.overlays[i][1].id];if(existing)existing.updateFrom(t.overlays[i][1]),keep[t.overlays[i][1].id]=!0;else{var c=component.getCachedTypeItem("overlay",t.overlays[i][1].id);null!=c?(c.reattach(component._jsPlumb.instance,component),c.setVisible(!0),c.updateFrom(t.overlays[i][1]),component._jsPlumb.overlays[c.id]=c):c=component.addOverlay(t.overlays[i],!0),keep[c.id]=!0}}for(i in component._jsPlumb.overlays)null==keep[component._jsPlumb.overlays[i].id]&&component.removeOverlay(component._jsPlumb.overlays[i].id,!0)}},_ju.extend(_jp.OverlayCapableJsPlumbUIComponent,root.jsPlumbUIComponent,{setHover:function(hover,ignoreAttachedElements){if(this._jsPlumb&&!this._jsPlumb.instance.isConnectionBeingDragged())for(var i in this._jsPlumb.overlays)this._jsPlumb.overlays[i][hover?"addClass":"removeClass"](this._jsPlumb.instance.hoverClass)},addOverlay:function(overlay,doNotRepaint){var o=function(component,o){var _newOverlay=null;if(_ju.isArray(o)){var type=o[0],p=_jp.extend({component:component,_jsPlumb:component._jsPlumb.instance},o[1]);3===o.length&&_jp.extend(p,o[2]),_newOverlay=new(_jp.Overlays[component._jsPlumb.instance.getRenderMode()][type])(p)}else _newOverlay=o.constructor===String?new(_jp.Overlays[component._jsPlumb.instance.getRenderMode()][o])({component:component,_jsPlumb:component._jsPlumb.instance}):o;return _newOverlay.id=_newOverlay.id||_ju.uuid(),component.cacheTypeItem("overlay",_newOverlay,_newOverlay.id),component._jsPlumb.overlays[_newOverlay.id]=_newOverlay}(this,overlay);return doNotRepaint||this.repaint(),o},getOverlay:function(id){return this._jsPlumb.overlays[id]},getOverlays:function(){return this._jsPlumb.overlays},hideOverlay:function(id){var o=this.getOverlay(id);o&&o.hide()},hideOverlays:function(){for(var i in this._jsPlumb.overlays)this._jsPlumb.overlays[i].hide()},showOverlay:function(id){var o=this.getOverlay(id);o&&o.show()},showOverlays:function(){for(var i in this._jsPlumb.overlays)this._jsPlumb.overlays[i].show()},removeAllOverlays:function(doNotRepaint){for(var i in this._jsPlumb.overlays)this._jsPlumb.overlays[i].cleanup&&this._jsPlumb.overlays[i].cleanup();this._jsPlumb.overlays={},this._jsPlumb.overlayPositions=null,this._jsPlumb.overlayPlacements={},doNotRepaint||this.repaint()},removeOverlay:function(overlayId,dontCleanup){var o=this._jsPlumb.overlays[overlayId];o&&(o.setVisible(!1),!dontCleanup&&o.cleanup&&o.cleanup(),delete this._jsPlumb.overlays[overlayId],this._jsPlumb.overlayPositions&&delete this._jsPlumb.overlayPositions[overlayId],this._jsPlumb.overlayPlacements&&delete this._jsPlumb.overlayPlacements[overlayId])},removeOverlays:function(){for(var i=0,j=arguments.length;i<j;i++)this.removeOverlay(arguments[i])},moveParent:function(newParent){if(this.bgCanvas&&(this.bgCanvas.parentNode.removeChild(this.bgCanvas),newParent.appendChild(this.bgCanvas)),this.canvas&&this.canvas.parentNode)for(var i in this.canvas.parentNode.removeChild(this.canvas),newParent.appendChild(this.canvas),this._jsPlumb.overlays)if(this._jsPlumb.overlays[i].isAppendedAtTopLevel){var el=this._jsPlumb.overlays[i].getElement();el.parentNode.removeChild(el),newParent.appendChild(el)}},getLabel:function(){var lo=this.getOverlay("__label");return null!=lo?lo.getLabel():null},getLabelOverlay:function(){return this.getOverlay("__label")},setLabel:function(l){var lo=this.getOverlay("__label");lo?l.constructor===String||l.constructor===Function?lo.setLabel(l):(l.label&&lo.setLabel(l.label),l.location&&lo.setLocation(l.location)):(lo=function(component,params){var _params={cssClass:params.cssClass,labelStyle:component.labelStyle,id:"__label",component:component,_jsPlumb:component._jsPlumb.instance},mergedParams=_jp.extend(_params,params);return new(_jp.Overlays[component._jsPlumb.instance.getRenderMode()].Label)(mergedParams)}(this,l.constructor===String||l.constructor===Function?{label:l}:l),this._jsPlumb.overlays.__label=lo);this._jsPlumb.instance.isSuspendDrawing()||this.repaint()},cleanup:function(force){for(var i in this._jsPlumb.overlays)this._jsPlumb.overlays[i].cleanup(force),this._jsPlumb.overlays[i].destroy(force);force&&(this._jsPlumb.overlays={},this._jsPlumb.overlayPositions=null)},setVisible:function(v){this[v?"showOverlays":"hideOverlays"]()},setAbsoluteOverlayPosition:function(overlay,xy){this._jsPlumb.overlayPositions[overlay.id]=xy},getAbsoluteOverlayPosition:function(overlay){return this._jsPlumb.overlayPositions?this._jsPlumb.overlayPositions[overlay.id]:null},_clazzManip:function(action,clazz,dontUpdateOverlays){if(!dontUpdateOverlays)for(var i in this._jsPlumb.overlays)this._jsPlumb.overlays[i][action+"Class"](clazz)},addClass:function(clazz,dontUpdateOverlays){this._clazzManip("add",clazz,dontUpdateOverlays)},removeClass:function(clazz,dontUpdateOverlays){this._clazzManip("remove",clazz,dontUpdateOverlays)}})}.call("undefined"!=typeof window?window:this),function(){"use strict";var _jp=this.jsPlumb,_ju=this.jsPlumbUtil,typeParameters=["connectorStyle","connectorHoverStyle","connectorOverlays","connector","connectionType","connectorClass","connectorHoverClass"];_jp.Endpoint=function(params){var _jsPlumb=params._jsPlumb,_newConnection=params.newConnection,_newEndpoint=params.newEndpoint;this.idPrefix="_jsplumb_e_",this.defaultLabelLocation=[.5,.5],this.defaultOverlayKeys=["Overlays","EndpointOverlays"],_jp.OverlayCapableJsPlumbUIComponent.apply(this,arguments),this.appendToDefaultType({connectionType:params.connectionType,maxConnections:null==params.maxConnections?this._jsPlumb.instance.Defaults.MaxConnections:params.maxConnections,paintStyle:params.endpointStyle||params.paintStyle||params.style||this._jsPlumb.instance.Defaults.EndpointStyle||_jp.Defaults.EndpointStyle,hoverPaintStyle:params.endpointHoverStyle||params.hoverPaintStyle||this._jsPlumb.instance.Defaults.EndpointHoverStyle||_jp.Defaults.EndpointHoverStyle,connectorStyle:params.connectorStyle,connectorHoverStyle:params.connectorHoverStyle,connectorClass:params.connectorClass,connectorHoverClass:params.connectorHoverClass,connectorOverlays:params.connectorOverlays,connector:params.connector,connectorTooltip:params.connectorTooltip}),this._jsPlumb.enabled=!(!1===params.enabled),this._jsPlumb.visible=!0,this.element=_jp.getElement(params.source),this._jsPlumb.uuid=params.uuid;this._jsPlumb.floatingEndpoint=null;this._jsPlumb.uuid&&(params.endpointsByUUID[this._jsPlumb.uuid]=this),this.elementId=params.elementId,this.dragProxy=params.dragProxy,this._jsPlumb.connectionCost=params.connectionCost,this._jsPlumb.connectionsDirected=params.connectionsDirected,this._jsPlumb.currentAnchorClass="",this._jsPlumb.events={};var deleteOnEmpty=!0===params.deleteOnEmpty;this.setDeleteOnEmpty=function(d){deleteOnEmpty=d};var _updateAnchorClass=function(){var oldAnchorClass=_jsPlumb.endpointAnchorClassPrefix+"-"+this._jsPlumb.currentAnchorClass;this._jsPlumb.currentAnchorClass=this.anchor.getCssClass();var anchorClass=_jsPlumb.endpointAnchorClassPrefix+(this._jsPlumb.currentAnchorClass?"-"+this._jsPlumb.currentAnchorClass:"");this.removeClass(oldAnchorClass),this.addClass(anchorClass),_jp.updateClasses(this.element,anchorClass,oldAnchorClass)}.bind(this);this.prepareAnchor=function(anchorParams){var a=this._jsPlumb.instance.makeAnchor(anchorParams,this.elementId,_jsPlumb);return a.bind("anchorChanged",function(currentAnchor){this.fire("anchorChanged",{endpoint:this,anchor:currentAnchor}),_updateAnchorClass()}.bind(this)),a},this.setPreparedAnchor=function(anchor,doNotRepaint){return this._jsPlumb.instance.continuousAnchorFactory.clear(this.elementId),this.anchor=anchor,_updateAnchorClass(),doNotRepaint||this._jsPlumb.instance.repaint(this.elementId),this},this.setAnchor=function(anchorParams,doNotRepaint){var a=this.prepareAnchor(anchorParams);return this.setPreparedAnchor(a,doNotRepaint),this};var internalHover=function(state){if(0<this.connections.length)for(var i=0;i<this.connections.length;i++)this.connections[i].setHover(state,!1);else this.setHover(state)}.bind(this);this.bind("mouseover",function(){internalHover(!0)}),this.bind("mouseout",function(){internalHover(!1)}),params._transient||this._jsPlumb.instance.anchorManager.add(this,this.elementId),this.prepareEndpoint=function(ep,typeId){var endpoint,_e=function(t,p){var rm=_jsPlumb.getRenderMode();if(_jp.Endpoints[rm][t])return new _jp.Endpoints[rm][t](p);if(!_jsPlumb.Defaults.DoNotThrowErrors)throw{msg:"jsPlumb: unknown endpoint type '"+t+"'"}},endpointArgs={_jsPlumb:this._jsPlumb.instance,cssClass:params.cssClass,container:params.container,tooltip:params.tooltip,connectorTooltip:params.connectorTooltip,endpoint:this};return(endpoint=_ju.isString(ep)?_e(ep,endpointArgs):_ju.isArray(ep)?(endpointArgs=_ju.merge(ep[1],endpointArgs),_e(ep[0],endpointArgs)):ep.clone()).clone=function(){return _ju.isString(ep)?_e(ep,endpointArgs):_ju.isArray(ep)?(endpointArgs=_ju.merge(ep[1],endpointArgs),_e(ep[0],endpointArgs)):void 0}.bind(this),endpoint.typeId=typeId,endpoint},this.setEndpoint=function(ep,doNotRepaint){var _ep=this.prepareEndpoint(ep);this.setPreparedEndpoint(_ep,!0)},this.setPreparedEndpoint=function(ep,doNotRepaint){null!=this.endpoint&&(this.endpoint.cleanup(),this.endpoint.destroy()),this.endpoint=ep,this.type=this.endpoint.type,this.canvas=this.endpoint.canvas},_jp.extend(this,params,typeParameters),this.isSource=params.isSource||!1,this.isTemporarySource=params.isTemporarySource||!1,this.isTarget=params.isTarget||!1,this.connections=params.connections||[],this.connectorPointerEvents=params["connector-pointer-events"],this.scope=params.scope||_jsPlumb.getDefaultScope(),this.timestamp=null,this.reattachConnections=params.reattach||_jsPlumb.Defaults.ReattachConnections,this.connectionsDetachable=_jsPlumb.Defaults.ConnectionsDetachable,!1!==params.connectionsDetachable&&!1!==params.detachable||(this.connectionsDetachable=!1),this.dragAllowedWhenFull=!1!==params.dragAllowedWhenFull,params.onMaxConnections&&this.bind("maxConnections",params.onMaxConnections),this.addConnection=function(connection){this.connections.push(connection),this[(0<this.connections.length?"add":"remove")+"Class"](_jsPlumb.endpointConnectedClass),this[(this.isFull()?"add":"remove")+"Class"](_jsPlumb.endpointFullClass)},this.detachFromConnection=function(connection,idx,doNotCleanup){0<=(idx=null==idx?this.connections.indexOf(connection):idx)&&(this.connections.splice(idx,1),this[(0<this.connections.length?"add":"remove")+"Class"](_jsPlumb.endpointConnectedClass),this[(this.isFull()?"add":"remove")+"Class"](_jsPlumb.endpointFullClass)),!doNotCleanup&&deleteOnEmpty&&0===this.connections.length&&_jsPlumb.deleteObject({endpoint:this,fireEvent:!1,deleteAttachedObjects:!0!==doNotCleanup})},this.deleteEveryConnection=function(params){for(var c=this.connections.length,i=0;i<c;i++)_jsPlumb.deleteConnection(this.connections[0],params)},this.detachFrom=function(targetEndpoint,fireEvent,originalEvent){for(var c=[],i=0;i<this.connections.length;i++)this.connections[i].endpoints[1]!==targetEndpoint&&this.connections[i].endpoints[0]!==targetEndpoint||c.push(this.connections[i]);for(var j=0,count=c.length;j<count;j++)_jsPlumb.deleteConnection(c[0]);return this},this.getElement=function(){return this.element},this.setElement=function(el){var parentId=this._jsPlumb.instance.getId(el),curId=this.elementId;return _ju.removeWithFunction(params.endpointsByElement[this.elementId],function(e){return e.id===this.id}.bind(this)),this.element=_jp.getElement(el),this.elementId=_jsPlumb.getId(this.element),_jsPlumb.anchorManager.rehomeEndpoint(this,curId,this.element),_jsPlumb.dragManager.endpointAdded(this.element),_ju.addToList(params.endpointsByElement,parentId,this),this},this.makeInPlaceCopy=function(){var loc=this.anchor.getCurrentLocation({element:this}),o=this.anchor.getOrientation(this),acc=this.anchor.getCssClass(),inPlaceAnchor={bind:function(){},compute:function(){return[loc[0],loc[1]]},getCurrentLocation:function(){return[loc[0],loc[1]]},getOrientation:function(){return o},getCssClass:function(){return acc}};return _newEndpoint({dropOptions:params.dropOptions,anchor:inPlaceAnchor,source:this.element,paintStyle:this.getPaintStyle(),endpoint:params.hideOnDrag?"Blank":this.endpoint,_transient:!0,scope:this.scope,reference:this})},this.connectorSelector=function(){return this.connections[0]},this.setStyle=this.setPaintStyle,this.paint=function(params){var timestamp=(params=params||{}).timestamp,recalc=!(!1===params.recalc);if(!timestamp||this.timestamp!==timestamp){var info=_jsPlumb.updateOffset({elId:this.elementId,timestamp:timestamp}),xy=params.offset?params.offset.o:info.o;if(null!=xy){var ap=params.anchorPoint,connectorPaintStyle=params.connectorPaintStyle;if(null==ap){var wh=params.dimensions||info.s,anchorParams={xy:[xy.left,xy.top],wh:wh,element:this,timestamp:timestamp};if(recalc&&this.anchor.isDynamic&&0<this.connections.length){var c=function(ep,elementWithPrecedence){var idx=0;if(null!=elementWithPrecedence)for(var i=0;i<ep.connections.length;i++)if(ep.connections[i].sourceId===elementWithPrecedence||ep.connections[i].targetId===elementWithPrecedence){idx=i;break}return ep.connections[idx]}(this,params.elementWithPrecedence),oIdx=c.endpoints[0]===this?1:0,oId=0===oIdx?c.sourceId:c.targetId,oInfo=_jsPlumb.getCachedData(oId),oOffset=oInfo.o,oWH=oInfo.s;anchorParams.index=0===oIdx?1:0,anchorParams.connection=c,anchorParams.txy=[oOffset.left,oOffset.top],anchorParams.twh=oWH,anchorParams.tElement=c.endpoints[oIdx]}else 0<this.connections.length&&(anchorParams.connection=this.connections[0]);ap=this.anchor.compute(anchorParams)}for(var i in this.endpoint.compute(ap,this.anchor.getOrientation(this),this._jsPlumb.paintStyleInUse,connectorPaintStyle||this.paintStyleInUse),this.endpoint.paint(this._jsPlumb.paintStyleInUse,this.anchor),this.timestamp=timestamp,this._jsPlumb.overlays)if(this._jsPlumb.overlays.hasOwnProperty(i)){var o=this._jsPlumb.overlays[i];o.isVisible()&&(this._jsPlumb.overlayPlacements[i]=o.draw(this.endpoint,this._jsPlumb.paintStyleInUse),o.paint(this._jsPlumb.overlayPlacements[i]))}}}},this.getTypeDescriptor=function(){return"endpoint"},this.isVisible=function(){return this._jsPlumb.visible},this.repaint=this.paint;var draggingInitialised=!1;this.initDraggable=function(){if(!draggingInitialised&&_jp.isDragSupported(this.element)){var payload,placeholderInfo={id:null,element:null},jpc=null,existingJpc=!1,existingJpcParams=null,_dragHandler=function(endpoint,placeholder,_jsPlumb){var stopped=!1;return{drag:function(){if(stopped)return!(stopped=!1);if(placeholder.element){var _ui=_jsPlumb.getUIPosition(arguments,_jsPlumb.getZoom());null!=_ui&&_jsPlumb.setPosition(placeholder.element,_ui),_jsPlumb.repaint(placeholder.element,_ui),endpoint.paint({anchorPoint:endpoint.anchor.getCurrentLocation({element:endpoint})})}},stopDrag:function(){stopped=!0}}}(this,placeholderInfo,_jsPlumb),dragOptions=params.dragOptions||{},startEvent=_jp.dragEvents.start,stopEvent=_jp.dragEvents.stop,dragEvent=_jp.dragEvents.drag,beforeStartEvent=_jp.dragEvents.beforeStart,start=function(startParams){jpc=this.connectorSelector();var _continue=!0;this.isEnabled()||(_continue=!1),null!=jpc||this.isSource||this.isTemporarySource||(_continue=!1),!this.isSource||!this.isFull()||null!=jpc&&this.dragAllowedWhenFull||(_continue=!1),null==jpc||jpc.isDetachable(this)||(this.isFull()?_continue=!1:jpc=null);var beforeDrag=_jsPlumb.checkCondition(null==jpc?"beforeDrag":"beforeStartDetach",{endpoint:this,source:this.element,sourceId:this.elementId,connection:jpc});if(!1===beforeDrag?_continue=!1:"object"==typeof beforeDrag?_jp.extend(beforeDrag,payload||{}):beforeDrag=payload||{},!1===_continue)return _jsPlumb.stopDrag&&_jsPlumb.stopDrag(this.canvas),_dragHandler.stopDrag(),!1;for(var i=0;i<this.connections.length;i++)this.connections[i].setHover(!1);this.addClass("endpointDrag"),_jsPlumb.setConnectionBeingDragged(!0),jpc&&!this.isFull()&&this.isSource&&(jpc=null),_jsPlumb.updateOffset({elId:this.elementId});var ipco=this._jsPlumb.instance.getOffset(this.canvas),canvasElement=this.canvas,ips=this._jsPlumb.instance.getSize(this.canvas);!function(placeholder,_jsPlumb,ipco,ips){var n=_jsPlumb.createElement("div",{position:"absolute"});_jsPlumb.appendElement(n);var id=_jsPlumb.getId(n);_jsPlumb.setPosition(n,ipco),n.style.width=ips[0]+"px",n.style.height=ips[1]+"px",_jsPlumb.manage(id,n,!0),placeholder.id=id,placeholder.element=n}(placeholderInfo,_jsPlumb,ipco,ips),_jsPlumb.setAttributes(this.canvas,{dragId:placeholderInfo.id,elId:this.elementId});var endpointToFloat=this.dragProxy||this.endpoint;if(null==this.dragProxy&&null!=this.connectionType){var aae=this._jsPlumb.instance.deriveEndpointAndAnchorSpec(this.connectionType);aae.endpoints[1]&&(endpointToFloat=aae.endpoints[1])}var centerAnchor=this._jsPlumb.instance.makeAnchor("Center");centerAnchor.isFloating=!0,this._jsPlumb.floatingEndpoint=function(paintStyle,referenceAnchor,endpoint,referenceCanvas,sourceElement,_jsPlumb,_newEndpoint,scope){return _newEndpoint({paintStyle:paintStyle,endpoint:endpoint,anchor:new _jp.FloatingAnchor({reference:referenceAnchor,referenceCanvas:referenceCanvas,jsPlumbInstance:_jsPlumb}),source:sourceElement,scope:scope})}(this.getPaintStyle(),centerAnchor,endpointToFloat,this.canvas,placeholderInfo.element,_jsPlumb,_newEndpoint,this.scope);var _savedAnchor=this._jsPlumb.floatingEndpoint.anchor;if(null==jpc)this.setHover(!1,!1),(jpc=_newConnection({sourceEndpoint:this,targetEndpoint:this._jsPlumb.floatingEndpoint,source:this.element,target:placeholderInfo.element,anchors:[this.anchor,this._jsPlumb.floatingEndpoint.anchor],paintStyle:params.connectorStyle,hoverPaintStyle:params.connectorHoverStyle,connector:params.connector,overlays:params.connectorOverlays,type:this.connectionType,cssClass:this.connectorClass,hoverClass:this.connectorHoverClass,scope:params.scope,data:beforeDrag})).pending=!0,jpc.addClass(_jsPlumb.draggingClass),this._jsPlumb.floatingEndpoint.addClass(_jsPlumb.draggingClass),this._jsPlumb.floatingEndpoint.anchor=_savedAnchor,_jsPlumb.fire("connectionDrag",jpc),_jsPlumb.anchorManager.newConnection(jpc);else{existingJpc=!0,jpc.setHover(!1);var anchorIdx=jpc.endpoints[0].id===this.id?0:1;this.detachFromConnection(jpc,null,!0);var dragScope=_jsPlumb.getDragScope(canvasElement);_jsPlumb.setAttribute(this.canvas,"originalScope",dragScope),_jsPlumb.fire("connectionDrag",jpc),0===anchorIdx?(existingJpcParams=[jpc.source,jpc.sourceId,canvasElement,dragScope],_jsPlumb.anchorManager.sourceChanged(jpc.endpoints[anchorIdx].elementId,placeholderInfo.id,jpc,placeholderInfo.element)):(existingJpcParams=[jpc.target,jpc.targetId,canvasElement,dragScope],jpc.target=placeholderInfo.element,jpc.targetId=placeholderInfo.id,_jsPlumb.anchorManager.updateOtherEndpoint(jpc.sourceId,jpc.endpoints[anchorIdx].elementId,jpc.targetId,jpc)),jpc.suspendedEndpoint=jpc.endpoints[anchorIdx],jpc.suspendedElement=jpc.endpoints[anchorIdx].getElement(),jpc.suspendedElementId=jpc.endpoints[anchorIdx].elementId,jpc.suspendedElementType=0===anchorIdx?"source":"target",jpc.suspendedEndpoint.setHover(!1),this._jsPlumb.floatingEndpoint.referenceEndpoint=jpc.suspendedEndpoint,jpc.endpoints[anchorIdx]=this._jsPlumb.floatingEndpoint,jpc.addClass(_jsPlumb.draggingClass),this._jsPlumb.floatingEndpoint.addClass(_jsPlumb.draggingClass)}_jsPlumb.registerFloatingConnection(placeholderInfo,jpc,this._jsPlumb.floatingEndpoint),_jsPlumb.currentlyDragging=!0}.bind(this),stop=function(){if(_jsPlumb.setConnectionBeingDragged(!1),jpc&&null!=jpc.endpoints){var originalEvent=_jsPlumb.getDropEvent(arguments),idx=_jsPlumb.getFloatingAnchorIndex(jpc);if(jpc.endpoints[0===idx?1:0].anchor.unlock(),jpc.removeClass(_jsPlumb.draggingClass),this._jsPlumb&&(jpc.deleteConnectionNow||jpc.endpoints[idx]===this._jsPlumb.floatingEndpoint)&&existingJpc&&jpc.suspendedEndpoint){0===idx?(jpc.floatingElement=jpc.source,jpc.floatingId=jpc.sourceId,jpc.floatingEndpoint=jpc.endpoints[0],jpc.floatingIndex=0,jpc.source=existingJpcParams[0],jpc.sourceId=existingJpcParams[1]):(jpc.floatingElement=jpc.target,jpc.floatingId=jpc.targetId,jpc.floatingEndpoint=jpc.endpoints[1],jpc.floatingIndex=1,jpc.target=existingJpcParams[0],jpc.targetId=existingJpcParams[1]);var fe=this._jsPlumb.floatingEndpoint;_jsPlumb.setDragScope(existingJpcParams[2],existingJpcParams[3]),jpc.endpoints[idx]=jpc.suspendedEndpoint,jpc.isReattach()||jpc._forceReattach||jpc._forceDetach||!_jsPlumb.deleteConnection(jpc,{originalEvent:originalEvent})?(jpc.setHover(!1),jpc._forceDetach=null,jpc._forceReattach=null,this._jsPlumb.floatingEndpoint.detachFromConnection(jpc),jpc.suspendedEndpoint.addConnection(jpc),1===idx?_jsPlumb.anchorManager.updateOtherEndpoint(jpc.sourceId,jpc.floatingId,jpc.targetId,jpc):_jsPlumb.anchorManager.sourceChanged(jpc.floatingId,jpc.sourceId,jpc,jpc.source),_jsPlumb.repaint(existingJpcParams[1])):_jsPlumb.deleteObject({endpoint:fe})}this.deleteAfterDragStop?_jsPlumb.deleteObject({endpoint:this}):this._jsPlumb&&this.paint({recalc:!1}),_jsPlumb.fire("connectionDragStop",jpc,originalEvent),jpc.pending&&_jsPlumb.fire("connectionAborted",jpc,originalEvent),_jsPlumb.currentlyDragging=!1,jpc.suspendedElement=null,jpc.suspendedEndpoint=null,jpc=null}placeholderInfo.element&&_jsPlumb.remove(placeholderInfo.element,!1,!1),this._jsPlumb&&(this.canvas.style.visibility="visible",this.anchor.unlock(),this._jsPlumb.floatingEndpoint=null)}.bind(this);(dragOptions=_jp.extend({},dragOptions)).scope=this.scope||dragOptions.scope,dragOptions[beforeStartEvent]=_ju.wrap(dragOptions[beforeStartEvent],function(beforeStartParams){payload=beforeStartParams.e.payload||{}},!1),dragOptions[startEvent]=_ju.wrap(dragOptions[startEvent],start,!1),dragOptions[dragEvent]=_ju.wrap(dragOptions[dragEvent],_dragHandler.drag),dragOptions[stopEvent]=_ju.wrap(dragOptions[stopEvent],stop),dragOptions.multipleDrop=!1,dragOptions.canDrag=function(){return this.isSource||this.isTemporarySource||0<this.connections.length&&!1!==this.connectionsDetachable}.bind(this),_jsPlumb.initDraggable(this.canvas,dragOptions,"internal"),this.canvas._jsPlumbRelatedElement=this.element,draggingInitialised=!0}};var ep=params.endpoint||this._jsPlumb.instance.Defaults.Endpoint||_jp.Defaults.Endpoint;this.setEndpoint(ep,!0);var anchorParamsToUse=params.anchor?params.anchor:params.anchors?params.anchors:_jsPlumb.Defaults.Anchor||"Top";this.setAnchor(anchorParamsToUse,!0);var type=["default",params.type||""].join(" ");this.addType(type,params.data,!0),this.canvas=this.endpoint.canvas,(this.canvas._jsPlumb=this).initDraggable();var _initDropTarget=function(canvas,isTransient,endpoint,referenceEndpoint){if(_jp.isDropSupported(this.element)){var dropOptions=params.dropOptions||_jsPlumb.Defaults.DropOptions||_jp.Defaults.DropOptions;(dropOptions=_jp.extend({},dropOptions)).scope=dropOptions.scope||this.scope;var dropEvent=_jp.dragEvents.drop,overEvent=_jp.dragEvents.over,outEvent=_jp.dragEvents.out,_ep=this,drop=_jsPlumb.EndpointDropHandler({getEndpoint:function(){return _ep},jsPlumb:_jsPlumb,enabled:function(){return null==endpoint||endpoint.isEnabled()},isFull:function(){return endpoint.isFull()},element:this.element,elementId:this.elementId,isSource:this.isSource,isTarget:this.isTarget,addClass:function(clazz){_ep.addClass(clazz)},removeClass:function(clazz){_ep.removeClass(clazz)},isDropAllowed:function(){return _ep.isDropAllowed.apply(_ep,arguments)},reference:referenceEndpoint,isRedrop:function(jpc,dhParams){return jpc.suspendedEndpoint&&dhParams.reference&&jpc.suspendedEndpoint.id===dhParams.reference.id}});dropOptions[dropEvent]=_ju.wrap(dropOptions[dropEvent],drop,!0),dropOptions[overEvent]=_ju.wrap(dropOptions[overEvent],function(){var draggable=_jp.getDragObject(arguments),id=_jsPlumb.getAttribute(_jp.getElement(draggable),"dragId"),_jpc=_jsPlumb.getFloatingConnectionFor(id);if(null!=_jpc){var idx=_jsPlumb.getFloatingAnchorIndex(_jpc);if(this.isTarget&&0!==idx||_jpc.suspendedEndpoint&&this.referenceEndpoint&&this.referenceEndpoint.id===_jpc.suspendedEndpoint.id){var bb=_jsPlumb.checkCondition("checkDropAllowed",{sourceEndpoint:_jpc.endpoints[idx],targetEndpoint:this,connection:_jpc});this[(bb?"add":"remove")+"Class"](_jsPlumb.endpointDropAllowedClass),this[(bb?"remove":"add")+"Class"](_jsPlumb.endpointDropForbiddenClass),_jpc.endpoints[idx].anchor.over(this.anchor,this)}}}.bind(this)),dropOptions[outEvent]=_ju.wrap(dropOptions[outEvent],function(){var draggable=_jp.getDragObject(arguments),id=null==draggable?null:_jsPlumb.getAttribute(_jp.getElement(draggable),"dragId"),_jpc=id?_jsPlumb.getFloatingConnectionFor(id):null;if(null!=_jpc){var idx=_jsPlumb.getFloatingAnchorIndex(_jpc);(this.isTarget&&0!==idx||_jpc.suspendedEndpoint&&this.referenceEndpoint&&this.referenceEndpoint.id===_jpc.suspendedEndpoint.id)&&(this.removeClass(_jsPlumb.endpointDropAllowedClass),this.removeClass(_jsPlumb.endpointDropForbiddenClass),_jpc.endpoints[idx].anchor.out())}}.bind(this)),_jsPlumb.initDroppable(canvas,dropOptions,"internal",isTransient)}}.bind(this);return this.anchor.isFloating||_initDropTarget(this.canvas,!(params._transient||this.anchor.isFloating),this,params.reference),this},_ju.extend(_jp.Endpoint,_jp.OverlayCapableJsPlumbUIComponent,{setVisible:function(v,doNotChangeConnections,doNotNotifyOtherEndpoint){if(this._jsPlumb.visible=v,this.canvas&&(this.canvas.style.display=v?"block":"none"),this[v?"showOverlays":"hideOverlays"](),!doNotChangeConnections)for(var i=0;i<this.connections.length;i++)if(this.connections[i].setVisible(v),!doNotNotifyOtherEndpoint){var oIdx=this===this.connections[i].endpoints[0]?1:0;1===this.connections[i].endpoints[oIdx].connections.length&&this.connections[i].endpoints[oIdx].setVisible(v,!0,!0)}},getAttachedElements:function(){return this.connections},applyType:function(t,doNotRepaint){this.setPaintStyle(t.endpointStyle||t.paintStyle,doNotRepaint),this.setHoverPaintStyle(t.endpointHoverStyle||t.hoverPaintStyle,doNotRepaint),null!=t.maxConnections&&(this._jsPlumb.maxConnections=t.maxConnections),t.scope&&(this.scope=t.scope),_jp.extend(this,t,typeParameters),null!=t.cssClass&&this.canvas&&this._jsPlumb.instance.addClass(this.canvas,t.cssClass),_jp.OverlayCapableJsPlumbUIComponent.applyType(this,t)},isEnabled:function(){return this._jsPlumb.enabled},setEnabled:function(e){this._jsPlumb.enabled=e},cleanup:function(){var anchorClass=this._jsPlumb.instance.endpointAnchorClassPrefix+(this._jsPlumb.currentAnchorClass?"-"+this._jsPlumb.currentAnchorClass:"");_jp.removeClass(this.element,anchorClass),this.anchor=null,this.endpoint.cleanup(!0),this.endpoint.destroy(),this.endpoint=null,this._jsPlumb.instance.destroyDraggable(this.canvas,"internal"),this._jsPlumb.instance.destroyDroppable(this.canvas,"internal")},setHover:function(h){this.endpoint&&this._jsPlumb&&!this._jsPlumb.instance.isConnectionBeingDragged()&&this.endpoint.setHover(h)},isFull:function(){return 0===this._jsPlumb.maxConnections||!(this.isFloating()||this._jsPlumb.maxConnections<0||this.connections.length<this._jsPlumb.maxConnections)},isFloating:function(){return null!=this.anchor&&this.anchor.isFloating},isConnectedTo:function(endpoint){var found=!1;if(endpoint)for(var i=0;i<this.connections.length;i++)if(this.connections[i].endpoints[1]===endpoint||this.connections[i].endpoints[0]===endpoint){found=!0;break}return found},getConnectionCost:function(){return this._jsPlumb.connectionCost},setConnectionCost:function(c){this._jsPlumb.connectionCost=c},areConnectionsDirected:function(){return this._jsPlumb.connectionsDirected},setConnectionsDirected:function(b){this._jsPlumb.connectionsDirected=b},setElementId:function(_elId){this.elementId=_elId,this.anchor.elementId=_elId},setReferenceElement:function(_el){this.element=_jp.getElement(_el)},setDragAllowedWhenFull:function(allowed){this.dragAllowedWhenFull=allowed},equals:function(endpoint){return this.anchor.equals(endpoint.anchor)},getUuid:function(){return this._jsPlumb.uuid},computeAnchor:function(params){return this.anchor.compute(params)}}),this.jsPlumbInstance.prototype.EndpointDropHandler=function(dhParams){return function(e){var _jsPlumb=dhParams.jsPlumb;dhParams.removeClass(_jsPlumb.endpointDropAllowedClass),dhParams.removeClass(_jsPlumb.endpointDropForbiddenClass);var originalEvent=_jsPlumb.getDropEvent(arguments),draggable=_jsPlumb.getDragObject(arguments),id=_jsPlumb.getAttribute(draggable,"dragId"),scope=(_jsPlumb.getAttribute(draggable,"elId"),_jsPlumb.getAttribute(draggable,"originalScope")),jpc=_jsPlumb.getFloatingConnectionFor(id);if(null!=jpc){var existingConnection=null!=jpc.suspendedEndpoint;if(!existingConnection||null!=jpc.suspendedEndpoint._jsPlumb){var _ep=dhParams.getEndpoint(jpc);if(null!=_ep){if(dhParams.isRedrop(jpc,dhParams))return jpc._forceReattach=!0,jpc.setHover(!1),void(dhParams.maybeCleanup&&dhParams.maybeCleanup(_ep));var idx=_jsPlumb.getFloatingAnchorIndex(jpc);if(0===idx&&!dhParams.isSource||1===idx&&!dhParams.isTarget)dhParams.maybeCleanup&&dhParams.maybeCleanup(_ep);else{dhParams.onDrop&&dhParams.onDrop(jpc),scope&&_jsPlumb.setDragScope(draggable,scope);var isFull=dhParams.isFull(e);if(isFull&&_ep.fire("maxConnections",{endpoint:this,connection:jpc,maxConnections:_ep._jsPlumb.maxConnections},originalEvent),!isFull&&dhParams.enabled()){var _doContinue=!0;0===idx?(jpc.floatingElement=jpc.source,jpc.floatingId=jpc.sourceId,jpc.floatingEndpoint=jpc.endpoints[0],jpc.floatingIndex=0,jpc.source=dhParams.element,jpc.sourceId=dhParams.elementId):(jpc.floatingElement=jpc.target,jpc.floatingId=jpc.targetId,jpc.floatingEndpoint=jpc.endpoints[1],jpc.floatingIndex=1,jpc.target=dhParams.element,jpc.targetId=dhParams.elementId),existingConnection&&jpc.suspendedEndpoint.id!==_ep.id&&(jpc.isDetachAllowed(jpc)&&jpc.endpoints[idx].isDetachAllowed(jpc)&&jpc.suspendedEndpoint.isDetachAllowed(jpc)&&_jsPlumb.checkCondition("beforeDetach",jpc)||(_doContinue=!1));var continueFunction=function(optionalData){jpc.endpoints[idx].detachFromConnection(jpc),jpc.suspendedEndpoint&&jpc.suspendedEndpoint.detachFromConnection(jpc),(jpc.endpoints[idx]=_ep).addConnection(jpc);var params=_ep.getParameters();for(var aParam in params)jpc.setParameter(aParam,params[aParam]);if(existingConnection){var suspendedElementId=jpc.suspendedEndpoint.elementId;_jsPlumb.fireMoveEvent({index:idx,originalSourceId:0===idx?suspendedElementId:jpc.sourceId,newSourceId:0===idx?_ep.elementId:jpc.sourceId,originalTargetId:1===idx?suspendedElementId:jpc.targetId,newTargetId:1===idx?_ep.elementId:jpc.targetId,originalSourceEndpoint:0===idx?jpc.suspendedEndpoint:jpc.endpoints[0],newSourceEndpoint:0===idx?_ep:jpc.endpoints[0],originalTargetEndpoint:1===idx?jpc.suspendedEndpoint:jpc.endpoints[1],newTargetEndpoint:1===idx?_ep:jpc.endpoints[1],connection:jpc},originalEvent)}else params.draggable&&_jsPlumb.initDraggable(this.element,dhParams.dragOptions,"internal",_jsPlumb);(1===idx?_jsPlumb.anchorManager.updateOtherEndpoint(jpc.sourceId,jpc.floatingId,jpc.targetId,jpc):_jsPlumb.anchorManager.sourceChanged(jpc.floatingId,jpc.sourceId,jpc,jpc.source),jpc.endpoints[0].finalEndpoint)&&(jpc.endpoints[0].detachFromConnection(jpc),jpc.endpoints[0]=jpc.endpoints[0].finalEndpoint,jpc.endpoints[0].addConnection(jpc));_ju.isObject(optionalData)&&jpc.mergeData(optionalData),_jsPlumb.finaliseConnection(jpc,null,originalEvent,!1),jpc.setHover(!1),_jsPlumb.revalidate(jpc.endpoints[0].element)}.bind(this);if(_doContinue=_doContinue&&dhParams.isDropAllowed(jpc.sourceId,jpc.targetId,jpc.scope,jpc,_ep))return continueFunction(_doContinue),!0;jpc.suspendedEndpoint&&(jpc.endpoints[idx]=jpc.suspendedEndpoint,jpc.setHover(!1),jpc._forceDetach=!0,0===idx?(jpc.source=jpc.suspendedEndpoint.element,jpc.sourceId=jpc.suspendedEndpoint.elementId):(jpc.target=jpc.suspendedEndpoint.element,jpc.targetId=jpc.suspendedEndpoint.elementId),jpc.suspendedEndpoint.addConnection(jpc),1===idx?_jsPlumb.anchorManager.updateOtherEndpoint(jpc.sourceId,jpc.floatingId,jpc.targetId,jpc):_jsPlumb.anchorManager.sourceChanged(jpc.floatingId,jpc.sourceId,jpc,jpc.source),_jsPlumb.repaint(jpc.sourceId),jpc._forceDetach=!1)}dhParams.maybeCleanup&&dhParams.maybeCleanup(_ep),_jsPlumb.currentlyDragging=!1}}}}}}}.call("undefined"!=typeof window?window:this),function(){"use strict";var root=this,_jp=root.jsPlumb,_ju=root.jsPlumbUtil,makeConnector=function(_jsPlumb,renderMode,connectorName,connectorArgs,forComponent){if(_jp.Connectors[renderMode]=_jp.Connectors[renderMode]||{},null==_jp.Connectors[renderMode][connectorName]){if(null==_jp.Connectors[connectorName]){if(_jsPlumb.Defaults.DoNotThrowErrors)return null;throw new TypeError("jsPlumb: unknown connector type '"+connectorName+"'")}_jp.Connectors[renderMode][connectorName]=function(){_jp.Connectors[connectorName].apply(this,arguments),_jp.ConnectorRenderers[renderMode].apply(this,arguments)},_ju.extend(_jp.Connectors[renderMode][connectorName],[_jp.Connectors[connectorName],_jp.ConnectorRenderers[renderMode]])}return new _jp.Connectors[renderMode][connectorName](connectorArgs,forComponent)},_makeAnchor=function(anchorParams,elementId,_jsPlumb){return anchorParams?_jsPlumb.makeAnchor(anchorParams,elementId,_jsPlumb):null},_updateConnectedClass=function(conn,element,_jsPlumb,remove){null!=element&&(element._jsPlumbConnections=element._jsPlumbConnections||{},remove?delete element._jsPlumbConnections[conn.id]:element._jsPlumbConnections[conn.id]=!0,_ju.isEmpty(element._jsPlumbConnections)?_jsPlumb.removeClass(element,_jsPlumb.connectedClass):_jsPlumb.addClass(element,_jsPlumb.connectedClass))};_jp.Connection=function(params){var _newEndpoint=params.newEndpoint;this.id=params.id,this.connector=null,this.idPrefix="_jsplumb_c_",this.defaultLabelLocation=.5,this.defaultOverlayKeys=["Overlays","ConnectionOverlays"],this.previousConnection=params.previousConnection,this.source=_jp.getElement(params.source),this.target=_jp.getElement(params.target),_jp.OverlayCapableJsPlumbUIComponent.apply(this,arguments),params.sourceEndpoint?(this.source=params.sourceEndpoint.getElement(),this.sourceId=params.sourceEndpoint.elementId):this.sourceId=this._jsPlumb.instance.getId(this.source),params.targetEndpoint?(this.target=params.targetEndpoint.getElement(),this.targetId=params.targetEndpoint.elementId):this.targetId=this._jsPlumb.instance.getId(this.target),this.scope=params.scope,this.endpoints=[],this.endpointStyles=[];var _jsPlumb=this._jsPlumb.instance;_jsPlumb.manage(this.sourceId,this.source),_jsPlumb.manage(this.targetId,this.target),this._jsPlumb.visible=!0,this._jsPlumb.params={cssClass:params.cssClass,container:params.container,"pointer-events":params["pointer-events"],editorParams:params.editorParams,overlays:params.overlays},this._jsPlumb.lastPaintedAt=null,this.bind("mouseover",function(){this.setHover(!0)}.bind(this)),this.bind("mouseout",function(){this.setHover(!1)}.bind(this)),this.makeEndpoint=function(isSource,el,elId,ep){return elId=elId||this._jsPlumb.instance.getId(el),this.prepareEndpoint(_jsPlumb,_newEndpoint,this,ep,isSource?0:1,params,el,elId)},params.type&&(params.endpoints=params.endpoints||this._jsPlumb.instance.deriveEndpointAndAnchorSpec(params.type).endpoints);var eS=this.makeEndpoint(!0,this.source,this.sourceId,params.sourceEndpoint),eT=this.makeEndpoint(!1,this.target,this.targetId,params.targetEndpoint);eS&&_ju.addToList(params.endpointsByElement,this.sourceId,eS),eT&&_ju.addToList(params.endpointsByElement,this.targetId,eT),this.scope||(this.scope=this.endpoints[0].scope),null!=params.deleteEndpointsOnEmpty&&(this.endpoints[0].setDeleteOnEmpty(params.deleteEndpointsOnEmpty),this.endpoints[1].setDeleteOnEmpty(params.deleteEndpointsOnEmpty));var _detachable=_jsPlumb.Defaults.ConnectionsDetachable;!1===params.detachable&&(_detachable=!1),!1===this.endpoints[0].connectionsDetachable&&(_detachable=!1),!1===this.endpoints[1].connectionsDetachable&&(_detachable=!1);var _reattach=params.reattach||this.endpoints[0].reattachConnections||this.endpoints[1].reattachConnections||_jsPlumb.Defaults.ReattachConnections;this.appendToDefaultType({detachable:_detachable,reattach:_reattach,paintStyle:this.endpoints[0].connectorStyle||this.endpoints[1].connectorStyle||params.paintStyle||_jsPlumb.Defaults.PaintStyle||_jp.Defaults.PaintStyle,hoverPaintStyle:this.endpoints[0].connectorHoverStyle||this.endpoints[1].connectorHoverStyle||params.hoverPaintStyle||_jsPlumb.Defaults.HoverPaintStyle||_jp.Defaults.HoverPaintStyle});var _suspendedAt=_jsPlumb.getSuspendedAt();if(!_jsPlumb.isSuspendDrawing()){var myInfo=_jsPlumb.getCachedData(this.sourceId),myOffset=myInfo.o,myWH=myInfo.s,otherInfo=_jsPlumb.getCachedData(this.targetId),otherOffset=otherInfo.o,otherWH=otherInfo.s,initialTimestamp=_suspendedAt||_jsPlumb.timestamp(),anchorLoc=this.endpoints[0].anchor.compute({xy:[myOffset.left,myOffset.top],wh:myWH,element:this.endpoints[0],elementId:this.endpoints[0].elementId,txy:[otherOffset.left,otherOffset.top],twh:otherWH,tElement:this.endpoints[1],timestamp:initialTimestamp});this.endpoints[0].paint({anchorLoc:anchorLoc,timestamp:initialTimestamp}),anchorLoc=this.endpoints[1].anchor.compute({xy:[otherOffset.left,otherOffset.top],wh:otherWH,element:this.endpoints[1],elementId:this.endpoints[1].elementId,txy:[myOffset.left,myOffset.top],twh:myWH,tElement:this.endpoints[0],timestamp:initialTimestamp}),this.endpoints[1].paint({anchorLoc:anchorLoc,timestamp:initialTimestamp})}this.getTypeDescriptor=function(){return"connection"},this.getAttachedElements=function(){return this.endpoints},this.isDetachable=function(ep){return null!=ep?!0===ep.connectionsDetachable:!0===this._jsPlumb.detachable},this.setDetachable=function(detachable){this._jsPlumb.detachable=!0===detachable},this.isReattach=function(){return!0===this._jsPlumb.reattach||!0===this.endpoints[0].reattachConnections||!0===this.endpoints[1].reattachConnections},this.setReattach=function(reattach){this._jsPlumb.reattach=!0===reattach},this._jsPlumb.cost=params.cost||this.endpoints[0].getConnectionCost(),this._jsPlumb.directed=params.directed,null==params.directed&&(this._jsPlumb.directed=this.endpoints[0].areConnectionsDirected());var _p=_jp.extend({},this.endpoints[1].getParameters());_jp.extend(_p,this.endpoints[0].getParameters()),_jp.extend(_p,this.getParameters()),this.setParameters(_p),this.setConnector(this.endpoints[0].connector||this.endpoints[1].connector||params.connector||_jsPlumb.Defaults.Connector||_jp.Defaults.Connector,!0);var data=null!=params.data&&_ju.isObject(params.data)?params.data:{};this.getData=function(){return data},this.setData=function(d){data=d||{}},this.mergeData=function(d){data=_jp.extend(data,d)};var _types=["default",this.endpoints[0].connectionType,this.endpoints[1].connectionType,params.type].join(" ");/[^\s]/.test(_types)&&this.addType(_types,params.data,!0),this.updateConnectedClass()},_ju.extend(_jp.Connection,_jp.OverlayCapableJsPlumbUIComponent,{applyType:function(t,doNotRepaint,typeMap){var _connector=null;null!=t.connector&&(null==(_connector=this.getCachedTypeItem("connector",typeMap.connector))&&(_connector=this.prepareConnector(t.connector,typeMap.connector),this.cacheTypeItem("connector",_connector,typeMap.connector)),this.setPreparedConnector(_connector)),null!=t.detachable&&this.setDetachable(t.detachable),null!=t.reattach&&this.setReattach(t.reattach),t.scope&&(this.scope=t.scope),null!=t.cssClass&&this.canvas&&this._jsPlumb.instance.addClass(this.canvas,t.cssClass);var _anchors=null;t.anchor?null==(_anchors=this.getCachedTypeItem("anchors",typeMap.anchor))&&(_anchors=[this._jsPlumb.instance.makeAnchor(t.anchor),this._jsPlumb.instance.makeAnchor(t.anchor)],this.cacheTypeItem("anchors",_anchors,typeMap.anchor)):t.anchors&&null==(_anchors=this.getCachedTypeItem("anchors",typeMap.anchors))&&(_anchors=[this._jsPlumb.instance.makeAnchor(t.anchors[0]),this._jsPlumb.instance.makeAnchor(t.anchors[1])],this.cacheTypeItem("anchors",_anchors,typeMap.anchors)),null!=_anchors&&(this.endpoints[0].anchor=_anchors[0],this.endpoints[1].anchor=_anchors[1],this.endpoints[1].anchor.isDynamic&&this._jsPlumb.instance.repaint(this.endpoints[1].elementId)),_jp.OverlayCapableJsPlumbUIComponent.applyType(this,t)},addClass:function(c,informEndpoints){informEndpoints&&(this.endpoints[0].addClass(c),this.endpoints[1].addClass(c),this.suspendedEndpoint&&this.suspendedEndpoint.addClass(c)),this.connector&&this.connector.addClass(c)},removeClass:function(c,informEndpoints){informEndpoints&&(this.endpoints[0].removeClass(c),this.endpoints[1].removeClass(c),this.suspendedEndpoint&&this.suspendedEndpoint.removeClass(c)),this.connector&&this.connector.removeClass(c)},isVisible:function(){return this._jsPlumb.visible},setVisible:function(v){this._jsPlumb.visible=v,this.connector&&this.connector.setVisible(v),this.repaint()},cleanup:function(){this.updateConnectedClass(!0),this.endpoints=null,this.source=null,(this.target=null)!=this.connector&&(this.connector.cleanup(!0),this.connector.destroy(!0)),this.connector=null},updateConnectedClass:function(remove){this._jsPlumb&&(_updateConnectedClass(this,this.source,this._jsPlumb.instance,remove),_updateConnectedClass(this,this.target,this._jsPlumb.instance,remove))},setHover:function(state){this.connector&&this._jsPlumb&&!this._jsPlumb.instance.isConnectionBeingDragged()&&(this.connector.setHover(state),root.jsPlumb[state?"addClass":"removeClass"](this.source,this._jsPlumb.instance.hoverSourceClass),root.jsPlumb[state?"addClass":"removeClass"](this.target,this._jsPlumb.instance.hoverTargetClass))},getUuids:function(){return[this.endpoints[0].getUuid(),this.endpoints[1].getUuid()]},getCost:function(){return this._jsPlumb?this._jsPlumb.cost:-1/0},setCost:function(c){this._jsPlumb.cost=c},isDirected:function(){return this._jsPlumb.directed},getConnector:function(){return this.connector},prepareConnector:function(connectorSpec,typeId){var connector,connectorArgs={_jsPlumb:this._jsPlumb.instance,cssClass:this._jsPlumb.params.cssClass,container:this._jsPlumb.params.container,"pointer-events":this._jsPlumb.params["pointer-events"]},renderMode=this._jsPlumb.instance.getRenderMode();return _ju.isString(connectorSpec)?connector=makeConnector(this._jsPlumb.instance,renderMode,connectorSpec,connectorArgs,this):_ju.isArray(connectorSpec)&&(connector=1===connectorSpec.length?makeConnector(this._jsPlumb.instance,renderMode,connectorSpec[0],connectorArgs,this):makeConnector(this._jsPlumb.instance,renderMode,connectorSpec[0],_ju.merge(connectorSpec[1],connectorArgs),this)),null!=typeId&&(connector.typeId=typeId),connector},setPreparedConnector:function(connector,doNotRepaint,doNotChangeListenerComponent,typeId){if(this.connector!==connector){var previous,previousClasses="";if(null!=this.connector&&(previousClasses=(previous=this.connector).getClass(),this.connector.cleanup(),this.connector.destroy()),this.connector=connector,typeId&&this.cacheTypeItem("connector",connector,typeId),this.canvas=this.connector.canvas,this.bgCanvas=this.connector.bgCanvas,this.addClass(previousClasses),this.canvas&&(this.canvas._jsPlumb=this),this.bgCanvas&&(this.bgCanvas._jsPlumb=this),null!=previous)for(var o=this.getOverlays(),i=0;i<o.length;i++)o[i].transfer&&o[i].transfer(this.connector);doNotChangeListenerComponent||this.setListenerComponent(this.connector),doNotRepaint||this.repaint()}},setConnector:function(connectorSpec,doNotRepaint,doNotChangeListenerComponent,typeId){var connector=this.prepareConnector(connectorSpec,typeId);this.setPreparedConnector(connector,doNotRepaint,doNotChangeListenerComponent,typeId)},paint:function(params){if(!this._jsPlumb.instance.isSuspendDrawing()&&this._jsPlumb.visible){var timestamp=(params=params||{}).timestamp,tId=this.targetId,sId=this.sourceId;if(null==timestamp||timestamp!==this._jsPlumb.lastPaintedAt){var sourceInfo=this._jsPlumb.instance.updateOffset({elId:sId}).o,targetInfo=this._jsPlumb.instance.updateOffset({elId:tId}).o,sE=this.endpoints[0],tE=this.endpoints[1],sAnchorP=sE.anchor.getCurrentLocation({xy:[sourceInfo.left,sourceInfo.top],wh:[sourceInfo.width,sourceInfo.height],element:sE,timestamp:timestamp}),tAnchorP=tE.anchor.getCurrentLocation({xy:[targetInfo.left,targetInfo.top],wh:[targetInfo.width,targetInfo.height],element:tE,timestamp:timestamp});this.connector.resetBounds(),this.connector.compute({sourcePos:sAnchorP,targetPos:tAnchorP,sourceOrientation:sE.anchor.getOrientation(sE),targetOrientation:tE.anchor.getOrientation(tE),sourceEndpoint:this.endpoints[0],targetEndpoint:this.endpoints[1],"stroke-width":this._jsPlumb.paintStyleInUse.strokeWidth,sourceInfo:sourceInfo,targetInfo:targetInfo});var overlayExtents={minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};for(var i in this._jsPlumb.overlays)if(this._jsPlumb.overlays.hasOwnProperty(i)){var o=this._jsPlumb.overlays[i];o.isVisible()&&(this._jsPlumb.overlayPlacements[i]=o.draw(this.connector,this._jsPlumb.paintStyleInUse,this.getAbsoluteOverlayPosition(o)),overlayExtents.minX=Math.min(overlayExtents.minX,this._jsPlumb.overlayPlacements[i].minX),overlayExtents.maxX=Math.max(overlayExtents.maxX,this._jsPlumb.overlayPlacements[i].maxX),overlayExtents.minY=Math.min(overlayExtents.minY,this._jsPlumb.overlayPlacements[i].minY),overlayExtents.maxY=Math.max(overlayExtents.maxY,this._jsPlumb.overlayPlacements[i].maxY))}var lineWidth=parseFloat(this._jsPlumb.paintStyleInUse.strokeWidth||1)/2,outlineWidth=parseFloat(this._jsPlumb.paintStyleInUse.strokeWidth||0),extents={xmin:Math.min(this.connector.bounds.minX-(lineWidth+outlineWidth),overlayExtents.minX),ymin:Math.min(this.connector.bounds.minY-(lineWidth+outlineWidth),overlayExtents.minY),xmax:Math.max(this.connector.bounds.maxX+(lineWidth+outlineWidth),overlayExtents.maxX),ymax:Math.max(this.connector.bounds.maxY+(lineWidth+outlineWidth),overlayExtents.maxY)};for(var j in this.connector.paint(this._jsPlumb.paintStyleInUse,null,extents),this._jsPlumb.overlays)if(this._jsPlumb.overlays.hasOwnProperty(j)){var p=this._jsPlumb.overlays[j];p.isVisible()&&p.paint(this._jsPlumb.overlayPlacements[j],extents)}}this._jsPlumb.lastPaintedAt=timestamp}},repaint:function(params){var p=jsPlumb.extend(params||{},{});p.elId=this.sourceId,this.paint(p)},prepareEndpoint:function(_jsPlumb,_newEndpoint,conn,existing,index,params,element,elementId){var e;if(existing)(conn.endpoints[index]=existing).addConnection(conn);else{params.endpoints||(params.endpoints=[null,null]);var ep=params.endpoints[index]||params.endpoint||_jsPlumb.Defaults.Endpoints[index]||_jp.Defaults.Endpoints[index]||_jsPlumb.Defaults.Endpoint||_jp.Defaults.Endpoint;params.endpointStyles||(params.endpointStyles=[null,null]),params.endpointHoverStyles||(params.endpointHoverStyles=[null,null]);var es=params.endpointStyles[index]||params.endpointStyle||_jsPlumb.Defaults.EndpointStyles[index]||_jp.Defaults.EndpointStyles[index]||_jsPlumb.Defaults.EndpointStyle||_jp.Defaults.EndpointStyle;null==es.fill&&null!=params.paintStyle&&(es.fill=params.paintStyle.stroke),null==es.outlineStroke&&null!=params.paintStyle&&(es.outlineStroke=params.paintStyle.outlineStroke),null==es.outlineWidth&&null!=params.paintStyle&&(es.outlineWidth=params.paintStyle.outlineWidth);var ehs=params.endpointHoverStyles[index]||params.endpointHoverStyle||_jsPlumb.Defaults.EndpointHoverStyles[index]||_jp.Defaults.EndpointHoverStyles[index]||_jsPlumb.Defaults.EndpointHoverStyle||_jp.Defaults.EndpointHoverStyle;null!=params.hoverPaintStyle&&(null==ehs&&(ehs={}),null==ehs.fill&&(ehs.fill=params.hoverPaintStyle.stroke));var a=params.anchors?params.anchors[index]:params.anchor?params.anchor:_makeAnchor(_jsPlumb.Defaults.Anchors[index],elementId,_jsPlumb)||_makeAnchor(_jp.Defaults.Anchors[index],elementId,_jsPlumb)||_makeAnchor(_jsPlumb.Defaults.Anchor,elementId,_jsPlumb)||_makeAnchor(_jp.Defaults.Anchor,elementId,_jsPlumb);e=_newEndpoint({paintStyle:es,hoverPaintStyle:ehs,endpoint:ep,connections:[conn],uuid:params.uuids?params.uuids[index]:null,anchor:a,source:element,scope:params.scope,reattach:params.reattach||_jsPlumb.Defaults.ReattachConnections,detachable:params.detachable||_jsPlumb.Defaults.ConnectionsDetachable}),null==existing&&e.setDeleteOnEmpty(!0),conn.endpoints[index]=e,!1===params.drawEndpoints&&e.setVisible(!1,!0,!0)}return e}})}.call("undefined"!=typeof window?window:this),function(){"use strict";var _ju=this.jsPlumbUtil,_jp=this.jsPlumb;_jp.AnchorManager=function(params){var _amEndpoints={},continuousAnchorLocations={},continuousAnchorOrientations={},connectionsByElementId={},self=this,anchorLists={},jsPlumbInstance=params.jsPlumbInstance,floatingConnections={},currySort=function(reverseAngles){return function(a,b){return!1===(reverseAngles?a[0][0]<b[0][0]:a[0][0]>b[0][0])?-1:1}},edgeSortFunctions={top:function(a,b){return a[0]>b[0]?1:-1},right:currySort(!0),bottom:currySort(!0),left:function(a,b){var p1=a[0][0]<0?-Math.PI-a[0][0]:Math.PI-a[0][0];return(b[0][0]<0?-Math.PI-b[0][0]:Math.PI-b[0][0])<p1?1:-1}},placeAnchors=function(elementId,_anchorLists){var cd=jsPlumbInstance.getCachedData(elementId),sS=cd.s,sO=cd.o,placeSomeAnchors=function(desc,elementDimensions,elementPosition,unsortedConnections,isHorizontal,otherMultiplier,orientation){if(0<unsortedConnections.length)for(var anchors=function(desc,elementDimensions,elementPosition,connections,horizontal,otherMultiplier,reverse){for(var a=[],step=elementDimensions[horizontal?0:1]/(connections.length+1),i=0;i<connections.length;i++){var val=(i+1)*step,other=otherMultiplier*elementDimensions[horizontal?1:0];reverse&&(val=elementDimensions[horizontal?0:1]-val);var dx=horizontal?val:other,x=elementPosition[0]+dx,xp=dx/elementDimensions[0],dy=horizontal?other:val,y=elementPosition[1]+dy,yp=dy/elementDimensions[1];a.push([x,y,xp,yp,connections[i][1],connections[i][2]])}return a}(0,elementDimensions,elementPosition,(_fn=edgeSortFunctions[desc],unsortedConnections.sort(_fn)),isHorizontal,otherMultiplier,"right"===desc||"top"===desc),_setAnchorLocation=function(endpoint,anchorPos){continuousAnchorLocations[endpoint.id]=[anchorPos[0],anchorPos[1],anchorPos[2],anchorPos[3]],continuousAnchorOrientations[endpoint.id]=orientation},i=0;i<anchors.length;i++){var c=anchors[i][4],weAreSource=c.endpoints[0].elementId===elementId,weAreTarget=c.endpoints[1].elementId===elementId;weAreSource&&_setAnchorLocation(c.endpoints[0],anchors[i]),weAreTarget&&_setAnchorLocation(c.endpoints[1],anchors[i])}var _fn};placeSomeAnchors("bottom",sS,[sO.left,sO.top],_anchorLists.bottom,!0,1,[0,1]),placeSomeAnchors("top",sS,[sO.left,sO.top],_anchorLists.top,!0,0,[0,-1]),placeSomeAnchors("left",sS,[sO.left,sO.top],_anchorLists.left,!1,0,[-1,0]),placeSomeAnchors("right",sS,[sO.left,sO.top],_anchorLists.right,!1,1,[1,0])};this.reset=function(){_amEndpoints={},connectionsByElementId={},anchorLists={}},this.addFloatingConnection=function(key,conn){floatingConnections[key]=conn},this.removeFloatingConnection=function(key){delete floatingConnections[key]},this.newConnection=function(conn){var sourceId=conn.sourceId,targetId=conn.targetId,ep=conn.endpoints,doRegisterTarget=!0,registerConnection=function(otherIndex,otherEndpoint,otherAnchor,elId,c){sourceId===targetId&&otherAnchor.isContinuous&&(conn._jsPlumb.instance.removeElement(ep[1].canvas),doRegisterTarget=!1),_ju.addToList(connectionsByElementId,elId,[c,otherEndpoint,otherAnchor.constructor===_jp.DynamicAnchor])};registerConnection(0,ep[0],ep[0].anchor,targetId,conn),doRegisterTarget&&registerConnection(0,ep[1],ep[1].anchor,sourceId,conn)};var removeEndpointFromAnchorLists=function(endpoint){!function(list,eId){if(list){var f=function(e){return e[4]===eId};_ju.removeWithFunction(list.top,f),_ju.removeWithFunction(list.left,f),_ju.removeWithFunction(list.bottom,f),_ju.removeWithFunction(list.right,f)}}(anchorLists[endpoint.elementId],endpoint.id)};this.connectionDetached=function(connInfo,doNotRedraw){var connection=connInfo.connection||connInfo,sourceId=connInfo.sourceId,targetId=connInfo.targetId,ep=connection.endpoints,removeConnection=function(otherIndex,otherEndpoint,otherAnchor,elId,c){_ju.removeWithFunction(connectionsByElementId[elId],function(_c){return _c[0].id===c.id})};removeConnection(0,ep[1],ep[1].anchor,sourceId,connection),removeConnection(0,ep[0],ep[0].anchor,targetId,connection),connection.floatingId&&(removeConnection(connection.floatingIndex,connection.floatingEndpoint,connection.floatingEndpoint.anchor,connection.floatingId,connection),removeEndpointFromAnchorLists(connection.floatingEndpoint)),removeEndpointFromAnchorLists(connection.endpoints[0]),removeEndpointFromAnchorLists(connection.endpoints[1]),doNotRedraw||(self.redraw(connection.sourceId),connection.targetId!==connection.sourceId&&self.redraw(connection.targetId))},this.add=function(endpoint,elementId){_ju.addToList(_amEndpoints,elementId,endpoint)},this.changeId=function(oldId,newId){connectionsByElementId[newId]=connectionsByElementId[oldId],_amEndpoints[newId]=_amEndpoints[oldId],delete connectionsByElementId[oldId],delete _amEndpoints[oldId]},this.getConnectionsFor=function(elementId){return connectionsByElementId[elementId]||[]},this.getEndpointsFor=function(elementId){return _amEndpoints[elementId]||[]},this.deleteEndpoint=function(endpoint){_ju.removeWithFunction(_amEndpoints[endpoint.elementId],function(e){return e.id===endpoint.id}),removeEndpointFromAnchorLists(endpoint)},this.clearFor=function(elementId){delete _amEndpoints[elementId],_amEndpoints[elementId]=[]};var _updateAnchorList=function(lists,theta,order,conn,aBoolean,otherElId,idx,reverse,edgeId,elId,connsToPaint,endpointsToPaint){var i,candidate,firstMatchingElIdx=-1,endpoint=conn.endpoints[idx],endpointId=endpoint.id,oIdx=[1,0][idx],values=[[theta,order],conn,aBoolean,otherElId,endpointId],listToAddTo=lists[edgeId],listToRemoveFrom=endpoint._continuousAnchorEdge?lists[endpoint._continuousAnchorEdge]:null;if(listToRemoveFrom){var rIdx=_ju.findWithFunction(listToRemoveFrom,function(e){return e[4]===endpointId});if(-1!==rIdx)for(listToRemoveFrom.splice(rIdx,1),i=0;i<listToRemoveFrom.length;i++)candidate=listToRemoveFrom[i][1],_ju.addWithFunction(connsToPaint,candidate,function(c){return c.id===candidate.id}),_ju.addWithFunction(endpointsToPaint,listToRemoveFrom[i][1].endpoints[idx],function(e){return e.id===candidate.endpoints[idx].id}),_ju.addWithFunction(endpointsToPaint,listToRemoveFrom[i][1].endpoints[oIdx],function(e){return e.id===candidate.endpoints[oIdx].id})}for(i=0;i<listToAddTo.length;i++)candidate=listToAddTo[i][1],1===params.idx&&listToAddTo[i][3]===otherElId&&-1===firstMatchingElIdx&&(firstMatchingElIdx=i),_ju.addWithFunction(connsToPaint,candidate,function(c){return c.id===candidate.id}),_ju.addWithFunction(endpointsToPaint,listToAddTo[i][1].endpoints[idx],function(e){return e.id===candidate.endpoints[idx].id}),_ju.addWithFunction(endpointsToPaint,listToAddTo[i][1].endpoints[oIdx],function(e){return e.id===candidate.endpoints[oIdx].id});var insertIdx=reverse?-1!==firstMatchingElIdx?firstMatchingElIdx:0:listToAddTo.length;listToAddTo.splice(insertIdx,0,values),endpoint._continuousAnchorEdge=edgeId};this.updateOtherEndpoint=function(sourceElId,oldTargetId,newTargetId,connection){var sIndex=_ju.findWithFunction(connectionsByElementId[sourceElId],function(i){return i[0].id===connection.id}),tIndex=_ju.findWithFunction(connectionsByElementId[oldTargetId],function(i){return i[0].id===connection.id});-1!==sIndex&&(connectionsByElementId[sourceElId][sIndex][0]=connection,connectionsByElementId[sourceElId][sIndex][1]=connection.endpoints[1],connectionsByElementId[sourceElId][sIndex][2]=connection.endpoints[1].anchor.constructor===_jp.DynamicAnchor),-1<tIndex&&(connectionsByElementId[oldTargetId].splice(tIndex,1),_ju.addToList(connectionsByElementId,newTargetId,[connection,connection.endpoints[0],connection.endpoints[0].anchor.constructor===_jp.DynamicAnchor])),connection.updateConnectedClass()},this.sourceChanged=function(originalId,newId,connection,newElement){if(originalId!==newId){connection.sourceId=newId,connection.source=newElement,_ju.removeWithFunction(connectionsByElementId[originalId],function(info){return info[0].id===connection.id});var tIdx=_ju.findWithFunction(connectionsByElementId[connection.targetId],function(i){return i[0].id===connection.id});-1<tIdx&&(connectionsByElementId[connection.targetId][tIdx][0]=connection,connectionsByElementId[connection.targetId][tIdx][1]=connection.endpoints[0],connectionsByElementId[connection.targetId][tIdx][2]=connection.endpoints[0].anchor.constructor===_jp.DynamicAnchor),_ju.addToList(connectionsByElementId,newId,[connection,connection.endpoints[1],connection.endpoints[1].anchor.constructor===_jp.DynamicAnchor]),connection.endpoints[1].anchor.isContinuous&&(connection.source===connection.target?connection._jsPlumb.instance.removeElement(connection.endpoints[1].canvas):null==connection.endpoints[1].canvas.parentNode&&connection._jsPlumb.instance.appendElement(connection.endpoints[1].canvas)),connection.updateConnectedClass()}},this.rehomeEndpoint=function(ep,currentId,element){var eps=_amEndpoints[currentId]||[],elementId=jsPlumbInstance.getId(element);if(elementId!==currentId){var idx=eps.indexOf(ep);if(-1<idx){var _ep=eps.splice(idx,1)[0];self.add(_ep,elementId)}}for(var i=0;i<ep.connections.length;i++)ep.connections[i].sourceId===currentId?self.sourceChanged(currentId,ep.elementId,ep.connections[i],ep.element):ep.connections[i].targetId===currentId&&(ep.connections[i].targetId=ep.elementId,ep.connections[i].target=ep.element,self.updateOtherEndpoint(ep.connections[i].sourceId,currentId,ep.elementId,ep.connections[i]))},this.redraw=function(elementId,ui,timestamp,offsetToUI,clearEdits,doNotRecalcEndpoint){if(!jsPlumbInstance.isSuspendDrawing()){var ep=_amEndpoints[elementId]||[],endpointConnections=connectionsByElementId[elementId]||[],connectionsToPaint=[],endpointsToPaint=[],anchorsToUpdate=[];timestamp=timestamp||jsPlumbInstance.timestamp(),offsetToUI=offsetToUI||{left:0,top:0},ui&&(ui={left:ui.left+offsetToUI.left,top:ui.top+offsetToUI.top});for(var myOffset=jsPlumbInstance.updateOffset({elId:elementId,offset:ui,recalc:!1,timestamp:timestamp}),orientationCache={},i=0;i<endpointConnections.length;i++){var conn=endpointConnections[i][0],sourceId=conn.sourceId,targetId=conn.targetId,sourceContinuous=conn.endpoints[0].anchor.isContinuous,targetContinuous=conn.endpoints[1].anchor.isContinuous;if(sourceContinuous||targetContinuous){var oKey=sourceId+"_"+targetId,o=orientationCache[oKey],oIdx=conn.sourceId===elementId?1:0;sourceContinuous&&!anchorLists[sourceId]&&(anchorLists[sourceId]={top:[],right:[],bottom:[],left:[]}),targetContinuous&&!anchorLists[targetId]&&(anchorLists[targetId]={top:[],right:[],bottom:[],left:[]}),elementId!==targetId&&jsPlumbInstance.updateOffset({elId:targetId,timestamp:timestamp}),elementId!==sourceId&&jsPlumbInstance.updateOffset({elId:sourceId,timestamp:timestamp});var td=jsPlumbInstance.getCachedData(targetId),sd=jsPlumbInstance.getCachedData(sourceId);targetId===sourceId&&(sourceContinuous||targetContinuous)?(_updateAnchorList(anchorLists[sourceId],-Math.PI/2,0,conn,!1,targetId,0,!1,"top",0,connectionsToPaint,endpointsToPaint),_updateAnchorList(anchorLists[targetId],-Math.PI/2,0,conn,!1,sourceId,1,!1,"top",0,connectionsToPaint,endpointsToPaint)):(o||(o=this.calculateOrientation(sourceId,targetId,sd.o,td.o,conn.endpoints[0].anchor,conn.endpoints[1].anchor,conn),orientationCache[oKey]=o),sourceContinuous&&_updateAnchorList(anchorLists[sourceId],o.theta,0,conn,!1,targetId,0,!1,o.a[0],0,connectionsToPaint,endpointsToPaint),targetContinuous&&_updateAnchorList(anchorLists[targetId],o.theta2,-1,conn,!0,sourceId,1,!0,o.a[1],0,connectionsToPaint,endpointsToPaint)),sourceContinuous&&_ju.addWithFunction(anchorsToUpdate,sourceId,function(a){return a===sourceId}),targetContinuous&&_ju.addWithFunction(anchorsToUpdate,targetId,function(a){return a===targetId}),_ju.addWithFunction(connectionsToPaint,conn,function(c){return c.id===conn.id}),(sourceContinuous&&0===oIdx||targetContinuous&&1===oIdx)&&_ju.addWithFunction(endpointsToPaint,conn.endpoints[oIdx],function(e){return e.id===conn.endpoints[oIdx].id})}}for(i=0;i<ep.length;i++)0===ep[i].connections.length&&ep[i].anchor.isContinuous&&(anchorLists[elementId]||(anchorLists[elementId]={top:[],right:[],bottom:[],left:[]}),_updateAnchorList(anchorLists[elementId],-Math.PI/2,0,{endpoints:[ep[i],ep[i]],paint:function(){}},!1,elementId,0,!1,ep[i].anchor.getDefaultFace(),0,connectionsToPaint,endpointsToPaint),_ju.addWithFunction(anchorsToUpdate,elementId,function(a){return a===elementId}));for(i=0;i<anchorsToUpdate.length;i++)placeAnchors(anchorsToUpdate[i],anchorLists[anchorsToUpdate[i]]);for(i=0;i<ep.length;i++)ep[i].paint({timestamp:timestamp,offset:myOffset,dimensions:myOffset.s,recalc:!0!==doNotRecalcEndpoint});for(i=0;i<endpointsToPaint.length;i++){var cd=jsPlumbInstance.getCachedData(endpointsToPaint[i].elementId);endpointsToPaint[i].paint({timestamp:null,offset:cd,dimensions:cd.s})}for(i=0;i<endpointConnections.length;i++){var otherEndpoint=endpointConnections[i][1];if(otherEndpoint.anchor.constructor===_jp.DynamicAnchor){otherEndpoint.paint({elementWithPrecedence:elementId,timestamp:timestamp}),_ju.addWithFunction(connectionsToPaint,endpointConnections[i][0],function(c){return c.id===endpointConnections[i][0].id});for(var k=0;k<otherEndpoint.connections.length;k++)otherEndpoint.connections[k]!==endpointConnections[i][0]&&_ju.addWithFunction(connectionsToPaint,otherEndpoint.connections[k],function(c){return c.id===otherEndpoint.connections[k].id})}else _ju.addWithFunction(connectionsToPaint,endpointConnections[i][0],function(c){return c.id===endpointConnections[i][0].id})}var fc=floatingConnections[elementId];for(fc&&fc.paint({timestamp:timestamp,recalc:!1,elId:elementId}),i=0;i<connectionsToPaint.length;i++)connectionsToPaint[i].paint({elId:elementId,timestamp:null,recalc:!1,clearEdits:clearEdits})}};var ContinuousAnchor=function(anchorParams){_ju.EventGenerator.apply(this),this.type="Continuous",this.isDynamic=!0,this.isContinuous=!0;for(var faces=anchorParams.faces||["top","right","bottom","left"],clockwise=!(!1===anchorParams.clockwise),availableFaces={},opposites={top:"bottom",right:"left",left:"right",bottom:"top"},clockwiseOptions={top:"right",right:"bottom",left:"top",bottom:"left"},antiClockwiseOptions={top:"left",right:"top",left:"bottom",bottom:"right"},secondBest=clockwise?clockwiseOptions:antiClockwiseOptions,lastChoice=clockwise?antiClockwiseOptions:clockwiseOptions,cssClass=anchorParams.cssClass||"",_currentFace=null,_lockedFace=null,X_AXIS_FACES=["left","right"],Y_AXIS_FACES=["top","bottom"],_lockedAxis=null,i=0;i<faces.length;i++)availableFaces[faces[i]]=!0;this.getDefaultFace=function(){return 0===faces.length?"top":faces[0]},this.isRelocatable=function(){return!0},this.isSnapOnRelocate=function(){return!0},this.verifyEdge=function(edge){return availableFaces[edge]?edge:availableFaces[opposites[edge]]?opposites[edge]:availableFaces[secondBest[edge]]?secondBest[edge]:availableFaces[lastChoice[edge]]?lastChoice[edge]:edge},this.isEdgeSupported=function(edge){return null==_lockedAxis?null==_lockedFace?!0===availableFaces[edge]:_lockedFace===edge:-1!==_lockedAxis.indexOf(edge)},this.setCurrentFace=function(face,overrideLock){_currentFace=face,overrideLock&&null!=_lockedFace&&(_lockedFace=_currentFace)},this.getCurrentFace=function(){return _currentFace},this.getSupportedFaces=function(){var af=[];for(var k in availableFaces)availableFaces[k]&&af.push(k);return af},this.lock=function(){_lockedFace=_currentFace},this.unlock=function(){_lockedFace=null},this.isLocked=function(){return null!=_lockedFace},this.lockCurrentAxis=function(){null!=_currentFace&&(_lockedAxis="left"===_currentFace||"right"===_currentFace?X_AXIS_FACES:Y_AXIS_FACES)},this.unlockCurrentAxis=function(){_lockedAxis=null},this.compute=function(params){return continuousAnchorLocations[params.element.id]||[0,0]},this.getCurrentLocation=function(params){return continuousAnchorLocations[params.element.id]||[0,0]},this.getOrientation=function(endpoint){return continuousAnchorOrientations[endpoint.id]||[0,0]},this.getCssClass=function(){return cssClass}};jsPlumbInstance.continuousAnchorFactory={get:function(params){return new ContinuousAnchor(params)},clear:function(elementId){delete continuousAnchorLocations[elementId]}}},_jp.AnchorManager.prototype.calculateOrientation=function(sourceId,targetId,sd,td,sourceAnchor,targetAnchor){var axes=["left","top","right","bottom"];if(sourceId===targetId)return{orientation:"identity",a:["top","top"]};var theta=Math.atan2(td.centery-sd.centery,td.centerx-sd.centerx),theta2=Math.atan2(sd.centery-td.centery,sd.centerx-td.centerx),candidates=[],midpoints={};!function(types,dim){for(var i=0;i<types.length;i++)midpoints[types[i]]={left:[dim[i].left,dim[i].centery],right:[dim[i].right,dim[i].centery],top:[dim[i].centerx,dim[i].top],bottom:[dim[i].centerx,dim[i].bottom]}}(["source","target"],[sd,td]);for(var sf=0;sf<axes.length;sf++)for(var tf=0;tf<axes.length;tf++)candidates.push({source:axes[sf],target:axes[tf],dist:Biltong.lineLength(midpoints.source[axes[sf]],midpoints.target[axes[tf]])});candidates.sort(function(a,b){return a.dist<b.dist?-1:a.dist>b.dist?1:0});for(var sourceEdge=candidates[0].source,targetEdge=candidates[0].target,i=0;i<candidates.length&&(sourceEdge=!sourceAnchor.isContinuous||sourceAnchor.isEdgeSupported(candidates[i].source)?candidates[i].source:null,targetEdge=!targetAnchor.isContinuous||targetAnchor.isEdgeSupported(candidates[i].target)?candidates[i].target:null,null==sourceEdge||null==targetEdge);i++);return sourceAnchor.isContinuous&&sourceAnchor.setCurrentFace(sourceEdge),targetAnchor.isContinuous&&targetAnchor.setCurrentFace(targetEdge),{a:[sourceEdge,targetEdge],theta:theta,theta2:theta2}},_jp.Anchor=function(params){this.x=params.x||0,this.y=params.y||0,this.elementId=params.elementId,this.cssClass=params.cssClass||"",this.userDefinedLocation=null,this.orientation=params.orientation||[0,0],this.lastReturnValue=null,this.offsets=params.offsets||[0,0],this.timestamp=null;var relocatable=!1!==params.relocatable;this.isRelocatable=function(){return relocatable};var snapOnRelocate=!(this.setRelocatable=function(_relocatable){relocatable=_relocatable})!==params.snapOnRelocate,locked=!(this.isSnapOnRelocate=function(){return snapOnRelocate});this.lock=function(){locked=!0},this.unlock=function(){locked=!1},this.isLocked=function(){return locked},_ju.EventGenerator.apply(this),this.compute=function(params){var xy=params.xy,wh=params.wh,timestamp=params.timestamp;return params.clearUserDefinedLocation&&(this.userDefinedLocation=null),timestamp&&timestamp===this.timestamp||(null!=this.userDefinedLocation?this.lastReturnValue=this.userDefinedLocation:this.lastReturnValue=[xy[0]+this.x*wh[0]+this.offsets[0],xy[1]+this.y*wh[1]+this.offsets[1],this.x,this.y],this.timestamp=timestamp),this.lastReturnValue},this.getCurrentLocation=function(params){return params=params||{},null==this.lastReturnValue||null!=params.timestamp&&this.timestamp!==params.timestamp?this.compute(params):this.lastReturnValue},this.setPosition=function(x,y,ox,oy,overrideLock){locked&&!overrideLock||(this.x=x,this.y=y,this.orientation=[ox,oy],this.lastReturnValue=null)}},_ju.extend(_jp.Anchor,_ju.EventGenerator,{equals:function(anchor){if(!anchor)return!1;var ao=anchor.getOrientation(),o=this.getOrientation();return this.x===anchor.x&&this.y===anchor.y&&this.offsets[0]===anchor.offsets[0]&&this.offsets[1]===anchor.offsets[1]&&o[0]===ao[0]&&o[1]===ao[1]},getUserDefinedLocation:function(){return this.userDefinedLocation},setUserDefinedLocation:function(l){this.userDefinedLocation=l},clearUserDefinedLocation:function(){this.userDefinedLocation=null},getOrientation:function(){return this.orientation},getCssClass:function(){return this.cssClass}}),_jp.FloatingAnchor=function(params){_jp.Anchor.apply(this,arguments);var ref=params.reference,refCanvas=params.referenceCanvas,size=_jp.getSize(refCanvas),orientation=null,_lastResult=null;this.orientation=null,this.x=0,this.y=0,this.isFloating=!0,this.compute=function(params){var xy=params.xy,result=[xy[0]+size[0]/2,xy[1]+size[1]/2];return _lastResult=result},this.getOrientation=function(_endpoint){if(orientation)return orientation;var o=ref.getOrientation(_endpoint);return[0*Math.abs(o[0])*-1,0*Math.abs(o[1])*-1]},this.over=function(anchor,endpoint){orientation=anchor.getOrientation(endpoint)},this.out=function(){orientation=null},this.getCurrentLocation=function(params){return null==_lastResult?this.compute(params):_lastResult}},_ju.extend(_jp.FloatingAnchor,_jp.Anchor);_jp.DynamicAnchor=function(params){_jp.Anchor.apply(this,arguments),this.isDynamic=!0,this.anchors=[],this.elementId=params.elementId,this.jsPlumbInstance=params.jsPlumbInstance;for(var i=0;i<params.anchors.length;i++)this.anchors[i]=(anchor=params.anchors[i],jsPlumbInstance=this.jsPlumbInstance,elementId=this.elementId,anchor.constructor===_jp.Anchor?anchor:jsPlumbInstance.makeAnchor(anchor,elementId,jsPlumbInstance));var anchor,jsPlumbInstance,elementId;this.getAnchors=function(){return this.anchors};var _curAnchor=0<this.anchors.length?this.anchors[0]:null,_lastAnchor=_curAnchor,self=this,_distance=function(anchor,cx,cy,xy,wh){var ax=xy[0]+anchor.x*wh[0],ay=xy[1]+anchor.y*wh[1],acx=xy[0]+wh[0]/2,acy=xy[1]+wh[1]/2;return Math.sqrt(Math.pow(cx-ax,2)+Math.pow(cy-ay,2))+Math.sqrt(Math.pow(acx-ax,2)+Math.pow(acy-ay,2))},_anchorSelector=params.selector||function(xy,wh,txy,twh,anchors){for(var cx=txy[0]+twh[0]/2,cy=txy[1]+twh[1]/2,minIdx=-1,minDist=1/0,i=0;i<anchors.length;i++){var d=_distance(anchors[i],cx,cy,xy,wh);d<minDist&&(minIdx=i+0,minDist=d)}return anchors[minIdx]};this.compute=function(params){var xy=params.xy,wh=params.wh,txy=params.txy,twh=params.twh;this.timestamp=params.timestamp;var udl=self.getUserDefinedLocation();return null!=udl?udl:this.isLocked()||null==txy||null==twh?_curAnchor.compute(params):(params.timestamp=null,_curAnchor=_anchorSelector(xy,wh,txy,twh,this.anchors),this.x=_curAnchor.x,this.y=_curAnchor.y,_curAnchor!==_lastAnchor&&this.fire("anchorChanged",_curAnchor),(_lastAnchor=_curAnchor).compute(params))},this.getCurrentLocation=function(params){return this.getUserDefinedLocation()||(null!=_curAnchor?_curAnchor.getCurrentLocation(params):null)},this.getOrientation=function(_endpoint){return null!=_curAnchor?_curAnchor.getOrientation(_endpoint):[0,0]},this.over=function(anchor,endpoint){null!=_curAnchor&&_curAnchor.over(anchor,endpoint)},this.out=function(){null!=_curAnchor&&_curAnchor.out()},this.setAnchor=function(a){_curAnchor=a},this.getCssClass=function(){return _curAnchor&&_curAnchor.getCssClass()||""},this.setAnchorCoordinates=function(coords){var idx=jsPlumbUtil.findWithFunction(this.anchors,function(a){return a.x===coords[0]&&a.y===coords[1]});return-1!==idx&&(this.setAnchor(this.anchors[idx]),!0)}},_ju.extend(_jp.DynamicAnchor,_jp.Anchor);var _curryAnchor=function(x,y,ox,oy,type,fnInit){_jp.Anchors[type]=function(params){var a=params.jsPlumbInstance.makeAnchor([x,y,ox,oy,0,0],params.elementId,params.jsPlumbInstance);return a.type=type,fnInit&&fnInit(a,params),a}};_curryAnchor(.5,0,0,-1,"TopCenter"),_curryAnchor(.5,1,0,1,"BottomCenter"),_curryAnchor(0,.5,-1,0,"LeftMiddle"),_curryAnchor(1,.5,1,0,"RightMiddle"),_curryAnchor(.5,0,0,-1,"Top"),_curryAnchor(.5,1,0,1,"Bottom"),_curryAnchor(0,.5,-1,0,"Left"),_curryAnchor(1,.5,1,0,"Right"),_curryAnchor(.5,.5,0,0,"Center"),_curryAnchor(1,0,0,-1,"TopRight"),_curryAnchor(1,1,0,1,"BottomRight"),_curryAnchor(0,0,0,-1,"TopLeft"),_curryAnchor(0,1,0,1,"BottomLeft"),_jp.Defaults.DynamicAnchors=function(params){return params.jsPlumbInstance.makeAnchors(["TopCenter","RightMiddle","BottomCenter","LeftMiddle"],params.elementId,params.jsPlumbInstance)},_jp.Anchors.AutoDefault=function(params){var a=params.jsPlumbInstance.makeDynamicAnchor(_jp.Defaults.DynamicAnchors(params));return a.type="AutoDefault",a};var _curryContinuousAnchor=function(type,faces){_jp.Anchors[type]=function(params){var a=params.jsPlumbInstance.makeAnchor(["Continuous",{faces:faces}],params.elementId,params.jsPlumbInstance);return a.type=type,a}};_jp.Anchors.Continuous=function(params){return params.jsPlumbInstance.continuousAnchorFactory.get(params)},_curryContinuousAnchor("ContinuousLeft",["left"]),_curryContinuousAnchor("ContinuousTop",["top"]),_curryContinuousAnchor("ContinuousBottom",["bottom"]),_curryContinuousAnchor("ContinuousRight",["right"]),_curryAnchor(0,0,0,0,"Assign",function(anchor,params){var pf=params.position||"Fixed";anchor.positionFinder=pf.constructor===String?params.jsPlumbInstance.AnchorPositionFinders[pf]:pf,anchor.constructorParams=params}),this.jsPlumbInstance.prototype.AnchorPositionFinders={Fixed:function(dp,ep,es){return[(dp.left-ep.left)/es[0],(dp.top-ep.top)/es[1]]},Grid:function(dp,ep,es,params){var dx=dp.left-ep.left,dy=dp.top-ep.top,gx=es[0]/params.grid[0],gy=es[1]/params.grid[1],mx=Math.floor(dx/gx),my=Math.floor(dy/gy);return[(mx*gx+gx/2)/es[0],(my*gy+gy/2)/es[1]]}},_jp.Anchors.Perimeter=function(params){var anchorCount=(params=params||{}).anchorCount||60,shape=params.shape;if(!shape)throw new Error("no shape supplied to Perimeter Anchor type");var _circle=function(){for(var step=2*Math.PI/anchorCount,current=0,a=[],i=0;i<anchorCount;i++){var x=.5+.5*Math.sin(current),y=.5+.5*Math.cos(current);a.push([x,y,0,0]),current+=step}return a},_path=function(segments){for(var anchorsPerFace=anchorCount/segments.length,a=[],_computeFace=function(x1,y1,x2,y2,fractionalLength){for(var dx=(x2-x1)/(anchorsPerFace=anchorCount*fractionalLength),dy=(y2-y1)/anchorsPerFace,i=0;i<anchorsPerFace;i++)a.push([x1+dx*i,y1+dy*i,0,0])},i=0;i<segments.length;i++)_computeFace.apply(null,segments[i]);return a},_shape=function(faces){for(var s=[],i=0;i<faces.length;i++)s.push([faces[i][0],faces[i][1],faces[i][2],faces[i][3],1/faces.length]);return _path(s)},_rectangle=function(){return _shape([[0,0,1,0],[1,0,1,1],[1,1,0,1],[0,1,0,0]])},_shapes={Circle:_circle,Ellipse:_circle,Diamond:function(){return _shape([[.5,0,1,.5],[1,.5,.5,1],[.5,1,0,.5],[0,.5,.5,0]])},Rectangle:_rectangle,Square:_rectangle,Triangle:function(){return _shape([[.5,0,1,1],[1,1,0,1],[0,1,.5,0]])},Path:function(params){for(var points=params.points,p=[],tl=0,i=0;i<points.length-1;i++){var l=Math.sqrt(Math.pow(points[i][2]-points[i][0])+Math.pow(points[i][3]-points[i][1]));tl+=l,p.push([points[i][0],points[i][1],points[i+1][0],points[i+1][1],l])}for(var j=0;j<p.length;j++)p[j][4]=p[j][4]/tl;return _path(p)}};if(!_shapes[shape])throw new Error("Shape ["+shape+"] is unknown by Perimeter Anchor type");var da=_shapes[shape](params);params.rotation&&(da=function(points,amountInDegrees){for(var o=[],theta=amountInDegrees/180*Math.PI,i=0;i<points.length;i++){var _x=points[i][0]-.5,_y=points[i][1]-.5;o.push([_x*Math.cos(theta)-_y*Math.sin(theta)+.5,_x*Math.sin(theta)+_y*Math.cos(theta)+.5,points[i][2],points[i][3]])}return o}(da,params.rotation));var a=params.jsPlumbInstance.makeDynamicAnchor(da);return a.type="Perimeter",a}}.call("undefined"!=typeof window?window:this),function(){"use strict";var root=this,_jp=root.jsPlumb,_ju=root.jsPlumbUtil,_jg=root.Biltong;_jp.Segments={AbstractSegment:function(params){this.params=params,this.findClosestPointOnPath=function(x,y){return{d:1/0,x:null,y:null,l:null}},this.getBounds=function(){return{minX:Math.min(params.x1,params.x2),minY:Math.min(params.y1,params.y2),maxX:Math.max(params.x1,params.x2),maxY:Math.max(params.y1,params.y2)}},this.lineIntersection=function(x1,y1,x2,y2){return[]},this.boxIntersection=function(x,y,w,h){var a=[];return a.push.apply(a,this.lineIntersection(x,y,x+w,y)),a.push.apply(a,this.lineIntersection(x+w,y,x+w,y+h)),a.push.apply(a,this.lineIntersection(x+w,y+h,x,y+h)),a.push.apply(a,this.lineIntersection(x,y+h,x,y)),a},this.boundingBoxIntersection=function(box){return this.boxIntersection(box.x,box.y,box.w,box.y)}},Straight:function(params){var length,m,m2,x1,x2,y1,y2;_jp.Segments.AbstractSegment.apply(this,arguments);this.type="Straight",this.getLength=function(){return length},this.getGradient=function(){return m},this.getCoordinates=function(){return{x1:x1,y1:y1,x2:x2,y2:y2}},this.setCoordinates=function(coords){x1=coords.x1,y1=coords.y1,x2=coords.x2,y2=coords.y2,length=Math.sqrt(Math.pow(x2-x1,2)+Math.pow(y2-y1,2)),m=_jg.gradient({x:x1,y:y1},{x:x2,y:y2}),m2=-1/m},this.setCoordinates({x1:params.x1,y1:params.y1,x2:params.x2,y2:params.y2}),this.getBounds=function(){return{minX:Math.min(x1,x2),minY:Math.min(y1,y2),maxX:Math.max(x1,x2),maxY:Math.max(y1,y2)}},this.pointOnPath=function(location,absolute){if(0!==location||absolute){if(1!==location||absolute){var l=absolute?0<location?location:length+location:location*length;return _jg.pointOnLine({x:x1,y:y1},{x:x2,y:y2},l)}return{x:x2,y:y2}}return{x:x1,y:y1}},this.gradientAtPoint=function(_){return m},this.pointAlongPathFrom=function(location,distance,absolute){var p=this.pointOnPath(location,absolute),farAwayPoint=distance<=0?{x:x1,y:y1}:{x:x2,y:y2};return distance<=0&&1<Math.abs(distance)&&(distance*=-1),_jg.pointOnLine(p,farAwayPoint,distance)};var within=function(a,b,c){return c>=Math.min(a,b)&&c<=Math.max(a,b)},closest=function(a,b,c){return Math.abs(c-a)<Math.abs(c-b)?a:b};this.findClosestPointOnPath=function(x,y){var out={d:1/0,x:null,y:null,l:null,x1:x1,x2:x2,y1:y1,y2:y2};if(0===m)out.y=y1,out.x=within(x1,x2,x)?x:closest(x1,x2,x);else if(m===1/0||m===-1/0)out.x=x1,out.y=within(y1,y2,y)?y:closest(y1,y2,y);else{var b=y1-m*x1,_x1=(y-m2*x-b)/(m-m2),_y1=m*_x1+b;out.x=within(x1,x2,_x1)?_x1:closest(x1,x2,_x1),out.y=within(y1,y2,_y1)?_y1:closest(y1,y2,_y1)}var fractionInSegment=_jg.lineLength([out.x,out.y],[x1,y1]);return out.d=_jg.lineLength([x,y],[out.x,out.y]),out.l=fractionInSegment/length,out};var _plb=function(q,p1,p2){return p1<p2?p1<=q&&q<=p2:q<=p1&&p2<=q};this.lineIntersection=function(_x1,_y1,_x2,_y2){var m2=Math.abs(_jg.gradient({x:_x1,y:_y1},{x:_x2,y:_y2})),m1=Math.abs(m),b=m1===1/0?x1:y1-m1*x1,out=[],b2=m2===1/0?_x1:_y1-m2*_x1;if(m2!==m1)if(m2===1/0&&0===m1)_plb(_x1,x1,x2)&&_plb(y1,_y1,_y2)&&(out=[_x1,y1]);else if(0===m2&&m1===1/0)_plb(_y1,y1,y2)&&_plb(x1,_x1,_x2)&&(out=[x1,_y1]);else{var X,Y;m2===1/0?_plb(X=_x1,x1,x2)&&_plb(Y=m1*_x1+b,_y1,_y2)&&(out=[X,Y]):0===m2?_plb(Y=_y1,y1,y2)&&_plb(X=(_y1-b)/m1,_x1,_x2)&&(out=[X,Y]):(Y=m1*(X=(b2-b)/(m1-m2))+b,_plb(X,x1,x2)&&_plb(Y,y1,y2)&&(out=[X,Y]))}return out},this.boxIntersection=function(x,y,w,h){var a=[];return a.push.apply(a,this.lineIntersection(x,y,x+w,y)),a.push.apply(a,this.lineIntersection(x+w,y,x+w,y+h)),a.push.apply(a,this.lineIntersection(x+w,y+h,x,y+h)),a.push.apply(a,this.lineIntersection(x,y+h,x,y)),a},this.boundingBoxIntersection=function(box){return this.boxIntersection(box.x,box.y,box.w,box.h)}},Arc:function(params){_jp.Segments.AbstractSegment.apply(this,arguments);var _calcAngle=function(_x,_y){return _jg.theta([params.cx,params.cy],[_x,_y])},TWO_PI=2*Math.PI;this.radius=params.r,this.anticlockwise=params.ac,this.type="Arc",params.startAngle&&params.endAngle?(this.startAngle=params.startAngle,this.endAngle=params.endAngle,this.x1=params.cx+this.radius*Math.cos(params.startAngle),this.y1=params.cy+this.radius*Math.sin(params.startAngle),this.x2=params.cx+this.radius*Math.cos(params.endAngle),this.y2=params.cy+this.radius*Math.sin(params.endAngle)):(this.startAngle=_calcAngle(params.x1,params.y1),this.endAngle=_calcAngle(params.x2,params.y2),this.x1=params.x1,this.y1=params.y1,this.x2=params.x2,this.y2=params.y2),this.endAngle<0&&(this.endAngle+=TWO_PI),this.startAngle<0&&(this.startAngle+=TWO_PI);var ea=this.endAngle<this.startAngle?this.endAngle+TWO_PI:this.endAngle;this.sweep=Math.abs(ea-this.startAngle),this.anticlockwise&&(this.sweep=TWO_PI-this.sweep);var circumference=2*Math.PI*this.radius,frac=this.sweep/TWO_PI,length=circumference*frac;this.getLength=function(){return length},this.getBounds=function(){return{minX:params.cx-params.r,maxX:params.cx+params.r,minY:params.cy-params.r,maxY:params.cy+params.r}};var gentleRound=function(n){var f=Math.floor(n),r=Math.ceil(n);return n-f<1e-10?f:r-n<1e-10?r:n};this.pointOnPath=function(location,absolute){if(0===location)return{x:this.x1,y:this.y1,theta:this.startAngle};if(1===location)return{x:this.x2,y:this.y2,theta:this.endAngle};absolute&&(location/=length);var angle=function(segment,location){if(segment.anticlockwise){var sa=segment.startAngle<segment.endAngle?segment.startAngle+TWO_PI:segment.startAngle;return sa-Math.abs(sa-segment.endAngle)*location}var ea=segment.endAngle<segment.startAngle?segment.endAngle+TWO_PI:segment.endAngle,ss=Math.abs(ea-segment.startAngle);return segment.startAngle+ss*location}(this,location),_x=params.cx+params.r*Math.cos(angle),_y=params.cy+params.r*Math.sin(angle);return{x:gentleRound(_x),y:gentleRound(_y),theta:angle}},this.gradientAtPoint=function(location,absolute){var p=this.pointOnPath(location,absolute),m=_jg.normal([params.cx,params.cy],[p.x,p.y]);return this.anticlockwise||m!==1/0&&m!==-1/0||(m*=-1),m},this.pointAlongPathFrom=function(location,distance,absolute){var p=this.pointOnPath(location,absolute),arcSpan=distance/circumference*2*Math.PI,dir=this.anticlockwise?-1:1,startAngle=p.theta+dir*arcSpan;return{x:params.cx+this.radius*Math.cos(startAngle),y:params.cy+this.radius*Math.sin(startAngle)}}},Bezier:function(params){this.curve=[{x:params.x1,y:params.y1},{x:params.cp1x,y:params.cp1y},{x:params.cp2x,y:params.cp2y},{x:params.x2,y:params.y2}];_jp.Segments.AbstractSegment.apply(this,arguments);this.bounds={minX:Math.min(params.x1,params.x2,params.cp1x,params.cp2x),minY:Math.min(params.y1,params.y2,params.cp1y,params.cp2y),maxX:Math.max(params.x1,params.x2,params.cp1x,params.cp2x),maxY:Math.max(params.y1,params.y2,params.cp1y,params.cp2y)},this.type="Bezier";var _translateLocation=function(_curve,location,absolute){return absolute&&(location=root.jsBezier.locationAlongCurveFrom(_curve,0<location?0:1,location)),location};this.pointOnPath=function(location,absolute){return location=_translateLocation(this.curve,location,absolute),root.jsBezier.pointOnCurve(this.curve,location)},this.gradientAtPoint=function(location,absolute){return location=_translateLocation(this.curve,location,absolute),root.jsBezier.gradientAtPoint(this.curve,location)},this.pointAlongPathFrom=function(location,distance,absolute){return location=_translateLocation(this.curve,location,absolute),root.jsBezier.pointAlongCurveFrom(this.curve,location,distance)},this.getLength=function(){return root.jsBezier.getLength(this.curve)},this.getBounds=function(){return this.bounds},this.findClosestPointOnPath=function(x,y){var p=root.jsBezier.nearestPointOnCurve({x:x,y:y},this.curve);return{d:Math.sqrt(Math.pow(p.point.x-x,2)+Math.pow(p.point.y-y,2)),x:p.point.x,y:p.point.y,l:p.location,s:this}},this.lineIntersection=function(x1,y1,x2,y2){return root.jsBezier.lineIntersection(x1,y1,x2,y2,this.curve)}}},_jp.SegmentRenderer={getPath:function(segment,isFirstSegment){return{Straight:function(isFirstSegment){var d=segment.getCoordinates();return(isFirstSegment?"M "+d.x1+" "+d.y1+" ":"")+"L "+d.x2+" "+d.y2},Bezier:function(isFirstSegment){var d=segment.params;return(isFirstSegment?"M "+d.x2+" "+d.y2+" ":"")+"C "+d.cp2x+" "+d.cp2y+" "+d.cp1x+" "+d.cp1y+" "+d.x1+" "+d.y1},Arc:function(isFirstSegment){var d=segment.params,laf=segment.sweep>Math.PI?1:0,sf=segment.anticlockwise?0:1;return(isFirstSegment?"M"+segment.x1+" "+segment.y1+" ":"")+"A "+segment.radius+" "+d.r+" 0 "+laf+","+sf+" "+segment.x2+" "+segment.y2}}[segment.type](isFirstSegment)}};var AbstractComponent=function(){this.resetBounds=function(){this.bounds={minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}},this.resetBounds()};_jp.Connectors.AbstractConnector=function(params){AbstractComponent.apply(this,arguments);var segments=[],totalLength=0,segmentProportions=[],segmentProportionalLengths=[],stub=params.stub||0,sourceStub=_ju.isArray(stub)?stub[0]:stub,targetStub=_ju.isArray(stub)?stub[1]:stub,gap=params.gap||0,sourceGap=_ju.isArray(gap)?gap[0]:gap,targetGap=_ju.isArray(gap)?gap[1]:gap,userProvidedSegments=null,paintInfo=null;this.getPathData=function(){for(var p="",i=0;i<segments.length;i++)p+=_jp.SegmentRenderer.getPath(segments[i],0===i),p+=" ";return p},this.findSegmentForPoint=function(x,y){for(var out={d:1/0,s:null,x:null,y:null,l:null},i=0;i<segments.length;i++){var _s=segments[i].findClosestPointOnPath(x,y);_s.d<out.d&&(out.d=_s.d,out.l=_s.l,out.x=_s.x,out.y=_s.y,out.s=segments[i],out.x1=_s.x1,out.x2=_s.x2,out.y1=_s.y1,out.y2=_s.y2,out.index=i)}return out},this.lineIntersection=function(x1,y1,x2,y2){for(var out=[],i=0;i<segments.length;i++)out.push.apply(out,segments[i].lineIntersection(x1,y1,x2,y2));return out},this.boxIntersection=function(x,y,w,h){for(var out=[],i=0;i<segments.length;i++)out.push.apply(out,segments[i].boxIntersection(x,y,w,h));return out},this.boundingBoxIntersection=function(box){for(var out=[],i=0;i<segments.length;i++)out.push.apply(out,segments[i].boundingBoxIntersection(box));return out};var _findSegmentForLocation=function(location,absolute){absolute&&(location=0<location?location/totalLength:(totalLength+location)/totalLength);for(var idx=segmentProportions.length-1,inSegmentProportion=1,i=0;i<segmentProportions.length;i++)if(segmentProportions[i][1]>=location){idx=i,inSegmentProportion=1===location?1:0===location?0:(location-segmentProportions[i][0])/segmentProportionalLengths[i];break}return{segment:segments[idx],proportion:inSegmentProportion,index:idx}};this.setSegments=function(_segs){userProvidedSegments=[];for(var i=totalLength=0;i<_segs.length;i++)userProvidedSegments.push(_segs[i]),totalLength+=_segs[i].getLength()},this.getLength=function(){return totalLength};var _prepareCompute=function(params){this.strokeWidth=params.strokeWidth;var segment=_jg.quadrant(params.sourcePos,params.targetPos),swapX=params.targetPos[0]<params.sourcePos[0],swapY=params.targetPos[1]<params.sourcePos[1],lw=params.strokeWidth||1,so=params.sourceEndpoint.anchor.getOrientation(params.sourceEndpoint),to=params.targetEndpoint.anchor.getOrientation(params.targetEndpoint),x=swapX?params.targetPos[0]:params.sourcePos[0],y=swapY?params.targetPos[1]:params.sourcePos[1],w=Math.abs(params.targetPos[0]-params.sourcePos[0]),h=Math.abs(params.targetPos[1]-params.sourcePos[1]);if(0===so[0]&&0===so[1]||0===to[0]&&0===to[1]){var index=h<w?0:1,oIndex=[1,0][index];to=[],(so=[])[index]=params.sourcePos[index]>params.targetPos[index]?-1:1,to[index]=params.sourcePos[index]>params.targetPos[index]?1:-1,so[oIndex]=0,to[oIndex]=0}var sx=swapX?w+sourceGap*so[0]:sourceGap*so[0],sy=swapY?h+sourceGap*so[1]:sourceGap*so[1],tx=swapX?targetGap*to[0]:w+targetGap*to[0],ty=swapY?targetGap*to[1]:h+targetGap*to[1],oProduct=so[0]*to[0]+so[1]*to[1],result={sx:sx,sy:sy,tx:tx,ty:ty,lw:lw,xSpan:Math.abs(tx-sx),ySpan:Math.abs(ty-sy),mx:(sx+tx)/2,my:(sy+ty)/2,so:so,to:to,x:x,y:y,w:w,h:h,segment:segment,startStubX:sx+so[0]*sourceStub,startStubY:sy+so[1]*sourceStub,endStubX:tx+to[0]*targetStub,endStubY:ty+to[1]*targetStub,isXGreaterThanStubTimes2:Math.abs(sx-tx)>sourceStub+targetStub,isYGreaterThanStubTimes2:Math.abs(sy-ty)>sourceStub+targetStub,opposite:-1===oProduct,perpendicular:0===oProduct,orthogonal:1===oProduct,sourceAxis:0===so[0]?"y":"x",points:[x,y,w,h,sx,sy,tx,ty],stubs:[sourceStub,targetStub]};return result.anchorOrientation=result.opposite?"opposite":result.orthogonal?"orthogonal":"perpendicular",result};this.getSegments=function(){return segments},this.updateBounds=function(segment){var segBounds=segment.getBounds();this.bounds.minX=Math.min(this.bounds.minX,segBounds.minX),this.bounds.maxX=Math.max(this.bounds.maxX,segBounds.maxX),this.bounds.minY=Math.min(this.bounds.minY,segBounds.minY),this.bounds.maxY=Math.max(this.bounds.maxY,segBounds.maxY)};return this.pointOnPath=function(location,absolute){var seg=_findSegmentForLocation(location,absolute);return seg.segment&&seg.segment.pointOnPath(seg.proportion,!1)||[0,0]},this.gradientAtPoint=function(location,absolute){var seg=_findSegmentForLocation(location,absolute);return seg.segment&&seg.segment.gradientAtPoint(seg.proportion,!1)||0},this.pointAlongPathFrom=function(location,distance,absolute){var seg=_findSegmentForLocation(location,absolute);return seg.segment&&seg.segment.pointAlongPathFrom(seg.proportion,distance,!1)||[0,0]},this.compute=function(params){paintInfo=_prepareCompute.call(this,params),totalLength=segments.length=segmentProportions.length=segmentProportionalLengths.length=0,this._compute(paintInfo,params),this.x=paintInfo.points[0],this.y=paintInfo.points[1],this.w=paintInfo.points[2],this.h=paintInfo.points[3],this.segment=paintInfo.segment,function(){for(var curLoc=0,i=0;i<segments.length;i++){var sl=segments[i].getLength();segmentProportionalLengths[i]=sl/totalLength,segmentProportions[i]=[curLoc,curLoc+=sl/totalLength]}}()},{addSegment:function(conn,type,params){if(params.x1!==params.x2||params.y1!==params.y2){var s=new _jp.Segments[type](params);segments.push(s),totalLength+=s.getLength(),conn.updateBounds(s)}},prepareCompute:_prepareCompute,sourceStub:sourceStub,targetStub:targetStub,maxStub:Math.max(sourceStub,targetStub),sourceGap:sourceGap,targetGap:targetGap,maxGap:Math.max(sourceGap,targetGap)}},_ju.extend(_jp.Connectors.AbstractConnector,AbstractComponent),_jp.Endpoints.AbstractEndpoint=function(params){return AbstractComponent.apply(this,arguments),{compute:this.compute=function(anchorPoint,orientation,endpointStyle,connectorPaintStyle){var out=this._compute.apply(this,arguments);return this.x=out[0],this.y=out[1],this.w=out[2],this.h=out[3],this.bounds.minX=this.x,this.bounds.minY=this.y,this.bounds.maxX=this.x+this.w,this.bounds.maxY=this.y+this.h,out},cssClass:params.cssClass}},_ju.extend(_jp.Endpoints.AbstractEndpoint,AbstractComponent),_jp.Endpoints.Dot=function(params){this.type="Dot";_jp.Endpoints.AbstractEndpoint.apply(this,arguments);params=params||{},this.radius=params.radius||10,this.defaultOffset=.5*this.radius,this.defaultInnerRadius=this.radius/3,this._compute=function(anchorPoint,orientation,endpointStyle,connectorPaintStyle){this.radius=endpointStyle.radius||this.radius;var x=anchorPoint[0]-this.radius,y=anchorPoint[1]-this.radius,w=2*this.radius,h=2*this.radius;if(endpointStyle.stroke){var lw=endpointStyle.strokeWidth||1;x-=lw,y-=lw,w+=2*lw,h+=2*lw}return[x,y,w,h,this.radius]}},_ju.extend(_jp.Endpoints.Dot,_jp.Endpoints.AbstractEndpoint),_jp.Endpoints.Rectangle=function(params){this.type="Rectangle";_jp.Endpoints.AbstractEndpoint.apply(this,arguments);params=params||{},this.width=params.width||20,this.height=params.height||20,this._compute=function(anchorPoint,orientation,endpointStyle,connectorPaintStyle){var width=endpointStyle.width||this.width,height=endpointStyle.height||this.height;return[anchorPoint[0]-width/2,anchorPoint[1]-height/2,width,height]}},_ju.extend(_jp.Endpoints.Rectangle,_jp.Endpoints.AbstractEndpoint);var DOMElementEndpoint=function(params){_jp.jsPlumbUIComponent.apply(this,arguments),this._jsPlumb.displayElements=[]};_ju.extend(DOMElementEndpoint,_jp.jsPlumbUIComponent,{getDisplayElements:function(){return this._jsPlumb.displayElements},appendDisplayElement:function(el){this._jsPlumb.displayElements.push(el)}}),_jp.Endpoints.Image=function(params){this.type="Image",DOMElementEndpoint.apply(this,arguments),_jp.Endpoints.AbstractEndpoint.apply(this,arguments);var _onload=params.onload,src=params.src||params.url,clazz=params.cssClass?" "+params.cssClass:"";this._jsPlumb.img=new Image,this._jsPlumb.ready=!1,this._jsPlumb.initialized=!1,this._jsPlumb.deleted=!1,this._jsPlumb.widthToUse=params.width,this._jsPlumb.heightToUse=params.height,this._jsPlumb.endpoint=params.endpoint,this._jsPlumb.img.onload=function(){null!=this._jsPlumb&&(this._jsPlumb.ready=!0,this._jsPlumb.widthToUse=this._jsPlumb.widthToUse||this._jsPlumb.img.width,this._jsPlumb.heightToUse=this._jsPlumb.heightToUse||this._jsPlumb.img.height,_onload&&_onload(this))}.bind(this),this._jsPlumb.endpoint.setImage=function(_img,onload){var s=_img.constructor===String?_img:_img.src;_onload=onload,this._jsPlumb.img.src=s,null!=this.canvas&&this.canvas.setAttribute("src",this._jsPlumb.img.src)}.bind(this),this._jsPlumb.endpoint.setImage(src,_onload),this._compute=function(anchorPoint,orientation,endpointStyle,connectorPaintStyle){return this.anchorPoint=anchorPoint,this._jsPlumb.ready?[anchorPoint[0]-this._jsPlumb.widthToUse/2,anchorPoint[1]-this._jsPlumb.heightToUse/2,this._jsPlumb.widthToUse,this._jsPlumb.heightToUse]:[0,0,0,0]},this.canvas=_jp.createElement("img",{position:"absolute",margin:0,padding:0,outline:0},this._jsPlumb.instance.endpointClass+clazz),this._jsPlumb.widthToUse&&this.canvas.setAttribute("width",this._jsPlumb.widthToUse),this._jsPlumb.heightToUse&&this.canvas.setAttribute("height",this._jsPlumb.heightToUse),this._jsPlumb.instance.appendElement(this.canvas),this.actuallyPaint=function(d,style,anchor){if(!this._jsPlumb.deleted){this._jsPlumb.initialized||(this.canvas.setAttribute("src",this._jsPlumb.img.src),this.appendDisplayElement(this.canvas),this._jsPlumb.initialized=!0);var x=this.anchorPoint[0]-this._jsPlumb.widthToUse/2,y=this.anchorPoint[1]-this._jsPlumb.heightToUse/2;_ju.sizeElement(this.canvas,x,y,this._jsPlumb.widthToUse,this._jsPlumb.heightToUse)}},this.paint=function(style,anchor){null!=this._jsPlumb&&(this._jsPlumb.ready?this.actuallyPaint(style,anchor):root.setTimeout(function(){this.paint(style,anchor)}.bind(this),200))}},_ju.extend(_jp.Endpoints.Image,[DOMElementEndpoint,_jp.Endpoints.AbstractEndpoint],{cleanup:function(force){force&&(this._jsPlumb.deleted=!0,this.canvas&&this.canvas.parentNode.removeChild(this.canvas),this.canvas=null)}}),_jp.Endpoints.Blank=function(params){_jp.Endpoints.AbstractEndpoint.apply(this,arguments);this.type="Blank",DOMElementEndpoint.apply(this,arguments),this._compute=function(anchorPoint,orientation,endpointStyle,connectorPaintStyle){return[anchorPoint[0],anchorPoint[1],10,0]};var clazz=params.cssClass?" "+params.cssClass:"";this.canvas=_jp.createElement("div",{display:"block",width:"1px",height:"1px",background:"transparent",position:"absolute"},this._jsPlumb.instance.endpointClass+clazz),this._jsPlumb.instance.appendElement(this.canvas),this.paint=function(style,anchor){_ju.sizeElement(this.canvas,this.x,this.y,this.w,this.h)}},_ju.extend(_jp.Endpoints.Blank,[_jp.Endpoints.AbstractEndpoint,DOMElementEndpoint],{cleanup:function(){this.canvas&&this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas)}}),_jp.Endpoints.Triangle=function(params){this.type="Triangle",_jp.Endpoints.AbstractEndpoint.apply(this,arguments);var self=this;(params=params||{}).width=params.width||55,params.height=params.height||55,this.width=params.width,this.height=params.height,this._compute=function(anchorPoint,orientation,endpointStyle,connectorPaintStyle){var width=endpointStyle.width||self.width,height=endpointStyle.height||self.height;return[anchorPoint[0]-width/2,anchorPoint[1]-height/2,width,height]}};var AbstractOverlay=_jp.Overlays.AbstractOverlay=function(params){this.visible=!0,this.isAppendedAtTopLevel=!0,this.component=params.component,this.loc=null==params.location?.5:params.location,this.endpointLoc=null==params.endpointLocation?[.5,.5]:params.endpointLocation,this.visible=!1!==params.visible};AbstractOverlay.prototype={cleanup:function(force){force&&(this.component=null,this.canvas=null,this.endpointLoc=null)},reattach:function(instance,component){},setVisible:function(val){this.visible=val,this.component.repaint()},isVisible:function(){return this.visible},hide:function(){this.setVisible(!1)},show:function(){this.setVisible(!0)},incrementLocation:function(amount){this.loc+=amount,this.component.repaint()},setLocation:function(l){this.loc=l,this.component.repaint()},getLocation:function(){return this.loc},updateFrom:function(){}},_jp.Overlays.Arrow=function(params){this.type="Arrow",AbstractOverlay.apply(this,arguments),this.isAppendedAtTopLevel=!1,params=params||{};var self=this;this.length=params.length||20,this.width=params.width||20,this.id=params.id;var direction=(params.direction||1)<0?-1:1,paintStyle=params.paintStyle||{"stroke-width":1},foldback=params.foldback||.623;this.computeMaxSize=function(){return 1.5*self.width},this.elementCreated=function(p,component){if(this.path=p,params.events)for(var i in params.events)_jp.on(p,i,params.events[i])},this.draw=function(component,currentConnectionPaintStyle){var hxy,mid,txy,tail;if(component.pointAlongPathFrom){if(_ju.isString(this.loc)||1<this.loc||this.loc<0){var l=parseInt(this.loc,10),fromLoc=this.loc<0?1:0;hxy=component.pointAlongPathFrom(fromLoc,l,!1),mid=component.pointAlongPathFrom(fromLoc,l-direction*this.length/2,!1),txy=_jg.pointOnLine(hxy,mid,this.length)}else if(1===this.loc){if(hxy=component.pointOnPath(this.loc),mid=component.pointAlongPathFrom(this.loc,-this.length),txy=_jg.pointOnLine(hxy,mid,this.length),-1===direction){var _=txy;txy=hxy,hxy=_}}else if(0===this.loc){if(txy=component.pointOnPath(this.loc),mid=component.pointAlongPathFrom(this.loc,this.length),hxy=_jg.pointOnLine(txy,mid,this.length),-1===direction){var __=txy;txy=hxy,hxy=__}}else hxy=component.pointAlongPathFrom(this.loc,direction*this.length/2),mid=component.pointOnPath(this.loc),txy=_jg.pointOnLine(hxy,mid,this.length);var d={hxy:hxy,tail:tail=_jg.perpendicularLineTo(hxy,txy,this.width),cxy:_jg.pointOnLine(hxy,txy,foldback*this.length)},stroke=paintStyle.stroke||currentConnectionPaintStyle.stroke,fill=paintStyle.fill||currentConnectionPaintStyle.stroke;return{component:component,d:d,"stroke-width":paintStyle.strokeWidth||currentConnectionPaintStyle.strokeWidth,stroke:stroke,fill:fill,minX:Math.min(hxy.x,tail[0].x,tail[1].x),maxX:Math.max(hxy.x,tail[0].x,tail[1].x),minY:Math.min(hxy.y,tail[0].y,tail[1].y),maxY:Math.max(hxy.y,tail[0].y,tail[1].y)}}return{component:component,minX:0,maxX:0,minY:0,maxY:0}}},_ju.extend(_jp.Overlays.Arrow,AbstractOverlay,{updateFrom:function(d){this.length=d.length||this.length,this.width=d.width||this.width,this.direction=null!=d.direction?d.direction:this.direction,this.foldback=d.foldback||this.foldback},cleanup:function(){this.path&&this.canvas&&this.canvas.removeChild(this.path)}}),_jp.Overlays.PlainArrow=function(params){params=params||{};var p=_jp.extend(params,{foldback:1});_jp.Overlays.Arrow.call(this,p),this.type="PlainArrow"},_ju.extend(_jp.Overlays.PlainArrow,_jp.Overlays.Arrow),_jp.Overlays.Diamond=function(params){var l=(params=params||{}).length||40,p=_jp.extend(params,{length:l/2,foldback:2});_jp.Overlays.Arrow.call(this,p),this.type="Diamond"},_ju.extend(_jp.Overlays.Diamond,_jp.Overlays.Arrow);var _getDimensions=function(component,forceRefresh){return(null==component._jsPlumb.cachedDimensions||forceRefresh)&&(component._jsPlumb.cachedDimensions=component.getDimensions()),component._jsPlumb.cachedDimensions},AbstractDOMOverlay=function(params){_jp.jsPlumbUIComponent.apply(this,arguments),AbstractOverlay.apply(this,arguments);var _f=this.fire;this.fire=function(){_f.apply(this,arguments),this.component&&this.component.fire.apply(this.component,arguments)},this.detached=!1,this.id=params.id,this._jsPlumb.div=null,this._jsPlumb.initialised=!1,this._jsPlumb.component=params.component,this._jsPlumb.cachedDimensions=null,this._jsPlumb.create=params.create,this._jsPlumb.initiallyInvisible=!1===params.visible,this.getElement=function(){if(null==this._jsPlumb.div){var div=this._jsPlumb.div=_jp.getElement(this._jsPlumb.create(this._jsPlumb.component));div.style.position="absolute",jsPlumb.addClass(div,this._jsPlumb.instance.overlayClass+" "+(this.cssClass?this.cssClass:params.cssClass?params.cssClass:"")),this._jsPlumb.instance.appendElement(div),this._jsPlumb.instance.getId(div);var ts="translate(-50%, -50%)";(this.canvas=div).style.webkitTransform=ts,div.style.mozTransform=ts,div.style.msTransform=ts,div.style.oTransform=ts,div.style.transform=ts,div._jsPlumb=this,!1===params.visible&&(div.style.display="none")}return this._jsPlumb.div},this.draw=function(component,currentConnectionPaintStyle,absolutePosition){var td=_getDimensions(this);if(null==td||2!==td.length)return{minX:0,maxX:0,minY:0,maxY:0};var cxy={x:0,y:0};if(absolutePosition)cxy={x:absolutePosition[0],y:absolutePosition[1]};else if(component.pointOnPath){var loc=this.loc,absolute=!1;(_ju.isString(this.loc)||this.loc<0||1<this.loc)&&(loc=parseInt(this.loc,10),absolute=!0),cxy=component.pointOnPath(loc,absolute)}else{var locToUse=this.loc.constructor===Array?this.loc:this.endpointLoc;cxy={x:locToUse[0]*component.w,y:locToUse[1]*component.h}}var minx=cxy.x-td[0]/2,miny=cxy.y-td[1]/2;return{component:component,d:{minx:minx,miny:miny,td:td,cxy:cxy},minX:minx,maxX:minx+td[0],minY:miny,maxY:miny+td[1]}}};_ju.extend(AbstractDOMOverlay,[_jp.jsPlumbUIComponent,AbstractOverlay],{getDimensions:function(){return[1,1]},setVisible:function(state){this._jsPlumb.div&&(this._jsPlumb.div.style.display=state?"block":"none",state&&this._jsPlumb.initiallyInvisible&&(_getDimensions(this,!0),this.component.repaint(),this._jsPlumb.initiallyInvisible=!1))},clearCachedDimensions:function(){this._jsPlumb.cachedDimensions=null},cleanup:function(force){force?null!=this._jsPlumb.div&&(this._jsPlumb.div._jsPlumb=null,this._jsPlumb.instance.removeElement(this._jsPlumb.div)):(this._jsPlumb&&this._jsPlumb.div&&this._jsPlumb.div.parentNode&&this._jsPlumb.div.parentNode.removeChild(this._jsPlumb.div),this.detached=!0)},reattach:function(instance,component){null!=this._jsPlumb.div&&instance.getContainer().appendChild(this._jsPlumb.div),this.detached=!1},computeMaxSize:function(){var td=_getDimensions(this);return Math.max(td[0],td[1])},paint:function(p,containerExtents){this._jsPlumb.initialised||(this.getElement(),p.component.appendDisplayElement(this._jsPlumb.div),this._jsPlumb.initialised=!0,this.detached&&this._jsPlumb.div.parentNode.removeChild(this._jsPlumb.div)),this._jsPlumb.div.style.left=p.component.x+p.d.minx+"px",this._jsPlumb.div.style.top=p.component.y+p.d.miny+"px"}}),_jp.Overlays.Custom=function(params){this.type="Custom",AbstractDOMOverlay.apply(this,arguments)},_ju.extend(_jp.Overlays.Custom,AbstractDOMOverlay),_jp.Overlays.GuideLines=function(){var self=this;self.length=50,self.strokeWidth=5,this.type="GuideLines",AbstractOverlay.apply(this,arguments),_jp.jsPlumbUIComponent.apply(this,arguments),this.draw=function(connector,currentConnectionPaintStyle){var head=connector.pointAlongPathFrom(self.loc,self.length/2),mid=connector.pointOnPath(self.loc),tail=_jg.pointOnLine(head,mid,self.length),tailLine=_jg.perpendicularLineTo(head,tail,40),headLine=_jg.perpendicularLineTo(tail,head,20);return{connector:connector,head:head,tail:tail,headLine:headLine,tailLine:tailLine,minX:Math.min(head.x,tail.x,headLine[0].x,headLine[1].x),minY:Math.min(head.y,tail.y,headLine[0].y,headLine[1].y),maxX:Math.max(head.x,tail.x,headLine[0].x,headLine[1].x),maxY:Math.max(head.y,tail.y,headLine[0].y,headLine[1].y)}}},_jp.Overlays.Label=function(params){this.labelStyle=params.labelStyle;this.cssClass=null!=this.labelStyle?this.labelStyle.cssClass:null;var p=_jp.extend({create:function(){return _jp.createElement("div")}},params);if(_jp.Overlays.Custom.call(this,p),this.type="Label",this.label=params.label||"",this.labelText=null,this.labelStyle){var el=this.getElement();if(this.labelStyle.font=this.labelStyle.font||"12px sans-serif",el.style.font=this.labelStyle.font,el.style.color=this.labelStyle.color||"black",this.labelStyle.fill&&(el.style.background=this.labelStyle.fill),0<this.labelStyle.borderWidth){var dStyle=this.labelStyle.borderStyle?this.labelStyle.borderStyle:"black";el.style.border=this.labelStyle.borderWidth+"px solid "+dStyle}this.labelStyle.padding&&(el.style.padding=this.labelStyle.padding)}},_ju.extend(_jp.Overlays.Label,_jp.Overlays.Custom,{cleanup:function(force){force&&(this.div=null,this.label=null,this.labelText=null,this.cssClass=null,this.labelStyle=null)},getLabel:function(){return this.label},setLabel:function(l){this.label=l,this.labelText=null,this.clearCachedDimensions(),this.update(),this.component.repaint()},getDimensions:function(){return this.update(),AbstractDOMOverlay.prototype.getDimensions.apply(this,arguments)},update:function(){if("function"==typeof this.label){var lt=this.label(this);this.getElement().innerHTML=lt.replace(/\r\n/g,"<br/>")}else null==this.labelText&&(this.labelText=this.label,this.getElement().innerHTML=this.labelText.replace(/\r\n/g,"<br/>"))},updateFrom:function(d){null!=d.label&&this.setLabel(d.label)}})}.call("undefined"!=typeof window?window:this),function(){"use strict";var root=this,_jp=root.jsPlumb;_jp.extend(root.jsPlumbInstance.prototype,{getEventManager:function(){return(e=(instance=this)._mottle)||(e=instance._mottle=new root.Mottle),e;var instance,e},on:function(el,event,callback){return this.getEventManager().on.apply(this,arguments),this},off:function(el,event,callback){return this.getEventManager().off.apply(this,arguments),this}})}.call("undefined"!=typeof window?window:this),function(){"use strict";var root=this,_ju=root.jsPlumbUtil,_jpi=root.jsPlumbInstance,GROUP="_jsPlumbGroup",GroupManager=function(_jsPlumb){var _managedGroups={},_connectionSourceMap={},_connectionTargetMap={},self=this;function _setVisible(group,state){for(var m=group.getMembers(),i=0;i<m.length;i++)_jsPlumb[state?"show":"hide"](m[i],!0)}_jsPlumb.bind("connection",function(p){null!=p.source[GROUP]&&null!=p.target[GROUP]&&p.source[GROUP]===p.target[GROUP]?(_connectionSourceMap[p.connection.id]=p.source[GROUP],_connectionTargetMap[p.connection.id]=p.source[GROUP]):(null!=p.source[GROUP]&&(_ju.suggest(p.source[GROUP].connections.source,p.connection),_connectionSourceMap[p.connection.id]=p.source[GROUP]),null!=p.target[GROUP]&&(_ju.suggest(p.target[GROUP].connections.target,p.connection),_connectionTargetMap[p.connection.id]=p.target[GROUP]))}),_jsPlumb.bind("internal.connectionDetached",function(p){!function(conn){delete conn.proxies;var f,group=_connectionSourceMap[conn.id];null!=group&&(f=function(c){return c.id===conn.id},_ju.removeWithFunction(group.connections.source,f),_ju.removeWithFunction(group.connections.target,f),delete _connectionSourceMap[conn.id]),null!=(group=_connectionTargetMap[conn.id])&&(f=function(c){return c.id===conn.id},_ju.removeWithFunction(group.connections.source,f),_ju.removeWithFunction(group.connections.target,f),delete _connectionTargetMap[conn.id])}(p.connection)}),_jsPlumb.bind("connectionMoved",function(p){var group=(0===p.index?_connectionSourceMap:_connectionTargetMap)[p.connection.id];if(group){var list=group.connections[0===p.index?"source":"target"],idx=list.indexOf(p.connection);-1!==idx&&list.splice(idx,1)}}),this.addGroup=function(group){_jsPlumb.addClass(group.getEl(),"jtk-group-expanded"),(_managedGroups[group.id]=group).manager=this,_updateConnectionsForGroup(group),_jsPlumb.fire("group:add",{group:group})},this.addToGroup=function(group,el,doNotFireEvent){if(group=this.getGroup(group)){var groupEl=group.getEl();if(el._isJsPlumbGroup)return;var currentGroup=el._jsPlumbGroup;if(currentGroup!==group){var elpos=_jsPlumb.getOffset(el,!0),cpos=group.collapsed?_jsPlumb.getOffset(groupEl,!0):_jsPlumb.getOffset(group.getDragArea(),!0);null!=currentGroup&&(currentGroup.remove(el,!1,doNotFireEvent,!1,group),self.updateConnectionsForGroup(currentGroup)),group.add(el,doNotFireEvent);var handleDroppedConnections=function(list,index){var oidx=0===index?1:0;list.each(function(c){c.setVisible(!1),c.endpoints[oidx].element._jsPlumbGroup===group?(c.endpoints[oidx].setVisible(!1),self.expandConnection(c,oidx,group)):(c.endpoints[index].setVisible(!1),self.collapseConnection(c,index,group))})};group.collapsed&&(handleDroppedConnections(_jsPlumb.select({source:el}),0),handleDroppedConnections(_jsPlumb.select({target:el}),1));var elId=_jsPlumb.getId(el);_jsPlumb.dragManager.setParent(el,elId,groupEl,_jsPlumb.getId(groupEl),elpos);var newPosition={left:elpos.left-cpos.left,top:elpos.top-cpos.top};if(_jsPlumb.setPosition(el,newPosition),_jsPlumb.dragManager.revalidateParent(el,elId,elpos),self.updateConnectionsForGroup(group),_jsPlumb.revalidate(elId),!doNotFireEvent){var p={group:group,el:el};currentGroup&&(p.sourceGroup=currentGroup),_jsPlumb.fire("group:addMember",p)}}}},this.removeFromGroup=function(group,el,doNotFireEvent){(group=this.getGroup(group))&&group.remove(el,null,doNotFireEvent)},this.getGroup=function(groupId){var group=groupId;if(_ju.isString(groupId)&&null==(group=_managedGroups[groupId]))throw new TypeError("No such group ["+groupId+"]");return group},this.getGroups=function(){var o=[];for(var g in _managedGroups)o.push(_managedGroups[g]);return o},this.removeGroup=function(group,deleteMembers,manipulateDOM,doNotFireEvent){group=this.getGroup(group),this.expandGroup(group,!0);var newPositions=group[deleteMembers?"removeAll":"orphanAll"](manipulateDOM,doNotFireEvent);return _jsPlumb.remove(group.getEl()),delete _managedGroups[group.id],delete _jsPlumb._groups[group.id],_jsPlumb.fire("group:remove",{group:group}),newPositions},this.removeAllGroups=function(deleteMembers,manipulateDOM,doNotFireEvent){for(var g in _managedGroups)this.removeGroup(_managedGroups[g],deleteMembers,manipulateDOM,doNotFireEvent)};var _collapseConnection=this.collapseConnection=function(c,index,group){var proxyEp,groupEl=group.getEl(),groupElId=_jsPlumb.getId(groupEl),originalElementId=c.endpoints[index].elementId,otherEl=c.endpoints[0===index?1:0].element;otherEl[GROUP]&&!otherEl[GROUP].shouldProxy()&&otherEl[GROUP].collapsed||(c.proxies=c.proxies||[],(proxyEp=c.proxies[index]?c.proxies[index].ep:_jsPlumb.addEndpoint(groupEl,{endpoint:group.getEndpoint(c,index),anchor:group.getAnchor(c,index),parameters:{isProxyEndpoint:!0}})).setDeleteOnEmpty(!0),c.proxies[index]={ep:proxyEp,originalEp:c.endpoints[index]},0===index?_jsPlumb.anchorManager.sourceChanged(originalElementId,groupElId,c,groupEl):(_jsPlumb.anchorManager.updateOtherEndpoint(c.endpoints[0].elementId,originalElementId,groupElId,c),c.target=groupEl,c.targetId=groupElId),c.proxies[index].originalEp.detachFromConnection(c,null,!0),proxyEp.connections=[c],c.endpoints[index]=proxyEp,c.setVisible(!0))};this.collapseGroup=function(group){if(null!=(group=this.getGroup(group))&&!group.collapsed){var groupEl=group.getEl();if(_setVisible(group,!1),group.shouldProxy()){var _collapseSet=function(conns,index){for(var i=0;i<conns.length;i++){var c=conns[i];_collapseConnection(c,index,group)}};_collapseSet(group.connections.source,0),_collapseSet(group.connections.target,1)}group.collapsed=!0,_jsPlumb.removeClass(groupEl,"jtk-group-expanded"),_jsPlumb.addClass(groupEl,"jtk-group-collapsed"),_jsPlumb.revalidate(groupEl),_jsPlumb.fire("group:collapse",{group:group})}};var _expandConnection=this.expandConnection=function(c,index,group){if(null!=c.proxies&&null!=c.proxies[index]){var groupElId=_jsPlumb.getId(group.getEl()),originalElement=c.proxies[index].originalEp.element,originalElementId=c.proxies[index].originalEp.elementId;c.endpoints[index]=c.proxies[index].originalEp,0===index?_jsPlumb.anchorManager.sourceChanged(groupElId,originalElementId,c,originalElement):(_jsPlumb.anchorManager.updateOtherEndpoint(c.endpoints[0].elementId,groupElId,originalElementId,c),c.target=originalElement,c.targetId=originalElementId),c.proxies[index].ep.detachFromConnection(c,null),c.proxies[index].originalEp.addConnection(c),delete c.proxies[index]}};function _updateConnectionsForGroup(group){var members=group.getMembers(),c1=_jsPlumb.getConnections({source:members,scope:"*"},!0),c2=_jsPlumb.getConnections({target:members,scope:"*"},!0),processed={};group.connections.source.length=0,group.connections.target.length=0;var oneSet=function(c){for(var i=0;i<c.length;i++)processed[c[i].id]||(processed[c[i].id]=!0,c[i].source._jsPlumbGroup===group?(c[i].target._jsPlumbGroup!==group&&group.connections.source.push(c[i]),_connectionSourceMap[c[i].id]=group):c[i].target._jsPlumbGroup===group&&(group.connections.target.push(c[i]),_connectionTargetMap[c[i].id]=group))};oneSet(c1),oneSet(c2)}this.expandGroup=function(group,doNotFireEvent){if(null!=(group=this.getGroup(group))&&group.collapsed){var groupEl=group.getEl();if(_setVisible(group,!0),group.shouldProxy()){var _expandSet=function(conns,index){for(var i=0;i<conns.length;i++){var c=conns[i];_expandConnection(c,index,group)}};_expandSet(group.connections.source,0),_expandSet(group.connections.target,1)}group.collapsed=!1,_jsPlumb.addClass(groupEl,"jtk-group-expanded"),_jsPlumb.removeClass(groupEl,"jtk-group-collapsed"),_jsPlumb.revalidate(groupEl),this.repaintGroup(group),doNotFireEvent||_jsPlumb.fire("group:expand",{group:group})}},this.repaintGroup=function(group){for(var m=(group=this.getGroup(group)).getMembers(),i=0;i<m.length;i++)_jsPlumb.revalidate(m[i])},this.updateConnectionsForGroup=_updateConnectionsForGroup,this.refreshAllGroups=function(){for(var g in _managedGroups)_updateConnectionsForGroup(_managedGroups[g]),_jsPlumb.dragManager.updateOffsets(_jsPlumb.getId(_managedGroups[g].getEl()))}},Group=function(_jsPlumb,params){var self=this,el=params.el;this.getEl=function(){return el},this.id=params.id||_ju.uuid(),el._isJsPlumbGroup=!0;var getDragArea=this.getDragArea=function(){var da=_jsPlumb.getSelector(el,"[jtk-group-content]");return da&&0<da.length?da[0]:el},ghost=!0===params.ghost,constrain=ghost||!0===params.constrain,revert=!1!==params.revert,orphan=!0===params.orphan,prune=!0===params.prune,dropOverride=!0===params.dropOverride,proxied=!1!==params.proxied,elements=[];if(this.connections={source:[],target:[],internal:[]},this.getAnchor=function(conn,endpointIndex){return params.anchor||"Continuous"},this.getEndpoint=function(conn,endpointIndex){return params.endpoint||["Dot",{radius:10}]},(this.collapsed=!1)!==params.draggable){var opts={stop:function(params){_jsPlumb.fire("groupDragStop",jsPlumb.extend(params,{group:self}))},scope:"_jsPlumbGroupDrag"};params.dragOptions&&root.jsPlumb.extend(opts,params.dragOptions),_jsPlumb.draggable(params.el,opts)}!1!==params.droppable&&_jsPlumb.droppable(params.el,{drop:function(p){var el=p.drag.el;if(!el._isJsPlumbGroup){var currentGroup=el._jsPlumbGroup;if(currentGroup!==self){if(null!=currentGroup&&currentGroup.overrideDrop(el,self))return;_jsPlumb.getGroupManager().addToGroup(self,el,!1)}}}});var _each=function(_el,fn){for(var els=null==_el.nodeType?_el:[_el],i=0;i<els.length;i++)fn(els[i])};function _isInsideParent(_el,pos){var p=function(_el){return _el.offsetParent}(_el),s=_jsPlumb.getSize(p),ss=_jsPlumb.getSize(_el),leftEdge=pos[0],rightEdge=leftEdge+ss[0],topEdge=pos[1],bottomEdge=topEdge+ss[1];return 0<rightEdge&&leftEdge<s[0]&&0<bottomEdge&&topEdge<s[1]}function _orphan(_el){var id=_jsPlumb.getId(_el),pos=_jsPlumb.getOffset(_el);return _el.parentNode.removeChild(_el),_jsPlumb.getContainer().appendChild(_el),_jsPlumb.setPosition(_el,pos),delete _el._jsPlumbGroup,_unbindDragHandlers(_el),_jsPlumb.dragManager.clearParent(_el,id),[id,pos]}function _pruneOrOrphan(p){var orphanedPosition=null;if(!_isInsideParent(p.el,p.pos)){var group=p.el._jsPlumbGroup;prune?_jsPlumb.remove(p.el):orphanedPosition=_orphan(p.el),group.remove(p.el)}return orphanedPosition}function _revalidate(_el){var id=_jsPlumb.getId(_el);_jsPlumb.revalidate(_el),_jsPlumb.dragManager.revalidateParent(_el,id)}function _unbindDragHandlers(_el){_el._katavorioDrag&&((prune||orphan)&&_el._katavorioDrag.off("stop",_pruneOrOrphan),prune||orphan||!revert||(_el._katavorioDrag.off("revert",_revalidate),_el._katavorioDrag.setRevert(null)))}function _bindDragHandlers(_el){_el._katavorioDrag&&((prune||orphan)&&_el._katavorioDrag.on("stop",_pruneOrOrphan),constrain&&_el._katavorioDrag.setConstrain(!0),ghost&&_el._katavorioDrag.setUseGhostProxy(!0),prune||orphan||!revert||(_el._katavorioDrag.on("revert",_revalidate),_el._katavorioDrag.setRevert(function(__el,pos){return!_isInsideParent(__el,pos)})))}this.overrideDrop=function(_el,targetGroup){return dropOverride&&(revert||prune||orphan)},this.add=function(_el,doNotFireEvent){var dragArea=getDragArea();_each(_el,function(__el){if(null!=__el._jsPlumbGroup){if(__el._jsPlumbGroup===self)return;__el._jsPlumbGroup.remove(__el,!0,doNotFireEvent,!1)}__el._jsPlumbGroup=self,elements.push(__el),_jsPlumb.isAlreadyDraggable(__el)&&_bindDragHandlers(__el),__el.parentNode!==dragArea&&dragArea.appendChild(__el)}),_jsPlumb.getGroupManager().updateConnectionsForGroup(self)},this.remove=function(el,manipulateDOM,doNotFireEvent,doNotUpdateConnections,targetGroup){_each(el,function(__el){if(delete __el._jsPlumbGroup,_ju.removeWithFunction(elements,function(e){return e===__el}),manipulateDOM)try{self.getDragArea().removeChild(__el)}catch(e){jsPlumbUtil.log("Could not remove element from Group "+e)}if(_unbindDragHandlers(__el),!doNotFireEvent){var p={group:self,el:__el};targetGroup&&(p.targetGroup=targetGroup),_jsPlumb.fire("group:removeMember",p)}}),doNotUpdateConnections||_jsPlumb.getGroupManager().updateConnectionsForGroup(self)},this.removeAll=function(manipulateDOM,doNotFireEvent){for(var i=0,l=elements.length;i<l;i++){var el=elements[0];self.remove(el,manipulateDOM,doNotFireEvent,!0),_jsPlumb.remove(el,!0)}elements.length=0,_jsPlumb.getGroupManager().updateConnectionsForGroup(self)},this.orphanAll=function(){for(var orphanedPositions={},i=0;i<elements.length;i++){var newPosition=_orphan(elements[i]);orphanedPositions[newPosition[0]]=newPosition[1]}return elements.length=0,orphanedPositions},this.getMembers=function(){return elements},el[GROUP]=this,_jsPlumb.bind("elementDraggable",function(dragParams){dragParams.el._jsPlumbGroup===this&&_bindDragHandlers(dragParams.el)}.bind(this)),this.shouldProxy=function(){return proxied},_jsPlumb.getGroupManager().addGroup(this)};_jpi.prototype.addGroup=function(params){var j=this;if(j._groups=j._groups||{},null!=j._groups[params.id])throw new TypeError("cannot create Group ["+params.id+"]; a Group with that ID exists");if(null!=params.el[GROUP])throw new TypeError("cannot create Group ["+params.id+"]; the given element is already a Group");var group=new Group(j,params);return j._groups[group.id]=group,params.collapsed&&this.collapseGroup(group),group},_jpi.prototype.addToGroup=function(group,el,doNotFireEvent){var _one=function(_el){var id=this.getId(_el);this.manage(id,_el),this.getGroupManager().addToGroup(group,_el,doNotFireEvent)}.bind(this);if(Array.isArray(el))for(var i=0;i<el.length;i++)_one(el[i]);else _one(el)},_jpi.prototype.removeFromGroup=function(group,el,doNotFireEvent){this.getGroupManager().removeFromGroup(group,el,doNotFireEvent)},_jpi.prototype.removeGroup=function(group,deleteMembers,manipulateDOM,doNotFireEvent){return this.getGroupManager().removeGroup(group,deleteMembers,manipulateDOM,doNotFireEvent)},_jpi.prototype.removeAllGroups=function(deleteMembers,manipulateDOM,doNotFireEvent){this.getGroupManager().removeAllGroups(deleteMembers,manipulateDOM,doNotFireEvent)},_jpi.prototype.getGroup=function(groupId){return this.getGroupManager().getGroup(groupId)},_jpi.prototype.getGroups=function(){return this.getGroupManager().getGroups()},_jpi.prototype.expandGroup=function(group){this.getGroupManager().expandGroup(group)},_jpi.prototype.collapseGroup=function(groupId){this.getGroupManager().collapseGroup(groupId)},_jpi.prototype.repaintGroup=function(group){this.getGroupManager().repaintGroup(group)},_jpi.prototype.toggleGroup=function(group){null!=(group=this.getGroupManager().getGroup(group))&&this.getGroupManager()[group.collapsed?"expandGroup":"collapseGroup"](group)},_jpi.prototype.getGroupManager=function(){var mgr=this._groupManager;return null==mgr&&(mgr=this._groupManager=new GroupManager(this)),mgr},_jpi.prototype.removeGroupManager=function(){delete this._groupManager},_jpi.prototype.getGroupFor=function(el){if(el=this.getElement(el))return el[GROUP]}}.call("undefined"!=typeof window?window:this),function(){"use strict";var _jp=this.jsPlumb,_ju=this.jsPlumbUtil;_jp.Connectors.Flowchart=function(params){this.type="Flowchart",(params=params||{}).stub=null==params.stub?30:params.stub;var segments,_super=_jp.Connectors.AbstractConnector.apply(this,arguments),midpoint=null==params.midpoint?.5:params.midpoint,alwaysRespectStubs=!0===params.alwaysRespectStubs,lastx=null,lasty=null,cornerRadius=null!=params.cornerRadius?params.cornerRadius:0,sgn=(params.loopbackRadius,function(n){return n<0?-1:0===n?0:1}),segmentDirections=function(segment){return[sgn(segment[2]-segment[0]),sgn(segment[3]-segment[1])]},addSegment=function(segments,x,y,paintInfo){if(lastx!==x||lasty!==y){var lx=null==lastx?paintInfo.sx:lastx,ly=null==lasty?paintInfo.sy:lasty,o=lx===x?"v":"h";lastx=x,lasty=y,segments.push([lx,ly,x,y,o])}},segLength=function(s){return Math.sqrt(Math.pow(s[0]-s[2],2)+Math.pow(s[1]-s[3],2))},_cloneArray=function(a){var _a=[];return _a.push.apply(_a,a),_a};this._compute=function(paintInfo,params){segments=[],lasty=lastx=null;var commonStubCalculator=function(){return[paintInfo.startStubX,paintInfo.startStubY,paintInfo.endStubX,paintInfo.endStubY]},stubs={perpendicular:commonStubCalculator,orthogonal:commonStubCalculator,opposite:function(axis){var pi=paintInfo,idx="x"===axis?0:1;return!alwaysRespectStubs&&{x:function(){return 1===pi.so[idx]&&(pi.startStubX>pi.endStubX&&pi.tx>pi.startStubX||pi.sx>pi.endStubX&&pi.tx>pi.sx)||-1===pi.so[idx]&&(pi.startStubX<pi.endStubX&&pi.tx<pi.startStubX||pi.sx<pi.endStubX&&pi.tx<pi.sx)},y:function(){return 1===pi.so[idx]&&(pi.startStubY>pi.endStubY&&pi.ty>pi.startStubY||pi.sy>pi.endStubY&&pi.ty>pi.sy)||-1===pi.so[idx]&&(pi.startStubY<pi.endStubY&&pi.ty<pi.startStubY||pi.sy<pi.endStubY&&pi.ty<pi.sy)}}[axis]()?{x:[(paintInfo.sx+paintInfo.tx)/2,paintInfo.startStubY,(paintInfo.sx+paintInfo.tx)/2,paintInfo.endStubY],y:[paintInfo.startStubX,(paintInfo.sy+paintInfo.ty)/2,paintInfo.endStubX,(paintInfo.sy+paintInfo.ty)/2]}[axis]:[paintInfo.startStubX,paintInfo.startStubY,paintInfo.endStubX,paintInfo.endStubY]}}[paintInfo.anchorOrientation](paintInfo.sourceAxis),idx="x"===paintInfo.sourceAxis?0:1,oidx="x"===paintInfo.sourceAxis?1:0,ss=stubs[idx],oss=stubs[oidx],es=stubs[idx+2],oes=stubs[oidx+2];addSegment(segments,stubs[0],stubs[1],paintInfo);var midx=paintInfo.startStubX+(paintInfo.endStubX-paintInfo.startStubX)*midpoint,midy=paintInfo.startStubY+(paintInfo.endStubY-paintInfo.startStubY)*midpoint,orientations={x:[0,1],y:[1,0]},p={perpendicular:function(axis){var pi=paintInfo,stubs={x:[[pi.startStubX,pi.endStubX],null,[pi.endStubX,pi.startStubX]],y:[[pi.startStubY,pi.endStubY],null,[pi.endStubY,pi.startStubY]]},midLines={x:[[midx,pi.startStubY],[midx,pi.endStubY]],y:[[pi.startStubX,midy],[pi.endStubX,midy]]},linesToEnd={x:[[pi.endStubX,pi.startStubY]],y:[[pi.startStubX,pi.endStubY]]},startToEnd={x:[[pi.startStubX,pi.endStubY],[pi.endStubX,pi.endStubY]],y:[[pi.endStubX,pi.startStubY],[pi.endStubX,pi.endStubY]]},startToMidToEnd={x:[[pi.startStubX,midy],[pi.endStubX,midy],[pi.endStubX,pi.endStubY]],y:[[midx,pi.startStubY],[midx,pi.endStubY],[pi.endStubX,pi.endStubY]]},otherStubs={x:[pi.startStubY,pi.endStubY],y:[pi.startStubX,pi.endStubX]},soIdx=orientations[axis][0],toIdx=orientations[axis][1],_so=pi.so[soIdx]+1,_to=pi.to[toIdx]+1,otherFlipped=-1===pi.to[toIdx]&&otherStubs[axis][1]<otherStubs[axis][0]||1===pi.to[toIdx]&&otherStubs[axis][1]>otherStubs[axis][0],stub1=stubs[axis][_so][0],stub2=stubs[axis][_so][1],segmentIndexes={x:[[[1,2,3,4],null,[2,1,4,3]],null,[[4,3,2,1],null,[3,4,1,2]]],y:[[[3,2,1,4],null,[2,3,4,1]],null,[[4,1,2,3],null,[1,4,3,2]]]}[axis][_so][_to];return pi.segment===segmentIndexes[3]||pi.segment===segmentIndexes[2]&&otherFlipped?midLines[axis]:pi.segment===segmentIndexes[2]&&stub2<stub1?linesToEnd[axis]:pi.segment===segmentIndexes[2]&&stub1<=stub2||pi.segment===segmentIndexes[1]&&!otherFlipped?startToMidToEnd[axis]:pi.segment===segmentIndexes[0]||pi.segment===segmentIndexes[1]&&otherFlipped?startToEnd[axis]:void 0},orthogonal:function(axis,startStub,otherStartStub,endStub,otherEndStub){var pi=paintInfo,extent={x:-1===pi.so[0]?Math.min(startStub,endStub):Math.max(startStub,endStub),y:-1===pi.so[1]?Math.min(startStub,endStub):Math.max(startStub,endStub)}[axis];return{x:[[extent,otherStartStub],[extent,otherEndStub],[endStub,otherEndStub]],y:[[otherStartStub,extent],[otherEndStub,extent],[otherEndStub,endStub]]}[axis]},opposite:function(axis,ss,oss,es){var pi=paintInfo,otherAxis={x:"y",y:"x"}[axis],dim={x:"height",y:"width"}[axis],comparator=pi["is"+axis.toUpperCase()+"GreaterThanStubTimes2"];if(params.sourceEndpoint.elementId!==params.targetEndpoint.elementId)return!comparator||1===pi.so[idx]&&es<ss||-1===pi.so[idx]&&ss<es?{x:[[ss,midy],[es,midy]],y:[[midx,ss],[midx,es]]}[axis]:1===pi.so[idx]&&ss<es||-1===pi.so[idx]&&es<ss?{x:[[midx,pi.sy],[midx,pi.ty]],y:[[pi.sx,midy],[pi.tx,midy]]}[axis]:void 0;var _val=oss+(1-params.sourceEndpoint.anchor[otherAxis])*params.sourceInfo[dim]+_super.maxStub;return{x:[[ss,_val],[es,_val]],y:[[_val,ss],[_val,es]]}[axis]}}[paintInfo.anchorOrientation](paintInfo.sourceAxis,ss,oss,es,oes);if(p)for(var i=0;i<p.length;i++)addSegment(segments,p[i][0],p[i][1],paintInfo);addSegment(segments,stubs[2],stubs[3],paintInfo),addSegment(segments,paintInfo.tx,paintInfo.ty,paintInfo),function(conn,segments,paintInfo){for(var next,currentDirection,nextDirection,current=null,i=0;i<segments.length-1;i++){if(current=current||_cloneArray(segments[i]),next=_cloneArray(segments[i+1]),currentDirection=segmentDirections(current),nextDirection=segmentDirections(next),0<cornerRadius&&current[4]!==next[4]){var minSegLength=Math.min(segLength(current),segLength(next)),radiusToUse=Math.min(cornerRadius,minSegLength/2);current[2]-=currentDirection[0]*radiusToUse,current[3]-=currentDirection[1]*radiusToUse,next[0]+=nextDirection[0]*radiusToUse,next[1]+=nextDirection[1]*radiusToUse;var ac=currentDirection[1]===nextDirection[0]&&1===nextDirection[0]||currentDirection[1]===nextDirection[0]&&0===nextDirection[0]&&currentDirection[0]!==nextDirection[1]||currentDirection[1]===nextDirection[0]&&-1===nextDirection[0],sgnEqual=(next[1]>current[3]?1:-1)==(next[0]>current[2]?1:-1),cx=sgnEqual&&ac||!sgnEqual&&!ac?next[0]:current[2],cy=sgnEqual&&ac||!sgnEqual&&!ac?current[3]:next[1];_super.addSegment(conn,"Straight",{x1:current[0],y1:current[1],x2:current[2],y2:current[3]}),_super.addSegment(conn,"Arc",{r:radiusToUse,x1:current[2],y1:current[3],x2:next[0],y2:next[1],cx:cx,cy:cy,ac:ac})}else{var dx=current[2]===current[0]?0:current[2]>current[0]?paintInfo.lw/2:-paintInfo.lw/2,dy=current[3]===current[1]?0:current[3]>current[1]?paintInfo.lw/2:-paintInfo.lw/2;_super.addSegment(conn,"Straight",{x1:current[0]-dx,y1:current[1]-dy,x2:current[2]+dx,y2:current[3]+dy})}current=next}null!=next&&_super.addSegment(conn,"Straight",{x1:next[0],y1:next[1],x2:next[2],y2:next[3]})}(this,segments,paintInfo)}},_ju.extend(_jp.Connectors.Flowchart,_jp.Connectors.AbstractConnector)}.call("undefined"!=typeof window?window:this),function(){"use strict";var _jp=this.jsPlumb,_ju=this.jsPlumbUtil;_jp.Connectors.AbstractBezierConnector=function(params){var _super,showLoopback=!1!==(params=params||{}).showLoopback,margin=(params.curviness,params.margin||5),clockwise=(params.proximityLimit,params.orientation&&"clockwise"===params.orientation),loopbackRadius=params.loopbackRadius||25;return this._compute=function(paintInfo,p){var sp=p.sourcePos,tp=p.targetPos,_w=Math.abs(sp[0]-tp[0]),_h=Math.abs(sp[1]-tp[1]);if(showLoopback&&p.sourceEndpoint.elementId===p.targetEndpoint.elementId){!0;var x1=p.sourcePos[0],y1=p.sourcePos[1]-margin,cx=x1,cy=y1-loopbackRadius,_x=cx-loopbackRadius,_y=cy-loopbackRadius;_h=_w=2*loopbackRadius,paintInfo.points[0]=_x,paintInfo.points[1]=_y,paintInfo.points[2]=_w,paintInfo.points[3]=_h,_super.addSegment(this,"Arc",{loopback:!0,x1:x1-_x+4,y1:y1-_y,startAngle:0,endAngle:2*Math.PI,r:loopbackRadius,ac:!clockwise,x2:x1-_x-4,y2:y1-_y,cx:cx-_x,cy:cy-_y})}else!1,this._computeBezier(paintInfo,p,sp,tp,_w,_h)},_super=_jp.Connectors.AbstractConnector.apply(this,arguments)},_ju.extend(_jp.Connectors.AbstractBezierConnector,_jp.Connectors.AbstractConnector);var Bezier=function(params){params=params||{},this.type="Bezier";var _super=_jp.Connectors.AbstractBezierConnector.apply(this,arguments),majorAnchor=params.curviness||150;this.getCurviness=function(){return majorAnchor},this._findControlPoint=function(point,sourceAnchorPosition,targetAnchorPosition,sourceEndpoint,targetEndpoint,soo,too){var p=[];return soo[0]!==too[0]||soo[1]===too[1]?(0===too[0]?p.push(targetAnchorPosition[0]<sourceAnchorPosition[0]?point[0]+10:point[0]-10):p.push(point[0]+majorAnchor*too[0]),0===too[1]?p.push(targetAnchorPosition[1]<sourceAnchorPosition[1]?point[1]+10:point[1]-10):p.push(point[1]+majorAnchor*soo[1])):(0===soo[0]?p.push(sourceAnchorPosition[0]<targetAnchorPosition[0]?point[0]+10:point[0]-10):p.push(point[0]-majorAnchor*soo[0]),0===soo[1]?p.push(sourceAnchorPosition[1]<targetAnchorPosition[1]?point[1]+10:point[1]-10):p.push(point[1]+majorAnchor*too[1])),p},this._computeBezier=function(paintInfo,p,sp,tp,_w,_h){var _CP,_CP2,_sx=sp[0]<tp[0]?_w:0,_sy=sp[1]<tp[1]?_h:0,_tx=sp[0]<tp[0]?0:_w,_ty=sp[1]<tp[1]?0:_h;_CP=this._findControlPoint([_sx,_sy],sp,tp,p.sourceEndpoint,p.targetEndpoint,paintInfo.so,paintInfo.to),_CP2=this._findControlPoint([_tx,_ty],tp,sp,p.targetEndpoint,p.sourceEndpoint,paintInfo.to,paintInfo.so),_super.addSegment(this,"Bezier",{x1:_sx,y1:_sy,x2:_tx,y2:_ty,cp1x:_CP[0],cp1y:_CP[1],cp2x:_CP2[0],cp2y:_CP2[1]})}};_jp.Connectors.Bezier=Bezier,_ju.extend(Bezier,_jp.Connectors.AbstractBezierConnector)}.call("undefined"!=typeof window?window:this),function(){"use strict";var _jp=this.jsPlumb,_ju=this.jsPlumbUtil,StateMachine=function(params){params=params||{},this.type="StateMachine";var _controlPoint,_super=_jp.Connectors.AbstractBezierConnector.apply(this,arguments),curviness=params.curviness||10,margin=params.margin||5,proximityLimit=params.proximityLimit||80;params.orientation&&params.orientation;this._computeBezier=function(paintInfo,params,sp,tp,w,h){var _sx=params.sourcePos[0]<params.targetPos[0]?0:w,_sy=params.sourcePos[1]<params.targetPos[1]?0:h,_tx=params.sourcePos[0]<params.targetPos[0]?w:0,_ty=params.sourcePos[1]<params.targetPos[1]?h:0;0===params.sourcePos[2]&&(_sx-=margin),1===params.sourcePos[2]&&(_sx+=margin),0===params.sourcePos[3]&&(_sy-=margin),1===params.sourcePos[3]&&(_sy+=margin),0===params.targetPos[2]&&(_tx-=margin),1===params.targetPos[2]&&(_tx+=margin),0===params.targetPos[3]&&(_ty-=margin),1===params.targetPos[3]&&(_ty+=margin);var cp1x,cp2x,cp1y,cp2y,x1,y1,x2,y2,_midx=(_sx+_tx)/2,_midy=(_sy+_ty)/2,segment=(y1=_sy,y2=_ty,(x1=_sx)<=(x2=_tx)&&y2<=y1?1:x1<=x2&&y1<=y2?2:x2<=x1&&y1<=y2?3:4),distance=Math.sqrt(Math.pow(_tx-_sx,2)+Math.pow(_ty-_sy,2));cp1x=(_controlPoint=function(midx,midy,segment,sourceEdge,targetEdge,dx,dy,distance,proximityLimit){return distance<=proximityLimit?[midx,midy]:1===segment?sourceEdge[3]<=0&&1<=targetEdge[3]?[midx+(sourceEdge[2]<.5?-1*dx:dx),midy]:1<=sourceEdge[2]&&targetEdge[2]<=0?[midx,midy+(sourceEdge[3]<.5?-1*dy:dy)]:[midx+-1*dx,midy+-1*dy]:2===segment?1<=sourceEdge[3]&&targetEdge[3]<=0?[midx+(sourceEdge[2]<.5?-1*dx:dx),midy]:1<=sourceEdge[2]&&targetEdge[2]<=0?[midx,midy+(sourceEdge[3]<.5?-1*dy:dy)]:[midx+dx,midy+-1*dy]:3===segment?1<=sourceEdge[3]&&targetEdge[3]<=0?[midx+(sourceEdge[2]<.5?-1*dx:dx),midy]:sourceEdge[2]<=0&&1<=targetEdge[2]?[midx,midy+(sourceEdge[3]<.5?-1*dy:dy)]:[midx+-1*dx,midy+-1*dy]:4===segment?sourceEdge[3]<=0&&1<=targetEdge[3]?[midx+(sourceEdge[2]<.5?-1*dx:dx),midy]:sourceEdge[2]<=0&&1<=targetEdge[2]?[midx,midy+(sourceEdge[3]<.5?-1*dy:dy)]:[midx+dx,midy+-1*dy]:void 0}(_midx,_midy,segment,params.sourcePos,params.targetPos,curviness,curviness,distance,proximityLimit))[0],cp2x=_controlPoint[0],cp1y=_controlPoint[1],cp2y=_controlPoint[1],_super.addSegment(this,"Bezier",{x1:_tx,y1:_ty,x2:_sx,y2:_sy,cp1x:cp1x,cp1y:cp1y,cp2x:cp2x,cp2y:cp2y})}};_jp.Connectors.StateMachine=StateMachine,_ju.extend(StateMachine,_jp.Connectors.AbstractBezierConnector)}.call("undefined"!=typeof window?window:this),function(){"use strict";var _jp=this.jsPlumb,_ju=this.jsPlumbUtil,Straight=function(params){this.type="Straight";var _super=_jp.Connectors.AbstractConnector.apply(this,arguments);this._compute=function(paintInfo,_){_super.addSegment(this,"Straight",{x1:paintInfo.sx,y1:paintInfo.sy,x2:paintInfo.startStubX,y2:paintInfo.startStubY}),_super.addSegment(this,"Straight",{x1:paintInfo.startStubX,y1:paintInfo.startStubY,x2:paintInfo.endStubX,y2:paintInfo.endStubY}),_super.addSegment(this,"Straight",{x1:paintInfo.endStubX,y1:paintInfo.endStubY,x2:paintInfo.tx,y2:paintInfo.ty})}};_jp.Connectors.Straight=Straight,_ju.extend(Straight,_jp.Connectors.AbstractConnector)}.call("undefined"!=typeof window?window:this),function(){"use strict";var _jp=this.jsPlumb,_ju=this.jsPlumbUtil,svgAttributeMap={"stroke-linejoin":"stroke-linejoin","stroke-dashoffset":"stroke-dashoffset","stroke-linecap":"stroke-linecap"},ns_svg="http://www.w3.org/2000/svg",_attr=function(node,attributes){for(var i in attributes)node.setAttribute(i,""+attributes[i])},_node=function(name,attributes){return(attributes=attributes||{}).version="1.1",attributes.xmlns=ns_svg,_jp.createElementNS(ns_svg,name,null,null,attributes)},_pos=function(d){return"position:absolute;left:"+d[0]+"px;top:"+d[1]+"px"},_clearGradient=function(parent){for(var els=parent.querySelectorAll(" defs,linearGradient,radialGradient"),i=0;i<els.length;i++)els[i].parentNode.removeChild(els[i])},_applyStyles=function(parent,node,style,dimensions,uiComponent){if(node.setAttribute("fill",style.fill?style.fill:"none"),node.setAttribute("stroke",style.stroke?style.stroke:"none"),style.gradient?function(parent,node,style,dimensions,uiComponent){var g,id="jsplumb_gradient_"+uiComponent._jsPlumb.instance.idstamp();_clearGradient(parent),g=style.gradient.offset?_node("radialGradient",{id:id}):_node("linearGradient",{id:id,gradientUnits:"userSpaceOnUse"});var defs=_node("defs");parent.appendChild(defs),defs.appendChild(g);for(var i=0;i<style.gradient.stops.length;i++){var styleToUse=1===uiComponent.segment||2===uiComponent.segment?i:style.gradient.stops.length-1-i,stopColor=style.gradient.stops[styleToUse][1],s=_node("stop",{offset:Math.floor(100*style.gradient.stops[i][0])+"%","stop-color":stopColor});g.appendChild(s)}var applyGradientTo=style.stroke?"stroke":"fill";node.setAttribute(applyGradientTo,"url(#"+id+")")}(parent,node,style,0,uiComponent):(_clearGradient(parent),node.setAttribute("style","")),style.strokeWidth&&node.setAttribute("stroke-width",style.strokeWidth),style.dashstyle&&style.strokeWidth&&!style["stroke-dasharray"]){var sep=-1===style.dashstyle.indexOf(",")?" ":",",parts=style.dashstyle.split(sep),styleToUse="";parts.forEach(function(p){styleToUse+=Math.floor(p*style.strokeWidth)+sep}),node.setAttribute("stroke-dasharray",styleToUse)}else style["stroke-dasharray"]&&node.setAttribute("stroke-dasharray",style["stroke-dasharray"]);for(var i in svgAttributeMap)style[i]&&node.setAttribute(svgAttributeMap[i],style[i])},_appendAtIndex=function(svg,path,idx){svg.childNodes.length>idx?svg.insertBefore(path,svg.childNodes[idx]):svg.appendChild(path)};_ju.svg={node:_node,attr:_attr,pos:_pos};var SvgComponent=function(params){var pointerEventsSpec=params.pointerEventsSpec||"all",renderer={};_jp.jsPlumbUIComponent.apply(this,params.originalArgs),this.canvas=null,this.path=null,this.svg=null,this.bgCanvas=null;var clazz=params.cssClass+" "+(params.originalArgs[0].cssClass||""),svgParams={style:"",width:0,height:0,"pointer-events":pointerEventsSpec,position:"absolute"};this.svg=_node("svg",svgParams),params.useDivWrapper?(this.canvas=_jp.createElement("div",{position:"absolute"}),_ju.sizeElement(this.canvas,0,0,1,1),this.canvas.className=clazz):(_attr(this.svg,{class:clazz}),this.canvas=this.svg),params._jsPlumb.appendElement(this.canvas,params.originalArgs[0].parent),params.useDivWrapper&&this.canvas.appendChild(this.svg);var displayElements=[this.canvas];return this.getDisplayElements=function(){return displayElements},this.appendDisplayElement=function(el){displayElements.push(el)},this.paint=function(style,anchor,extents){if(null!=style){var p,xy=[this.x,this.y],wh=[this.w,this.h];null!=extents&&(extents.xmin<0&&(xy[0]+=extents.xmin),extents.ymin<0&&(xy[1]+=extents.ymin),wh[0]=extents.xmax+(extents.xmin<0?-extents.xmin:0),wh[1]=extents.ymax+(extents.ymin<0?-extents.ymin:0)),p=params.useDivWrapper?(_ju.sizeElement(this.canvas,xy[0],xy[1],wh[0],wh[1]),xy[0]=0,xy[1]=0,_pos([0,0])):_pos([xy[0],xy[1]]),renderer.paint.apply(this,arguments),_attr(this.svg,{style:p,width:wh[0]||0,height:wh[1]||0})}},{renderer:renderer}};_ju.extend(SvgComponent,_jp.jsPlumbUIComponent,{cleanup:function(force){force||null==this.typeId?(this.canvas&&(this.canvas._jsPlumb=null),this.svg&&(this.svg._jsPlumb=null),this.bgCanvas&&(this.bgCanvas._jsPlumb=null),this.canvas&&this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas),this.bgCanvas&&this.bgCanvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas),this.svg=null,this.canvas=null,this.path=null,this.group=null):(this.canvas&&this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas),this.bgCanvas&&this.bgCanvas.parentNode&&this.bgCanvas.parentNode.removeChild(this.bgCanvas))},reattach:function(instance){var c=instance.getContainer();this.canvas&&null==this.canvas.parentNode&&c.appendChild(this.canvas),this.bgCanvas&&null==this.bgCanvas.parentNode&&c.appendChild(this.bgCanvas)},setVisible:function(v){this.canvas&&(this.canvas.style.display=v?"block":"none")}}),_jp.ConnectorRenderers.svg=function(params){var self=this;SvgComponent.apply(this,[{cssClass:params._jsPlumb.connectorClass,originalArgs:arguments,pointerEventsSpec:"none",_jsPlumb:params._jsPlumb}]).renderer.paint=function(style,anchor,extents){var segments=self.getSegments(),offset=[0,0];if(extents.xmin<0&&(offset[0]=-extents.xmin),extents.ymin<0&&(offset[1]=-extents.ymin),0<segments.length){var a={d:self.getPathData(),transform:"translate("+offset[0]+","+offset[1]+")","pointer-events":params["pointer-events"]||"visibleStroke"},outlineStyle=null;self.x,self.y,self.w,self.h;if(style.outlineStroke){var outlineWidth=style.outlineWidth||1,outlineStrokeWidth=style.strokeWidth+2*outlineWidth;delete(outlineStyle=_jp.extend({},style)).gradient,outlineStyle.stroke=style.outlineStroke,outlineStyle.strokeWidth=outlineStrokeWidth,null==self.bgPath?(self.bgPath=_node("path",a),_jp.addClass(self.bgPath,_jp.connectorOutlineClass),_appendAtIndex(self.svg,self.bgPath,0)):_attr(self.bgPath,a),_applyStyles(self.svg,self.bgPath,outlineStyle,0,self)}null==self.path?(self.path=_node("path",a),_appendAtIndex(self.svg,self.path,style.outlineStroke?1:0)):_attr(self.path,a),_applyStyles(self.svg,self.path,style,0,self)}}},_ju.extend(_jp.ConnectorRenderers.svg,SvgComponent);var SvgEndpoint=_jp.SvgEndpoint=function(params){SvgComponent.apply(this,[{cssClass:params._jsPlumb.endpointClass,originalArgs:arguments,pointerEventsSpec:"all",useDivWrapper:!0,_jsPlumb:params._jsPlumb}]).renderer.paint=function(style){var s=_jp.extend({},style);s.outlineStroke&&(s.stroke=s.outlineStroke),null==this.node?(this.node=this.makeNode(s),this.svg.appendChild(this.node)):null!=this.updateNode&&this.updateNode(this.node),_applyStyles(this.svg,this.node,s,(this.x,this.y,this.w,this.h),this),_pos(this.node,(this.x,this.y))}.bind(this)};_ju.extend(SvgEndpoint,SvgComponent),_jp.Endpoints.svg.Dot=function(){_jp.Endpoints.Dot.apply(this,arguments),SvgEndpoint.apply(this,arguments),this.makeNode=function(style){return _node("circle",{cx:this.w/2,cy:this.h/2,r:this.radius})},this.updateNode=function(node){_attr(node,{cx:this.w/2,cy:this.h/2,r:this.radius})}},_ju.extend(_jp.Endpoints.svg.Dot,[_jp.Endpoints.Dot,SvgEndpoint]),_jp.Endpoints.svg.Rectangle=function(){_jp.Endpoints.Rectangle.apply(this,arguments),SvgEndpoint.apply(this,arguments),this.makeNode=function(style){return _node("rect",{width:this.w,height:this.h})},this.updateNode=function(node){_attr(node,{width:this.w,height:this.h})}},_ju.extend(_jp.Endpoints.svg.Rectangle,[_jp.Endpoints.Rectangle,SvgEndpoint]),_jp.Endpoints.svg.Image=_jp.Endpoints.Image,_jp.Endpoints.svg.Blank=_jp.Endpoints.Blank,_jp.Overlays.svg.Label=_jp.Overlays.Label,_jp.Overlays.svg.Custom=_jp.Overlays.Custom;var AbstractSvgArrowOverlay=function(superclass,originalArgs){superclass.apply(this,originalArgs),_jp.jsPlumbUIComponent.apply(this,originalArgs),this.isAppendedAtTopLevel=!1;this.path=null,this.paint=function(params,containerExtents){if(params.component.svg&&containerExtents){null==this.path&&(this.path=_node("path",{"pointer-events":"all"}),params.component.svg.appendChild(this.path),this.elementCreated&&this.elementCreated(this.path,params.component),this.canvas=params.component.svg);var clazz=originalArgs&&1===originalArgs.length&&originalArgs[0].cssClass||"",offset=[0,0];containerExtents.xmin<0&&(offset[0]=-containerExtents.xmin),containerExtents.ymin<0&&(offset[1]=-containerExtents.ymin),_attr(this.path,{d:makePath(params.d),class:clazz,stroke:params.stroke?params.stroke:null,fill:params.fill?params.fill:null,transform:"translate("+offset[0]+","+offset[1]+")"})}};var makePath=function(d){return isNaN(d.cxy.x)||isNaN(d.cxy.y)?"":"M"+d.hxy.x+","+d.hxy.y+" L"+d.tail[0].x+","+d.tail[0].y+" L"+d.cxy.x+","+d.cxy.y+" L"+d.tail[1].x+","+d.tail[1].y+" L"+d.hxy.x+","+d.hxy.y};this.transfer=function(target){target.canvas&&this.path&&this.path.parentNode&&(this.path.parentNode.removeChild(this.path),target.canvas.appendChild(this.path))}};_ju.extend(AbstractSvgArrowOverlay,[_jp.jsPlumbUIComponent,_jp.Overlays.AbstractOverlay],{cleanup:function(force){null!=this.path&&(force?this._jsPlumb.instance.removeElement(this.path):this.path.parentNode&&this.path.parentNode.removeChild(this.path))},reattach:function(instance,component){this.path&&component.canvas&&component.canvas.appendChild(this.path)},setVisible:function(v){null!=this.path&&(this.path.style.display=v?"block":"none")}}),_jp.Overlays.svg.Arrow=function(){AbstractSvgArrowOverlay.apply(this,[_jp.Overlays.Arrow,arguments])},_ju.extend(_jp.Overlays.svg.Arrow,[_jp.Overlays.Arrow,AbstractSvgArrowOverlay]),_jp.Overlays.svg.PlainArrow=function(){AbstractSvgArrowOverlay.apply(this,[_jp.Overlays.PlainArrow,arguments])},_ju.extend(_jp.Overlays.svg.PlainArrow,[_jp.Overlays.PlainArrow,AbstractSvgArrowOverlay]),_jp.Overlays.svg.Diamond=function(){AbstractSvgArrowOverlay.apply(this,[_jp.Overlays.Diamond,arguments])},_ju.extend(_jp.Overlays.svg.Diamond,[_jp.Overlays.Diamond,AbstractSvgArrowOverlay]),_jp.Overlays.svg.GuideLines=function(){var p1_1,p1_2,path=null,self=this;_jp.Overlays.GuideLines.apply(this,arguments),this.paint=function(params,containerExtents){null==path&&(path=_node("path"),params.connector.svg.appendChild(path),self.attachListeners(path,params.connector),self.attachListeners(path,self),p1_1=_node("path"),params.connector.svg.appendChild(p1_1),self.attachListeners(p1_1,params.connector),self.attachListeners(p1_1,self),p1_2=_node("path"),params.connector.svg.appendChild(p1_2),self.attachListeners(p1_2,params.connector),self.attachListeners(p1_2,self));var offset=[0,0];containerExtents.xmin<0&&(offset[0]=-containerExtents.xmin),containerExtents.ymin<0&&(offset[1]=-containerExtents.ymin),_attr(path,{d:makePath(params.head,params.tail),stroke:"red",fill:null,transform:"translate("+offset[0]+","+offset[1]+")"}),_attr(p1_1,{d:makePath(params.tailLine[0],params.tailLine[1]),stroke:"blue",fill:null,transform:"translate("+offset[0]+","+offset[1]+")"}),_attr(p1_2,{d:makePath(params.headLine[0],params.headLine[1]),stroke:"green",fill:null,transform:"translate("+offset[0]+","+offset[1]+")"})};var makePath=function(d1,d2){return"M "+d1.x+","+d1.y+" L"+d2.x+","+d2.y}},_ju.extend(_jp.Overlays.svg.GuideLines,_jp.Overlays.GuideLines)}.call("undefined"!=typeof window?window:this),function(){"use strict";var _jp=this.jsPlumb,_ju=this.jsPlumbUtil,_jk=this.Katavorio,_jg=this.Biltong,_getDragManager=function(instance,category){var key="_katavorio_"+(category=category||"main"),k=instance[key],e=instance.getEventManager();return k||((k=new _jk({bind:e.on,unbind:e.off,getSize:_jp.getSize,getConstrainingRectangle:function(el){return[el.parentNode.scrollWidth,el.parentNode.scrollHeight]},getPosition:function(el,relativeToRoot){var o=instance.getOffset(el,relativeToRoot,el._katavorioDrag?el.offsetParent:null);return[o.left,o.top]},setPosition:function(el,xy){el.style.left=xy[0]+"px",el.style.top=xy[1]+"px"},addClass:_jp.addClass,removeClass:_jp.removeClass,intersects:_jg.intersects,indexOf:function(l,i){return l.indexOf(i)},scope:instance.getDefaultScope(),css:{noSelect:instance.dragSelectClass,droppable:"jtk-droppable",draggable:"jtk-draggable",drag:"jtk-drag",selected:"jtk-drag-selected",active:"jtk-drag-active",hover:"jtk-drag-hover",ghostProxy:"jtk-ghost-proxy"}})).setZoom(instance.getZoom()),instance[key]=k,instance.bind("zoom",k.setZoom)),k};_jp.extend(this.jsPlumbInstance.prototype,{animationSupported:!0,getElement:function(el){return null==el?null:"string"==typeof(el="string"==typeof el?el:null!=el.length&&null==el.enctype?el[0]:el)?document.getElementById(el):el},removeElement:function(element){_getDragManager(this).elementRemoved(element),this.getEventManager().remove(element)},doAnimate:function(el,properties,options){options=options||{};var o=this.getOffset(el),ap=function(o,p){var _one=function(pName){if(null==p[pName])return o[pName];if(_ju.isString(p[pName])){var m=p[pName].match(/-=/)?-1:1,v=p[pName].substring(2);return o[pName]+m*v}return p[pName]};return[_one("left"),_one("top")]}(o,properties),ldist=ap[0]-o.left,tdist=ap[1]-o.top,d=options.duration||250,steps=d/15,linc=15/d*ldist,tinc=15/d*tdist,idx=0,_int=setInterval(function(){_jp.setPosition(el,{left:o.left+linc*(idx+1),top:o.top+tinc*(idx+1)}),null!=options.step&&options.step(idx,Math.ceil(steps)),steps<=++idx&&(window.clearInterval(_int),null!=options.complete&&options.complete())},15)},destroyDraggable:function(el,category){_getDragManager(this,category).destroyDraggable(el)},unbindDraggable:function(el,evt,fn,category){_getDragManager(this,category).destroyDraggable(el,evt,fn)},destroyDroppable:function(el,category){_getDragManager(this,category).destroyDroppable(el)},unbindDroppable:function(el,evt,fn,category){_getDragManager(this,category).destroyDroppable(el,evt,fn)},initDraggable:function(el,options,category){_getDragManager(this,category).draggable(el,options)},initDroppable:function(el,options,category){_getDragManager(this,category).droppable(el,options)},isAlreadyDraggable:function(el){return null!=el._katavorioDrag},isDragSupported:function(el,options){return!0},isDropSupported:function(el,options){return!0},isElementDraggable:function(el){return(el=_jp.getElement(el))._katavorioDrag&&el._katavorioDrag.isEnabled()},getDragObject:function(eventArgs){return eventArgs[0].drag.getDragElement()},getDragScope:function(el){return el._katavorioDrag&&el._katavorioDrag.scopes.join(" ")||""},getDropEvent:function(args){return args[0].e},getUIPosition:function(eventArgs,zoom){var el=eventArgs[0].el;if(null==el.offsetParent)return null;var finalPos=eventArgs[0].finalPos||eventArgs[0].pos,p={left:finalPos[0],top:finalPos[1]};if(el._katavorioDrag&&el.offsetParent!==this.getContainer()){var oc=this.getOffset(el.offsetParent);p.left+=oc.left,p.top+=oc.top}return p},setDragFilter:function(el,filter,_exclude){el._katavorioDrag&&el._katavorioDrag.setFilter(filter,_exclude)},setElementDraggable:function(el,draggable){(el=_jp.getElement(el))._katavorioDrag&&el._katavorioDrag.setEnabled(draggable)},setDragScope:function(el,scope){el._katavorioDrag&&el._katavorioDrag.k.setDragScope(el,scope)},setDropScope:function(el,scope){el._katavorioDrop&&0<el._katavorioDrop.length&&el._katavorioDrop[0].k.setDropScope(el,scope)},addToPosse:function(el,spec){var specs=Array.prototype.slice.call(arguments,1),dm=_getDragManager(this);_jp.each(el,function(_el){(_el=[_jp.getElement(_el)]).push.apply(_el,specs),dm.addToPosse.apply(dm,_el)})},setPosse:function(el,spec){var specs=Array.prototype.slice.call(arguments,1),dm=_getDragManager(this);_jp.each(el,function(_el){(_el=[_jp.getElement(_el)]).push.apply(_el,specs),dm.setPosse.apply(dm,_el)})},removeFromPosse:function(el,posseId){var specs=Array.prototype.slice.call(arguments,1),dm=_getDragManager(this);_jp.each(el,function(_el){(_el=[_jp.getElement(_el)]).push.apply(_el,specs),dm.removeFromPosse.apply(dm,_el)})},removeFromAllPosses:function(el){var dm=_getDragManager(this);_jp.each(el,function(_el){dm.removeFromAllPosses(_jp.getElement(_el))})},setPosseState:function(el,posseId,state){var dm=_getDragManager(this);_jp.each(el,function(_el){dm.setPosseState(_jp.getElement(_el),posseId,state)})},dragEvents:{start:"start",stop:"stop",drag:"drag",step:"step",over:"over",out:"out",drop:"drop",complete:"complete",beforeStart:"beforeStart"},animEvents:{step:"step",complete:"complete"},stopDrag:function(el){el._katavorioDrag&&el._katavorioDrag.abort()},addToDragSelection:function(spec){_getDragManager(this).select(spec)},removeFromDragSelection:function(spec){_getDragManager(this).deselect(spec)},clearDragSelection:function(){_getDragManager(this).deselectAll()},trigger:function(el,event,originalEvent,payload){this.getEventManager().trigger(el,event,originalEvent,payload)},doReset:function(){for(var key in this)0===key.indexOf("_katavorio_")&&this[key].reset()}});var f,_do;f=_jp.init,(_do=function(){/complete|loaded|interactive/.test(document.readyState)&&void 0!==document.body&&null!=document.body?f():setTimeout(_do,9)})()}.call("undefined"!=typeof window?window:this);