<html >
    <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>读取缓存数据</title>
    <style>
        html {
            font-size: 50px;
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            display: block;
            background:#e4f1fc;
        }
        body {
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
            font-size: 0.3rem;
            background: #F5F5F5;
            padding-top: 0;   /*为导航栏+状态栏的高度 88px */           
            padding-left: constant(safe-area-inset-left);   /*如果未竖屏时为0 */    
            padding-right: constant(safe-area-inset-right); /*如果未竖屏时为0 */             
            padding-bottom: constant(safe-area-inset-bottom);/*为底下圆弧的高度 34px */      
            overflow: scroll;   
        }
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            border:0;
            word-wrap:break-word;
            -webkit-touch-callout:none;
            -webkit-tap-highlight-color:rgba(0,0,0,0);
        }
        input,button,select,textarea{
            outline:none;
            border:none;
        }
        a{
            text-decoration: none;
        }
        ul,li{
            list-style:none;
        }
        .log-module {
            padding: .24rem;
            overflow: scroll;
            padding-bottom: 1rem;
        }
        .log-module h4 {
            position: relative;
            top: 0;
            left: 0;
            margin: 0.05rem 0 0.1rem;
        }
        .log-module .border-line {
            border-bottom: 1px solid #eee;
            padding-bottom: .1rem;
        }
        .operation-toast {
            font-size: 14px;
            line-height: 30px;
        }
        .log-module .ul-content {
            border-top: 1px solid #aaa;
            border-left: 1px solid #aaa;
            border-right: 1px solid #aaa;
        }
        .log-module .ul-content .content {
            display: flex;
        }
        .log-module .ul-content .content .key {
            width: 20%;
            border-right: 1px solid #aaa;
            border-bottom: 1px solid #aaa;
        }
        .log-module .ul-content .content .val {
            width: 80%;
            border-bottom: 1px solid #aaa;
            background: transparent;
        }
        .mint-badge {
            background-color: #26a2ff;
            border-radius: 14px;
            font-size: 18px;
            padding: 2px 10px;
            color: #fff;
            text-align: center;
            display: inline-block;
        }
        button {
            -webkit-appearance: button;
            -webkit-writing-mode: horizontal-tb !important;
            text-rendering: auto;
            color: buttontext;
            letter-spacing: normal;
            word-spacing: normal;
            text-transform: none;
            text-indent: 0px;
            text-shadow: none;
            display: inline-block;
            text-align: center;
            align-items: flex-start;
            cursor: default;
            background-color: buttonface;
            box-sizing: border-box;
            margin: 0em;
            font: 400 11px system-ui;
            padding: 1px 7px 2px;
            border-width: 1px;
            border-style: solid;
            border-color: rgb(216, 216, 216) rgb(209, 209, 209) rgb(186, 186, 186);
            border-image: initial;
        }
        .mint-button {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            border-radius: 4px;
            border: 0;
            box-sizing: border-box;
            color: inherit;
            display: block;
            font-size: 18px;
            height: 36px;
            outline: 0;
            overflow: hidden;
            position: relative;
            text-align: center;
            display: inline-block;
            padding: 0 12px;
            line-height: 36px;
            vertical-align: top;
            margin-right: 20px;
            margin-bottom: 10px;
        }

        .mint-button--primary {
            color: #fff;
            background-color: #26a2ff;
        }
        .mint-button--danger {
            color: #fff;
            background-color: #ef4f4f;
        }
        /**
        * 2*** 弹出提示信息样式
        */
        .hr-toast-show{
            position: fixed;
            display: -webkit-box;
            display: -webkit-flex;
            display: flex;
            height: 100%;
            width: 100%;
            left: 0;
            top: 0;
            text-align: center;
            -webkit-justify-content:center;
            justify-content:center;
            -webkit--moz-box-pack:center;
            box-pack:center;
            align-items:center;
            -webkit-align-items:center;
            box-align:center;
            -webkit-box-align:center;
            z-index: 990;
        }
        .hr-toast-show-top{
            align-items:flex-start;
            margin-top: 20%;
        }
        .hr-toast-show-bottom{
            align-items:flex-end;
            transform: translate(0,-20%);
            -webkit-transform: translate(0,-20%);
        }
        .hr-toast-show-content{
            padding: 15px;
            background: rgba(0,0,0,.7);
            border-radius: 5px;
        }
        .hr-toast-show-content i{
            height: 50px;
            width: 50px;
            font-size: 50px;
            color: #fff;
        }
        .hr-toast-show-text{
            max-width: 270px;
            font-size: 16px;
            border-radius: 5px;
            z-index: 100;
            color: #fff;
        }
        .hr-toast-show-shade{
            position: fixed;
            z-index: 90;
            top: 0;
            left: 0;
            height: 100%;
            width: 100%;
            background-color: rgba(0,0,0,.4);
        }
        /**
        * 3*** 弹出式提示框，有多种交互形式。
        */
        .hr-messagebox {
            position: fixed;
            z-index: 970;
            width: 100%;
            height: 100%;
            left: 0;
            top: 0;
        }
        .hr-messagebox-mask {
            position: absolute;
            width: 100%;
            height: 100%;
            left: 0;
            top: 0;
            z-index: 980;
            background-color: rgba(0, 0, 0, 0.5);
        }
        .hr-messagebox-box {
            width: 270px;
            position: absolute;
            left: 50%;
            top: 50%;
            z-index: 990;
            margin-left: -135px;
            background: #ffffff;
            border-radius: 6px;
            overflow: hidden;
            transform: scale(1, 1) translateY(-50%);
            -webkit-transform: scale(1, 1) translateY(-50%);
            transform-origin: center top;
            -webkit-transform-origin: center top;
            opacity: 1;
            animation: noName 0.2s ease-in 1 0s;
            -webkit-animation: noName 0.2s ease-in 1 0s;
        }
        @keyframes toBig {
            from {
                opacity: 0;
                transform: scale(0, 0) translateY(-50%);
                -webkit-transform: scale(0, 0) translateY(-50%);
            }
            to {
                opacity: 1;
                transform: scale(1, 1) translateY(-50%);
                -webkit-transform: scale(1, 1) translateY(-50%);
            }
        }
        @-webkit-keyframes toBig {
            from {
                opacity: 0;
                transform: scale(0, 0) translateY(-50%);
                -webkit-transform: scale(0, 0) translateY(-50%);
            }
            to {
                opacity: 1;
                transform: scale(1, 1) translateY(-50%);
                -webkit-transform: scale(1, 1) translateY(-50%);
            }
        }
        @keyframes toSmall {
            from {
                opacity: 1;
                transform: scale(1, 1) translateY(-50%);
                -webkit-transform: scale(1, 1) translateY(-50%);
            }
            to {
                opacity: 0;
                transform: scale(0, 0) translateY(-50%);
                -webkit-transform: scale(0, 0) translateY(-50%);
            }
        }
        @-webkit-keyframes toSmall {
            from {
                opacity: 1;
                transform: scale(1, 1) translateY(-50%);
                -webkit-transform: scale(1, 1) translateY(-50%);
            }
            to {
                opacity: 0;
                transform: scale(0, 0) translateY(-50%);
                -webkit-transform: scale(0, 0) translateY(-50%);
            }
        }
        .hr-messagebox-box.big {
            transform: scale(1, 1);
            -webkit-transform: scale(1, 1);
        }
        .hr-messagebox-title {
            line-height: 35px;
            text-align: center;
            color: #343434;
            font-size: 14px;
            font-weight: 700;
        }
        .hr-messagebox-text p{
            line-height: 30px;
            color: #343434;
            font-size: 15px;
            padding: 0 0.50px;
            margin:15px 0;
            text-align: center;
            word-break: break-all;
            max-height: 250px;
            overflow: auto;
        }
        .hr-messagebox-btn-box {
            height: 45px;
            border-top: 1px solid #e4e4e4;
            display: -webkit-box;
            display: -webkit-flex;
            display: flex;
            -webkit-box-orient: horizontal;
            flex-flow: row;
            -webkit-flex-flow: row;
        }
        .hr-messagebox-btn {
            -webkit-box-flex: 1;
            -webkit-flex: 1;
            flex: 1;
            line-height: 45px;
            font-size: 14px;
            color: #1baede;
            text-align: center;
        }
        .hr-messagebox-btn:last-child {
            border-left: 1px solid #e4e4e4;
        }
        .hide-copy-textarea{
            width: 100%;
            height:10px;
            position: fixed;
            top:-20px;
            left: 0;
            -webkit-user-select:text;
            -moz-user-select:text;
            -o-user-select:text;
            user-select:text;
        }
        .version{
            position: absolute;
            right: 0;
            top: 0;
            color: #aaa;
            font-size: 12px;
        }
        .footer {
            position: fixed;
            left: 0;
            bottom: 0;
            width: 100%;
            height:.88rem;
            border: 1px solid #aaa;
            text-align: center;
            font-size: .3rem;
            line-height: .88rem;
            background: #fff;
            z-index: 10;
        }
        .list-k {
            padding: 0 10px;
        }
        .err {
            background: rgba(255, 0, 0, 0.1)
        }
        .none {
            display: none;
        }
    </style>
</head>
<body>
    <textarea class="hide-copy-textarea" cols="27" rows="1" id="data-content" > </textarea>
    <div class="log-module router" id="top">
        <h4 >修改缓存数量 <span class="version">v:1.3</span></h4> 
        <div class="border-line">
            <span class="mint-badge" >15</span> 
            <span class="mint-badge" >30</span> 
            <span class="mint-badge" >50</span> 
            <span class="mint-badge" >重置</span>
        </div> 
        <h4 >操作</h4> 
        <div class="border-line">
            <button class="mint-button mint-button--primary" id="sendBtn" data-clipboard-action="copy" data-clipboard-target="#data-content">复制</button> 
            <button class="mint-button mint-button--danger" id="clear">清除全部</button>
            <p class="operation-toast">复制内容较多，粘贴到邮件中发送</p>
            <p class="operation-toast err" id="err-nums"></p>
        </div> 
        <h4 >缓存记录</h4> 
        <ul class="tab-frame" id="dom">
        </ul>
        <a class="footer" href="#top">回到顶部</a>
    </div>
    <script src="./clipboard.min.js"></script>
    <script src="./jquery.js"></script>
    <script>
        class LogObj {
            constructor() {
                this.subject = ''
                this.options= {}
            }
            // 清除cookie
            clearCookie(){
                let paths = ['/','/nccloud']
                let domain =[]
                let host = location.hostname
                domain.push(host)
                if(host.indexOf('www') > -1){
                    domain.push(host.substr(3))
                }
                let keys = document.cookie.match(/[^ =;]+(?=\=)/g) || []
                function deleteCookie(name,path,domain){
                    if(keys.indexOf(name)<0)return
                    document.cookie= name + '=' + ((path)?';path='+path:'') + ((domain)?';domain='+domain:'') + ';expires=Thu,01-Jan-1970 00:00:01 GMT';
                }
                let arrs=[]
                paths.forEach(p=>{
                    domain.forEach(d=>{
                        keys.forEach(k=>{
                            arrs.push({k,p,d})
                            deleteCookie(k,p,d)
                        })
                    })
                })
            }
            // 全清除
            clearAll(){
                this.clearCookie()
                localStorage.clear()
                sessionStorage.clear()
                this.toast('clearAll')
            }
            
            // 操作localStorage的方法
            getStorage(key){
                var v=localStorage.getItem(key);
                if(!v){return null}
                var v4=v.slice(0,4);
                if(v4=='obj-'){
                    v=JSON.parse(v.slice(4));
                }else if(v4=='str-'){
                    v=v.slice(4);
                }
                return v
            }
            setStorage(key,value){
                var v=value;
                if(typeof v == "object"){
                    v="obj-"+JSON.stringify(v)
                }else{
                    if(value === null || value === undefined){
                        v="str-"
                    }else{
                        v="str-"+v
                    }
                }
                localStorage.setItem(key,v);
            }
            // 2*** 打开提示信息
            toast(opt) {
                var $html,
                        html = "",
                    textMaxWidth = 5.4,
                        _opt={//初始化数据
                            "text":"加载中",										// 文本信息
                        "iconType": "none",			// 客制化icon样式 取自hr-fonts,none为不显示,"hr-check-mark"
                        "position" : "center",       			// top 顶部 bottom 底部 不传或传空  中部
                            "timeout":2000,										// 设置超时时间，-1为不超时
                            "callback":this.closeToast,				// 回调函数
                        }
                //参数赋值
                if(!opt){
                    // opt为空执行默认
                }else if(typeof opt === "number"||typeof opt === 'string'){
                    _opt.text=opt;
                }else if(opt.toString()==="[object Object]"){
                    $.extend(_opt,opt);
                };
                this.options=_opt;
                if(_opt.position == 'top') {
                    html += '<div class="hr-toast-show ' + 'hr-toast-show-top">';
                }else if (_opt.position == 'bottom') {
                    html += '<div class="hr-toast-show ' + 'hr-toast-show-bottom">';
                } else {
                    html += '<div class="hr-toast-show">';
                }
                    html += '<div class="hr-toast-show-content">';
                if(_opt.iconType!=="none") {
                    html += '<i class="icon hrfont ' + _opt.iconType + '"></i>';
                    textMaxWidth = 2;
                }
                    html += '<div class="hr-toast-show-transform"></div>';
                    html += '<div class="hr-toast-show-text" style="max-width:' + textMaxWidth +'rem">' + _opt.text + '</div>';
                    html += '</div>';
                    html += '</div>';
                $html = $(html)
                $("body").append($html);
                if(_opt.timeout!==-1){
                    setTimeout(function(){_opt.callback()}, _opt.timeout)
                }
            }
            // 关闭提示信息
            closeToast(){
                $(".hr-toast-show").remove()
            }
            //	3*** 打开提示框
            messagebox (opt) {
                var $html,
                        html = "",
                        _opt={//初始化数据
                            "title":"",												//标题
                            "type":"single",									//弹窗类型
                            "text":"加载中",										// 文本信息
                            "confirmFun":this.closeMessagebox,	//确定的回调函数
                            "cancelFun":this.closeMessagebox,	//取消的回调函数
                            "confirmName":"确定",							//确定的自定义名称
                            "cancelName":"取消",							//取消的自定义名称
                            "hasLoadingIcon":true,						// 是否显示图形
                        }
                //参数赋值
                if(!opt){
                    // opt为空执行默认
                    return 
                }else if(typeof opt === "number"||typeof opt === 'string'){
                    _opt.text=opt;
                }else if(opt.toString()==="[object Object]"){
                    $.extend(_opt,opt);
                };
                this.options=_opt;
                    html += '<div class="hr-messagebox">';
                    html += '<div class="hr-messagebox-mask" ></div>';
                    html += '<div class="hr-messagebox-box">';
                    html += '<div class="hr-messagebox-title">'+_opt.title+'</div>';	
                    html += '<div class="hr-messagebox-content" >';
                if( _opt.type == "single" ){
                    html += '<div class="hr-messagebox-text"><p>' + _opt.text + '</p></div>';
                }else if( _opt.type == "double" ){
                    html += '<div class="hr-messagebox-text"><p>' + _opt.text + '</p></div>';
                }else{
                    html += '<div class="hr-messagebox-text"><p>' + _opt.text + '</p></div>';
                }
                    html += '</div>';
                if( _opt.type == "single" ){
                    html += '<div class="hr-messagebox-btn-box">';
                    html += '<div class="hr-messagebox-btn confirmFun" >'+_opt.confirmName+'</div>';
                    html += '</div>';
                }else if( _opt.type == "double" ){
                    html += '<div class="hr-messagebox-btn-box">';
                    html += '<div class="hr-messagebox-btn cancelFun" >'+_opt.cancelName+'</div>';
                    html += '<div class="hr-messagebox-btn confirmFun" >'+_opt.confirmName+'</div>';
                    html += '</div>';
                }
                html += '</div>';
                html += '</div>';
                $("body").append(html);
                $(".hr-messagebox-box").css({
                    "animation-name":"toBig",
                    "-webkit-animation-name":"toBig",
                    "animation-timing-function":"ease-in",
                    "-webkit-animation-timing-function":"ease-in",
                    "opacity":1,
                    "transform":"scale(1,1) translateY(-50%)",
                    "-webkit-transform":"scale(1,1) translateY(-50%)"
                });
                $(".hr-messagebox-btn.confirmFun").bind("click", function(){
                    _opt.confirmFun();
                });
                $(".hr-messagebox-btn.cancelFun").bind("click", function(){
                    _opt.cancelFun()
                });
            }
            // 关闭提示框
            closeMessagebox (){
                $(".hr-messagebox-box").css({
                    "animation-name":"toSmall",
                    "-webkit-animation-name":"toSmall",
                    "animation-timing-function":"ease-out",
                    "-webkit-animation-timing-function":"ease-out",
                    "opacity":0,
                    "transform":"scale(0,0) translateY(-50%)",
                    "-webkit-transform":"scale(0,0) translateY(-50%)"
                });
                $(".hr-messagebox-mask").fadeOut(300,function(){
                    $(".hr-messagebox").remove();
                });
            }
            // 解析地址栏数据
            parseQueryString(url){
                let reg_url = /^[^\?]+\?([\w\W]+)$/,
                    reg_para = /([^&=]+)=([\w\W]*?)(&|$|#)/g,
                    arr_url = reg_url.exec(url),
                    ret = {}
                if (arr_url && arr_url[1]) {
                    var str_para = arr_url[1], result;
                    while ((result = reg_para.exec(str_para)) != null) {
                    ret[result[1]] = result[2];
                    }
                }
                return ret
            };
            // 绑定事件
            onEvent(){
                // 复制数据
                let clipboard = new Clipboard('#sendBtn'); 
                clipboard.on('success', (e) => {
                    this.toast("复制成功！")
                });
                clipboard.on('error', (e) => {
                    this.toast("复制失败！请手动复制")
                });
                
                // 清除操作
                $('#clear').on('click',(e) => {
                    this.messagebox({text:'您确定要清除历史请求么？',
                        confirmFun:()=>{
                            this.clearAll();
                            this.closeMessagebox()
                            this.renderFun()
                        },
                        cancelFun:()=>{this.closeMessagebox()},
                        type:'double'
                    })
                })

                // 修改缓存存储数量
                $(".mint-badge").on('click',(e) => {
                    let num = isNaN(e.target.innerText)? 20 : e.target.innerText
                    this.setStorage('_localLogNum', num)
                    this.toast('已修改成'+e.target.innerText)
                })
            }
            // 子模板中加工字符串的方法
            childDom(obj, name){
                if(!obj){
                    return ''
                }
                let returnDom = '<h5 >'+name+'</h5><ul class="ul-content">'
                for(let k in obj){
                    returnDom += '<li class="content"><span class="key">' + k + '</span> <textarea rows="6" readonly class="val">' + JSON.stringify(obj[k]) + '</textarea></li>'
                }
                returnDom += '</ul>'
                return returnDom   
            }
            // 异常数据快捷键
            errDom(errArr) {
                let returnDom = ''
                if(errArr.length > 0) {
                    errArr.forEach(ele => {
                        console.log(ele)
                        returnDom += '<a class="list-k" href="#list' + ele + '">' + ele + '</a>'
                    });
                    returnDom = '异常数据号码：' + returnDom
                }
                $('#err-nums').html(returnDom)
            }
            // 字符串模板中加工字符串的方法
            parentDom(arr) {
                let returnDom = ''
                let errArr = []
                for (let i = 0; i < arr.length; i++) { 
                    returnDom += '<li class="tab-li ' + (arr[i].err ? ' err' : '')+ '" id=list' + (i+1) + '><h4 >第' + (i+1) + '条请求</h4>'
                    returnDom += this.childDom(arr[i].request, 'request')
                    returnDom += this.childDom(arr[i].success, 'success')
                    returnDom += this.childDom(arr[i].err, 'err')
                    returnDom += '</li>'
                    if(arr[i].err) {errArr.push(i+1)}
                }
                this.errDom(errArr)
                return returnDom
            }
            // 向页面渲染数据
            renderFun(){
                let _localLogData = this.getStorage('_localLogData') || []
                $('#dom').html(this.parentDom(_localLogData))
                $('#data-content').val(`subject:${this.subject}----${localStorage.getItem('_localLogData')}`)
            }
            // 初始化
            init() {
                // 获取 邮件信息 收集人、标题、主体
                let urlParam = this.parseQueryString(location.href)
                this.subject = urlParam.subject         
                this.renderFun()
                this.onEvent()
            }
        }
        let logObj = new LogObj()
        logObj.init()
    </script>
</body>
</html>